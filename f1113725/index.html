<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='SortedsetÂ∫ïÂ±ÇÂ≠òÂÇ®ÁªìÊûÑ sortedsetÂêåÊó∂‰ºöÁî±‰∏§ÁßçÊï∞ÊçÆÁªìÊûÑÊîØÊåÅ,ziplistÂíåskiplist. Âè™ÊúâÂêåÊó∂Êª°Ë∂≥Â¶Ç‰∏ãÊù°‰ª∂ÊòØ,‰ΩøÁî®ÁöÑÊòØ'>
<title>Redis-Sorted-SetÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑ</title>

<link rel='canonical' href='https://lxb.wiki/f1113725/'>

<link rel="stylesheet" href="/scss/style.min.bc5bb6e306c354a2f5d5bfd1e65a5f3996962fb9b4a3546b748aee7daee4f258.css"><meta property='og:title' content='Redis-Sorted-SetÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑ'>
<meta property='og:description' content='SortedsetÂ∫ïÂ±ÇÂ≠òÂÇ®ÁªìÊûÑ sortedsetÂêåÊó∂‰ºöÁî±‰∏§ÁßçÊï∞ÊçÆÁªìÊûÑÊîØÊåÅ,ziplistÂíåskiplist. Âè™ÊúâÂêåÊó∂Êª°Ë∂≥Â¶Ç‰∏ãÊù°‰ª∂ÊòØ,‰ΩøÁî®ÁöÑÊòØ'>
<meta property='og:url' content='https://lxb.wiki/f1113725/'>
<meta property='og:site_name' content='Xiaobin&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='redis' /><meta property='article:published_time' content='2021-06-22T22:56:12&#43;00:00'/><meta property='article:modified_time' content='2021-06-22T22:56:12&#43;00:00'/>
<meta name="twitter:title" content="Redis-Sorted-SetÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑ">
<meta name="twitter:description" content="SortedsetÂ∫ïÂ±ÇÂ≠òÂÇ®ÁªìÊûÑ sortedsetÂêåÊó∂‰ºöÁî±‰∏§ÁßçÊï∞ÊçÆÁªìÊûÑÊîØÊåÅ,ziplistÂíåskiplist. Âè™ÊúâÂêåÊó∂Êª°Ë∂≥Â¶Ç‰∏ãÊù°‰ª∂ÊòØ,‰ΩøÁî®ÁöÑÊòØ">
<link rel="shortcut icon" href="/favicon.png" />

<script data-ad-client="ca-pub-5708899526501350" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-JZ2PWLT6JY"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-JZ2PWLT6JY');
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu692828361b78eaa42fdbdbbf5a7177a9_44446_300x0_resize_q75_box.jpeg" width="300"
                            height="298" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Xiaobin&#39;s Blog</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header>


    <ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>È¶ñÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/' >
                
                
                
                <span>ÂàÜÁ±ª</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' >
                
                
                
                <span>Ê†áÁ≠æ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                <span>ÂèãÈìæ</span>
            </a>
        </li>
        

        <div class="menu-bottom-section"><ol class="social-menu">
                    
                        <li>
                            <a 
                                href='mailto://me@liuxb.email'
                                target="_blank"
                                title="Email"
                                rel="me"
                            >
                                
                                
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                
                            </a>
                        </li>
                    
                        <li>
                            <a 
                                href='https://github.com/lxbwolf'
                                target="_blank"
                                title="GitHub"
                                rel="me"
                            >
                                
                                
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                                
                            </a>
                        </li>
                    
                </ol>
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>ÊöóËâ≤Ê®°Âºè</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
<section class="widget archives">
    
    <h2 class="widget-title section-title">ÁõÆÂΩï</h2>

    <div class="widget--toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1-Ë∑≥Ë∑ÉË°®">1 Ë∑≥Ë∑ÉË°®</a></li>
    <li><a href="#2-Ë∑≥Ë∑ÉË°®ÁöÑÁªìÊûÑ">2 Ë∑≥Ë∑ÉË°®ÁöÑÁªìÊûÑ</a></li>
    <li><a href="#3-ÂéãÁº©ÂàóË°®">3 ÂéãÁº©ÂàóË°®</a>
      <ul>
        <li><a href="#ËøûÈîÅÊõ¥Êñ∞">ËøûÈîÅÊõ¥Êñ∞</a></li>
      </ul>
    </li>
    <li><a href="#4-quicklist">4 quicklist</a>
      <ul>
        <li><a href="#Êï∞ÊçÆÂéãÁº©">Êï∞ÊçÆÂéãÁº©</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
        <a href="/categories/DB/" >
            DB
        </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/f1113725/">Redis-Sorted-SetÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑ</a>
        </h2>

        
    </div>

    
    
    
    
    <footer class="article-time">
        
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
            <time class="article-time--published">Jun 22, 2021</time>
        </div>
        

        
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



            <time class="article-time--reading">
                ÈòÖËØªÊó∂Èïø: 10 ÂàÜÈíü
            </time>
        </div>
        
        <small>
    <section class="article-tags">
        
            <a href="/tags/redis/">redis</a>
        
    </section>
</small>
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <!-- raw HTML omitted -->
<h1 id="sortedsetÂ∫ïÂ±ÇÂ≠òÂÇ®ÁªìÊûÑ">SortedsetÂ∫ïÂ±ÇÂ≠òÂÇ®ÁªìÊûÑ</h1>
<p>sortedsetÂêåÊó∂‰ºöÁî±‰∏§ÁßçÊï∞ÊçÆÁªìÊûÑÊîØÊåÅ,ziplistÂíåskiplist.</p>
<p>Âè™ÊúâÂêåÊó∂Êª°Ë∂≥Â¶Ç‰∏ãÊù°‰ª∂ÊòØ,‰ΩøÁî®ÁöÑÊòØziplist,ÂÖ∂‰ªñÊó∂ÂÄôÂàôÊòØ‰ΩøÁî®skiplist</p>
<ul>
<li>ÊúâÂ∫èÈõÜÂêà‰øùÂ≠òÁöÑÂÖÉÁ¥†Êï∞ÈáèÂ∞è‰∫é128‰∏™</li>
<li>ÊúâÂ∫èÈõÜÂêà‰øùÂ≠òÁöÑÊâÄÊúâÂÖÉÁ¥†ÁöÑÈïøÂ∫¶Â∞è‰∫é64Â≠óËäÇ</li>
</ul>
<p>ÂΩìziplist‰Ωú‰∏∫Â≠òÂÇ®ÁªìÊûÑÊó∂ÂÄô,ÊØè‰∏™ÈõÜÂêàÂÖÉÁ¥†‰ΩøÁî®‰∏§‰∏™Á¥ßÊå®Âú®‰∏ÄËµ∑ÁöÑÂéãÁº©ÂàóË°®ÁªìÁÇπÊù•‰øùÂ≠ò,Á¨¨‰∏Ä‰∏™ËäÇÁÇπ‰øùÂ≠òÂÖÉÁ¥†ÁöÑÊàêÂëò,Á¨¨‰∫å‰∏™ÂÖÉÁ¥†‰øùÂ≠òÂÖÉÁ¥†ÁöÑÂàÜÂÄº.</p>
<p>ÂΩì‰ΩøÁî®skiplist‰Ωú‰∏∫Â≠òÂÇ®ÁªìÊûÑÊó∂,‰ΩøÁî®skiplistÊåâÂ∫è‰øùÂ≠òÂÖÉÁ¥†ÂàÜÂÄº,‰ΩøÁî®dictÊù•‰øùÂ≠òÂÖÉÁ¥†ÂíåÂàÜÂÄºÁöÑÂØπÂ∫îÂÖ≥Á≥ª</p>
<h2 id="1-Ë∑≥Ë∑ÉË°®">1 Ë∑≥Ë∑ÉË°®</h2>
<p>Ë∑≥Ë∑ÉË°®ÔºàskiplistÔºâÊòØ‰∏ÄÁßçÊúâÂ∫èÊï∞ÊçÆÁªìÊûÑÔºåÂÆÉÈÄöËøáÂú®ÊØè‰∏™ËäÇÁÇπ‰∏≠Áª¥ÊåÅÂ§ö‰∏™ÊåáÂêëÂÖ∂‰ªñËäÇÁÇπÁöÑÊåáÈíàÔºå‰ªéËÄåËææÂà∞Âø´ÈÄüËÆøÈóÆËäÇÁÇπÁöÑÁõÆÁöÑ„ÄÇË∑≥Ë∑ÉË°®ÊîØÊåÅÂπ≥ÂùáOÔºàlogNÔºâ„ÄÅÊúÄÂùèOÔºàNÔºâÂ§çÊùÇÂ∫¶ÁöÑËäÇÁÇπÊü•ÊâæÔºåËøòÂèØ‰ª•ÈÄöËøáÈ°∫Â∫èÊÄßÊìç‰ΩúÊù•ÊâπÈáèÂ§ÑÁêÜËäÇÁÇπ„ÄÇ</p>
<p>Âú®Â§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãÔºåË∑≥Ë∑ÉË°®ÁöÑÊïàÁéáÂèØ‰ª•ÂíåÂπ≥Ë°°Ê†ëÁõ∏Â™≤ÁæéÔºåÂπ∂‰∏îÂõ†‰∏∫Ë∑≥Ë∑ÉË°®ÁöÑÂÆûÁé∞ÊØîÂπ≥Ë°°Ê†ëË¶ÅÊù•ÂæóÊõ¥‰∏∫ÁÆÄÂçï„ÄÇ</p>
<p><strong>Redis‰ΩøÁî®Ë∑≥Ë∑ÉË°®‰Ωú‰∏∫ÊúâÂ∫èÈõÜÂêàÈîÆÁöÑÂ∫ïÂ±ÇÂÆûÁé∞‰πã‰∏ÄÔºåÂ¶ÇÊûú‰∏Ä‰∏™ÊúâÂ∫èÈõÜÂêàÂåÖÂê´ÁöÑÂÖÉÁ¥†Êï∞ÈáèÊØîËæÉÂ§öÔºåÂèàÊàñËÄÖÊúâÂ∫èÈõÜÂêà‰∏≠ÂÖÉÁ¥†ÁöÑÊàêÂëòÔºàmemberÔºâÊòØÊØîËæÉÈïøÁöÑÂ≠óÁ¨¶‰∏≤Êó∂ÔºåRedisÂ∞±‰ºö‰ΩøÁî®Ë∑≥Ë∑ÉË°®Êù•‰Ωú‰∏∫ÊúâÂ∫èÈõÜÂêàÈîÆÁöÑÂ∫ïÂ±ÇÂÆûÁé∞„ÄÇ</strong></p>
<p>RedisÂè™Âú®‰∏§‰∏™Âú∞ÊñπÁî®Âà∞‰∫ÜË∑≥Ë∑ÉË°®Ôºå‰∏Ä‰∏™ÊòØÂÆûÁé∞ÊúâÂ∫èÈõÜÂêàÈîÆÔºåÂè¶‰∏Ä‰∏™ÊòØÂú®ÈõÜÁæ§ËäÇÁÇπ‰∏≠Áî®‰ΩúÂÜÖÈÉ®Êï∞ÊçÆÁªìÊûÑÔºåÈô§Ê≠§‰πãÂ§ñÔºåË∑≥Ë∑ÉË°®Âú®RedisÈáåÈù¢Ê≤°ÊúâÂÖ∂‰ªñÁî®ÈÄî„ÄÇ</p>
<p>RedisÁöÑÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂÖ≥‰∫éÊúâÂ∫èÈõÜÂêàÂ∫ïÂ±ÇÂÆûÁé∞ÁöÑ‰∏§‰∏™ÈÖçÁΩÆ„ÄÇ
1Ôºâzset-max-ziplist-entries 128:zsetÈááÁî®ÂéãÁº©ÂàóË°®Êó∂ÔºåÂÖÉÁ¥†‰∏™Êï∞ÊúÄÂ§ßÂÄº„ÄÇÈªòËÆ§ÂÄº‰∏∫128„ÄÇ
2Ôºâzset-max-ziplist-value 64:zsetÈááÁî®ÂéãÁº©ÂàóË°®Êó∂ÔºåÊØè‰∏™ÂÖÉÁ¥†ÁöÑÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶ÊúÄÂ§ßÂÄº„ÄÇÈªòËÆ§ÂÄº‰∏∫64„ÄÇ
zsetÊèíÂÖ•Á¨¨‰∏Ä‰∏™ÂÖÉÁ¥†Êó∂Ôºå‰ºöÂà§Êñ≠‰∏ãÈù¢‰∏§ÁßçÊù°‰ª∂Ôºö</p>
<ul>
<li>zset-max-ziplist-entriesÁöÑÂÄºÊòØÂê¶Á≠â‰∫é0Ôºõ</li>
<li>zset-max-ziplist-valueÂ∞è‰∫éË¶ÅÊèíÂÖ•ÂÖÉÁ¥†ÁöÑÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶„ÄÇÊª°Ë∂≥‰ªª‰∏ÄÊù°‰ª∂RedisÂ∞±‰ºöÈááÁî®Ë∑≥Ë∑ÉË°®‰Ωú‰∏∫Â∫ïÂ±ÇÂÆûÁé∞ÔºåÂê¶ÂàôÈááÁî®ÂéãÁº©ÂàóË°®‰Ωú‰∏∫Â∫ïÂ±ÇÂÆûÁé∞ÊñπÂºè„ÄÇ</li>
</ul>
<p>‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºå‰∏ç‰ºöÂ∞Üzset-max-ziplist-entriesÈÖçÁΩÆÊàê0ÔºåÂÖÉÁ¥†ÁöÑÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶‰πü‰∏ç‰ºöÂ§™ÈïøÔºåÊâÄ‰ª•Âú®ÂàõÂª∫ÊúâÂ∫èÈõÜÂêàÊó∂ÔºåÈªòËÆ§‰ΩøÁî®ÂéãÁº©ÂàóË°®ÁöÑÂ∫ïÂ±ÇÂÆûÁé∞„ÄÇzsetÊñ∞ÊèíÂÖ•ÂÖÉÁ¥†Êó∂Ôºå‰ºöÂà§Êñ≠‰ª•‰∏ã‰∏§ÁßçÊù°‰ª∂Ôºö</p>
<ul>
<li>zset‰∏≠ÂÖÉÁ¥†‰∏™Êï∞Â§ß‰∫ézset_max_ziplist_entriesÔºõ</li>
<li>ÊèíÂÖ•ÂÖÉÁ¥†ÁöÑÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶Â§ß‰∫ézset_max_ziplist_value„ÄÇÂΩìÊª°Ë∂≥‰ªª‰∏ÄÊù°‰ª∂Êó∂ÔºåRedis‰æø‰ºöÂ∞ÜzsetÁöÑÂ∫ïÂ±ÇÂÆûÁé∞Áî±ÂéãÁº©ÂàóË°®ËΩ¨‰∏∫Ë∑≥Ë∑ÉË°®„ÄÇ</li>
</ul>
<blockquote>
<p>zsetÂú®ËΩ¨‰∏∫Ë∑≥Ë∑ÉË°®‰πãÂêéÔºåÂç≥‰ΩøÂÖÉÁ¥†Ë¢´ÈÄêÊ∏êÂà†Èô§Ôºå‰πü‰∏ç‰ºöÈáçÊñ∞ËΩ¨‰∏∫ÂéãÁº©ÂàóË°®„ÄÇ</p>
</blockquote>
<h2 id="2-Ë∑≥Ë∑ÉË°®ÁöÑÁªìÊûÑ">2 Ë∑≥Ë∑ÉË°®ÁöÑÁªìÊûÑ</h2>
<p>ÂÖ∂cËØ≠Ë®Ä‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> zskiplistNode {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//ÊàêÂëòÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    robj <span style="color:#f92672">*</span>obj;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> score;<span style="color:#75715e">//ÂàÜÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> zskiplistNode <span style="color:#f92672">*</span>backward;<span style="color:#75715e">//ÂõûÈÄÄÊåáÈíà
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//Â±Ç
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> zskiplistLevel {
</span></span><span style="display:flex;"><span>    	<span style="color:#75715e">//ÂâçËøõÊåáÈíà
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">struct</span> zskiplistNode <span style="color:#f92672">*</span>forward;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Ë∑®Â∫¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> span;
</span></span><span style="display:flex;"><span>    } level[];
</span></span><span style="display:flex;"><span>} zskiplistNode;
</span></span></code></pre></div><p>1ÔºâobjÔºöÁî®‰∫éÂ≠òÂÇ®Â≠óÁ¨¶‰∏≤Á±ªÂûãÁöÑÊï∞ÊçÆ„ÄÇ
2ÔºâscoreÔºöÁî®‰∫éÂ≠òÂÇ®ÊéíÂ∫èÁöÑÂàÜÂÄº„ÄÇ
3ÔºâbackwardÔºöÂêéÈÄÄÊåáÈíàÔºåÂè™ËÉΩÊåáÂêëÂΩìÂâçËäÇÁÇπÊúÄÂ∫ïÂ±ÇÁöÑÂâç‰∏Ä‰∏™ËäÇÁÇπÔºåÂ§¥ËäÇÁÇπÂíåÁ¨¨‰∏Ä‰∏™ËäÇÁÇπ‚Äî‚ÄîbackwardÊåáÂêëNULLÔºå‰ªéÂêéÂêëÂâçÈÅçÂéÜË∑≥Ë∑ÉË°®Êó∂‰ΩøÁî®„ÄÇ
4ÔºâlevelÔºö‰∏∫ÊüîÊÄßÊï∞ÁªÑ„ÄÇÊØè‰∏™ËäÇÁÇπÁöÑÊï∞ÁªÑÈïøÂ∫¶‰∏ç‰∏ÄÊ†∑ÔºåÂú®ÁîüÊàêË∑≥Ë∑ÉË°®ËäÇÁÇπÊó∂ÔºåÈöèÊú∫ÁîüÊàê‰∏Ä‰∏™1ÔΩû64ÁöÑÂÄºÔºåÂÄºË∂äÂ§ßÂá∫Áé∞ÁöÑÊ¶ÇÁéáË∂ä‰Ωé„ÄÇ
levelÊï∞ÁªÑÁöÑÊØèÈ°πÂåÖÂê´‰ª•‰∏ã‰∏§‰∏™ÂÖÉÁ¥†„ÄÇ</p>
<ul>
<li>forwardÔºöÊåáÂêëÊú¨Â±Ç‰∏ã‰∏Ä‰∏™ËäÇÁÇπÔºåÂ∞æËäÇÁÇπÁöÑforwardÊåáÂêëNULL„ÄÇ</li>
<li>span:forwardÊåáÂêëÁöÑËäÇÁÇπ‰∏éÊú¨ËäÇÁÇπ‰πãÈó¥ÁöÑÂÖÉÁ¥†‰∏™Êï∞„ÄÇspanÂÄºË∂äÂ§ßÔºåË∑≥ËøáÁöÑËäÇÁÇπ‰∏™Êï∞Ë∂äÂ§ö„ÄÇ</li>
</ul>
<p>Èô§‰∫ÜË∑≥Ë∑ÉË°®ËäÇÁÇπÂ§ñÔºåËøòÈúÄË¶Å‰∏Ä‰∏™Ë∑≥Ë∑ÉË°®ÁªìÊûÑÊù•ÁÆ°ÁêÜËäÇÁÇπÔºåRedis‰ΩøÁî®zskiplistÁªìÊûÑ‰ΩìÔºåÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> zskiplist {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> zskiplistNode <span style="color:#f92672">*</span>header, <span style="color:#f92672">*</span>tail;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> length;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> level;
</span></span><span style="display:flex;"><span>} zskiplist;
</span></span></code></pre></div><p>1ÔºâheaderÔºöÊåáÂêëË∑≥Ë∑ÉË°®Â§¥ËäÇÁÇπ„ÄÇÂ§¥ËäÇÁÇπÊòØË∑≥Ë∑ÉË°®ÁöÑ‰∏Ä‰∏™ÁâπÊÆäËäÇÁÇπÔºåÂÆÉÁöÑlevelÊï∞ÁªÑÂÖÉÁ¥†‰∏™Êï∞‰∏∫64„ÄÇÂ§¥ËäÇÁÇπÂú®ÊúâÂ∫èÈõÜÂêà‰∏≠‰∏çÂ≠òÂÇ®‰ªª‰ΩïmemberÂíåscoreÂÄºÔºåeleÂÄº‰∏∫NULL, scoreÂÄº‰∏∫0Ôºõ‰πü‰∏çËÆ°ÂÖ•Ë∑≥Ë∑ÉË°®ÁöÑÊÄªÈïøÂ∫¶„ÄÇÂ§¥ËäÇÁÇπÂú®ÂàùÂßãÂåñÊó∂Ôºå64‰∏™ÂÖÉÁ¥†ÁöÑforwardÈÉΩÊåáÂêëNULL, spanÂÄºÈÉΩ‰∏∫0„ÄÇ
2ÔºâtailÔºöÊåáÂêëË∑≥Ë∑ÉË°®Â∞æËäÇÁÇπ„ÄÇ
3ÔºâlengthÔºöË∑≥Ë∑ÉË°®ÈïøÂ∫¶ÔºåË°®Á§∫Èô§Â§¥ËäÇÁÇπ‰πãÂ§ñÁöÑËäÇÁÇπÊÄªÊï∞„ÄÇ
4ÔºâlevelÔºöË∑≥Ë∑ÉË°®ÁöÑÈ´òÂ∫¶„ÄÇ</p>
<p><img src="https://cdn.jsdelivr.net/gh/lxbwolf/blog_source_image@main/20220212210023.png"
	
	
	
	loading="lazy"
	
	
></p>
<blockquote>
<p>Êü•Êâæ‰ªéÊúÄÈ´òÂ±ÇÂºÄÂßãÔºåÂ¶ÇÊûúÊú¨Â±ÇÁöÑnextËäÇÁÇπÂ§ß‰∫éË¶ÅÊü•ÊâæÁöÑÂÄºÊàñnextËäÇÁÇπ‰∏∫NULLÔºåÂàô‰ªéÊú¨ËäÇÁÇπÂºÄÂßãÔºåÈôç‰Ωé‰∏ÄÂ±ÇÁªßÁª≠ÂêëÂêéÊü•ÊâæÔºå‰æùÊ¨°Á±ªÊé®ÔºåÂ¶ÇÊûúÊâæÂà∞ÂàôËøîÂõûËäÇÁÇπÔºõÂê¶ÂàôËøîÂõûNULL„ÄÇÈááÁî®ËØ•ÂéüÁêÜÊü•ÊâæËäÇÁÇπÔºåÂú®ËäÇÁÇπÊï∞ÈáèÊØîËæÉÂ§öÊó∂ÔºåÂèØ‰ª•Ë∑≥Ëøá‰∏Ä‰∫õËäÇÁÇπÔºåÊü•ËØ¢ÊïàÁéáÂ§ßÂ§ßÊèêÂçáÔºåËøôÂ∞±ÊòØË∑≥Ë∑ÉË°®ÁöÑÂü∫Êú¨ÊÄùÊÉ≥„ÄÇ</p>
</blockquote>
<p>1ÔºâË∑≥Ë∑ÉË°®Áî±ÂæàÂ§öÂ±ÇÊûÑÊàê„ÄÇ
2ÔºâË∑≥Ë∑ÉË°®Êúâ‰∏Ä‰∏™Â§¥ÔºàheaderÔºâËäÇÁÇπÔºåÂ§¥ËäÇÁÇπ‰∏≠Êúâ‰∏Ä‰∏™64Â±ÇÁöÑÁªìÊûÑÔºåÊØèÂ±ÇÁöÑÁªìÊûÑÂåÖÂê´ÊåáÂêëÊú¨Â±ÇÁöÑ‰∏ã‰∏™ËäÇÁÇπÁöÑÊåáÈíàÔºåÊåáÂêëÊú¨Â±Ç‰∏ã‰∏™ËäÇÁÇπ‰∏≠Èó¥ÊâÄË∑®Ë∂äÁöÑËäÇÁÇπ‰∏™Êï∞‰∏∫Êú¨Â±ÇÁöÑË∑®Â∫¶ÔºàspanÔºâ„ÄÇ
3ÔºâÈô§Â§¥ËäÇÁÇπÂ§ñÔºåÂ±ÇÊï∞ÊúÄÂ§öÁöÑËäÇÁÇπÁöÑÂ±ÇÈ´ò‰∏∫Ë∑≥Ë∑ÉË°®ÁöÑÈ´òÂ∫¶ÔºàlevelÔºâ
4ÔºâÊØèÂ±ÇÈÉΩÊòØ‰∏Ä‰∏™ÊúâÂ∫èÈìæË°®ÔºåÊï∞ÊçÆÈÄíÂ¢û„ÄÇ
5ÔºâÈô§headerËäÇÁÇπÂ§ñÔºå‰∏Ä‰∏™ÂÖÉÁ¥†Âú®‰∏äÂ±ÇÊúâÂ∫èÈìæË°®‰∏≠Âá∫Áé∞ÔºåÂàôÂÆÉ‰∏ÄÂÆö‰ºöÂú®‰∏ãÂ±ÇÊúâÂ∫èÈìæË°®‰∏≠Âá∫Áé∞„ÄÇ
6ÔºâË∑≥Ë∑ÉË°®ÊØèÂ±ÇÊúÄÂêé‰∏Ä‰∏™ËäÇÁÇπÊåáÂêëNULLÔºåË°®Á§∫Êú¨Â±ÇÊúâÂ∫èÈìæË°®ÁöÑÁªìÊùü„ÄÇ
7ÔºâË∑≥Ë∑ÉË°®Êã•Êúâ‰∏Ä‰∏™tailÊåáÈíàÔºåÊåáÂêëË∑≥Ë∑ÉË°®ÊúÄÂêé‰∏Ä‰∏™ËäÇÁÇπ„ÄÇ
8ÔºâÊúÄÂ∫ïÂ±ÇÁöÑÊúâÂ∫èÈìæË°®ÂåÖÂê´ÊâÄÊúâËäÇÁÇπÔºåÊúÄÂ∫ïÂ±ÇÁöÑËäÇÁÇπ‰∏™Êï∞‰∏∫Ë∑≥Ë∑ÉË°®ÁöÑÈïøÂ∫¶ÔºàlengthÔºâÔºà‰∏çÂåÖÊã¨Â§¥ËäÇÁÇπÔºâ„ÄÇ
9ÔºâÊØè‰∏™ËäÇÁÇπÂåÖÂê´‰∏Ä‰∏™ÂêéÈÄÄÊåáÈíàÔºåÂ§¥ËäÇÁÇπÂíåÁ¨¨‰∏Ä‰∏™ËäÇÁÇπÊåáÂêëNULLÔºõÂÖ∂‰ªñËäÇÁÇπÊåáÂêëÊúÄÂ∫ïÂ±ÇÁöÑÂâç‰∏Ä‰∏™ËäÇÁÇπ„ÄÇ</p>
<blockquote>
<p>RedisÈÄöËøázslRandomLevelÂáΩÊï∞ÈöèÊú∫ÁîüÊàê‰∏Ä‰∏™1ÔΩû64ÁöÑÂÄº‰Ωú‰∏∫Êñ∞Âª∫ËäÇÁÇπÁöÑÈ´òÂ∫¶</p>
</blockquote>
<h2 id="3-ÂéãÁº©ÂàóË°®">3 ÂéãÁº©ÂàóË°®</h2>
<p>ÂéãÁº©ÂàóË°®ziplistÊú¨Ë¥®‰∏äÂ∞±ÊòØ‰∏Ä‰∏™Â≠óËäÇÊï∞ÁªÑÔºåÊòØRedis‰∏∫‰∫ÜËäÇÁ∫¶ÂÜÖÂ≠òËÄåËÆæËÆ°ÁöÑ‰∏ÄÁßçÁ∫øÊÄßÊï∞ÊçÆÁªìÊûÑÔºåÂèØ‰ª•ÂåÖÂê´Â§ö‰∏™ÂÖÉÁ¥†ÔºåÊØè‰∏™ÂÖÉÁ¥†ÂèØ‰ª•ÊòØ‰∏Ä‰∏™Â≠óËäÇÊï∞ÁªÑÊàñ‰∏Ä‰∏™Êï¥Êï∞„ÄÇ</p>
<blockquote>
<p>RedisÁöÑÊúâÂ∫èÈõÜÂêà„ÄÅÊï£ÂàóÂíåÂàóË°®ÈÉΩÁõ¥Êé•ÊàñËÄÖÈó¥Êé•‰ΩøÁî®‰∫ÜÂéãÁº©ÂàóË°®„ÄÇÂΩìÊúâÂ∫èÈõÜÂêàÊàñÊï£ÂàóË°®ÁöÑÂÖÉÁ¥†‰∏™Êï∞ÊØîËæÉÂ∞ëÔºå‰∏îÂÖÉÁ¥†ÈÉΩÊòØÁü≠Â≠óÁ¨¶‰∏≤Êó∂ÔºåRedis‰æø‰ΩøÁî®ÂéãÁº©ÂàóË°®‰Ωú‰∏∫ÂÖ∂Â∫ïÂ±ÇÊï∞ÊçÆÂ≠òÂÇ®ÁªìÊûÑ„ÄÇÂàóË°®‰ΩøÁî®Âø´ÈÄüÈìæË°®ÔºàquicklistÔºâÊï∞ÊçÆÁªìÊûÑÂ≠òÂÇ®ÔºåËÄåÂø´ÈÄüÈìæË°®Â∞±ÊòØÂèåÂêëÈìæË°®‰∏éÂéãÁº©ÂàóË°®ÁöÑÁªÑÂêà„ÄÇ</p>
</blockquote>
<p>‰∏Ä‰∏™ÂéãÁº©ÂàóË°®ÂèØ‰ª•ÂåÖÂê´‰ªªÊÑèÂ§ö‰∏™ËäÇÁÇπÔºàentryÔºâÔºå<strong>ÊØè‰∏™ËäÇÁÇπÂèØ‰ª•‰øùÂ≠ò‰∏Ä‰∏™Â≠óËäÇÊï∞ÁªÑÊàñËÄÖ‰∏Ä‰∏™Êï¥Êï∞ÂÄº„ÄÇ</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/lxbwolf/blog_source_image@main/20220212210219.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>1ÔºâzlbytesÔºöÂéãÁº©ÂàóË°®ÁöÑÂ≠óËäÇÈïøÂ∫¶ÔºåÂç†4‰∏™Â≠óËäÇÔºåÂõ†Ê≠§ÂéãÁº©ÂàóË°®ÊúÄÂ§öÊúâ232-1‰∏™Â≠óËäÇ„ÄÇ
2ÔºâzltailÔºöÂéãÁº©ÂàóË°®Â∞æÂÖÉÁ¥†Áõ∏ÂØπ‰∫éÂéãÁº©ÂàóË°®Ëµ∑ÂßãÂú∞ÂùÄÁöÑÂÅèÁßªÈáèÔºåÂç†4‰∏™Â≠óËäÇ„ÄÇ3ÔºâzllenÔºöÂéãÁº©ÂàóË°®ÁöÑÂÖÉÁ¥†‰∏™Êï∞ÔºåÂç†2‰∏™Â≠óËäÇ„ÄÇzllenÊó†Ê≥ïÂ≠òÂÇ®ÂÖÉÁ¥†‰∏™Êï∞Ë∂ÖËøá65535Ôºà216-1ÔºâÁöÑÂéãÁº©ÂàóË°®ÔºåÂøÖÈ°ªÈÅçÂéÜÊï¥‰∏™ÂéãÁº©ÂàóË°®ÊâçËÉΩËé∑ÂèñÂà∞ÂÖÉÁ¥†‰∏™Êï∞„ÄÇ4ÔºâentryXÔºöÂéãÁº©ÂàóË°®Â≠òÂÇ®ÁöÑÂÖÉÁ¥†ÔºåÂèØ‰ª•ÊòØÂ≠óËäÇÊï∞ÁªÑÊàñËÄÖÊï¥Êï∞ÔºåÈïøÂ∫¶‰∏çÈôê„ÄÇentryÁöÑÁºñÁ†ÅÁªìÊûÑÂ∞ÜÂú®ÂêéÈù¢ËØ¶ÁªÜ‰ªãÁªç„ÄÇ
5ÔºâzlendÔºöÂéãÁº©ÂàóË°®ÁöÑÁªìÂ∞æÔºåÂç†1‰∏™Â≠óËäÇÔºåÊÅí‰∏∫0xFF„ÄÇ</p>
<p>ËÄåÂéãÁº©ÂàóË°®ÂÖÉÁ¥†(entry)ÁöÑÁºñÁ†ÅÁªìÊûÑÔºö
<img src="https://cdn.jsdelivr.net/gh/lxbwolf/blog_source_image@main/20220212210255.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>previous_entry_lengthÂ≠óÊÆµË°®Á§∫Ââç‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÂ≠óËäÇÈïøÂ∫¶
Âç†1‰∏™ÊàñËÄÖ5‰∏™Â≠óËäÇÔºåÂΩìÂâç‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÈïøÂ∫¶Â∞è‰∫é254Â≠óËäÇÊó∂ÔºåÁî®1‰∏™Â≠óËäÇË°®Á§∫ÔºõÂΩìÂâç‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑÈïøÂ∫¶Â§ß‰∫éÊàñÁ≠â‰∫é254Â≠óËäÇÊó∂ÔºåÁî®5‰∏™Â≠óËäÇÊù•Ë°®Á§∫„ÄÇ</li>
<li>encodingÂ≠óÊÆµË°®Á§∫ÂΩìÂâçÂÖÉÁ¥†ÁöÑÁºñÁ†Å</li>
<li>Êï∞ÊçÆÂÜÖÂÆπÂ≠òÂÇ®Âú®contentÂ≠óÊÆµ</li>
</ul>
<p>ÂÖ∂‰∏≠ÂåÖÂê´‰∫ÜÂæàÂ§öÂ§çÊùÇÁöÑËß£Á†ÅËøêÁÆóÔºåÊÉ≥ËØ¶ÁªÜ‰∫ÜËß£ÁöÑÂèØ‰ª•ÊâæÂØπÂ∫îÁöÑ‰π¶Êù•Áúã„ÄÇ</p>
<h3 id="ËøûÈîÅÊõ¥Êñ∞">ËøûÈîÅÊõ¥Êñ∞</h3>
<p>ÊØè‰∏™ËäÇÁÇπÁöÑprevious_entry_lengthÂ±ûÊÄßÈÉΩËÆ∞ÂΩï‰∫ÜÂâç‰∏Ä‰∏™ËäÇÁÇπÁöÑÈïøÂ∫¶ÔºåÊ∑ªÂä†Êñ∞ËäÇÁÇπÂèØËÉΩ‰ºöÂºïÂèëËøûÈîÅÊõ¥Êñ∞‰πãÂ§ñÔºåÂà†Èô§ËäÇÁÇπ‰πüÂèØËÉΩ‰ºöÂºïÂèëËøûÈîÅÊõ¥Êñ∞„ÄÇ
Âõ†‰∏∫Êüê‰∏™ÂèØËÉΩÁöÑÁªìÁÇπprevious_entry_lengthÂ±ûÊÄß‰ªÖÈïø1Â≠óËäÇÔºåÂÆÉÊ≤°ÂäûÊ≥ï‰øùÂ≠òÊñ∞ËäÇÁÇπnewÁöÑÈïøÂ∫¶ÔºåÊâÄ‰ª•Á®ãÂ∫èÂ∞ÜÂØπÂéãÁº©ÂàóË°®ÊâßË°åÁ©∫Èó¥ÈáçÂàÜÈÖçÊìç‰ΩúÔºåÂπ∂Â∞ÜÂàô‰∏™ËäÇÁÇπÁöÑprevious_entry_lengthÂ±ûÊÄß‰ªéÂéüÊù•ÁöÑ1Â≠óËäÇÈïøÊâ©Â±ï‰∏∫5Â≠óËäÇÈïø„ÄÇËøõËÄåÂºïÂèëÂêéÈù¢ÁöÑËøûÈîÅÊõ¥Êñ∞„ÄÇ
ÂÖ∂ÊúÄÂùèÂ§çÊùÇÂ∫¶ÊòØOÔºàN 2Ôºâ„ÄÇ</p>
<p>Â∞ΩÁÆ°ËøûÈîÅÊõ¥Êñ∞ÁöÑÂ§çÊùÇÂ∫¶ËæÉÈ´òÔºå‰ΩÜÂÆÉÁúüÊ≠£ÈÄ†ÊàêÊÄßËÉΩÈóÆÈ¢òÁöÑÂá†ÁéáÊòØÂæà‰ΩéÁöÑÔºö</p>
<p>ÂéãÁº©ÂàóË°®ÈáåË¶ÅÊÅ∞Â•ΩÊúâÂ§ö‰∏™ËøûÁª≠ÁöÑ„ÄÅÈïøÂ∫¶‰ªã‰∫é250Â≠óËäÇËá≥253Â≠óËäÇ‰πãÈó¥ÁöÑËäÇÁÇπÔºåËøûÈîÅÊõ¥Êñ∞ÊâçÊúâÂèØËÉΩË¢´ÂºïÂèëÔºåÂú®ÂÆûÈôÖ‰∏≠ÔºåËøôÁßçÊÉÖÂÜµÂπ∂‰∏çÂ§öËßÅÔºõ
Âç≥‰ΩøÂá∫Áé∞ËøûÈîÅÊõ¥Êñ∞Ôºå‰ΩÜÂè™Ë¶ÅË¢´Êõ¥Êñ∞ÁöÑËäÇÁÇπÊï∞Èáè‰∏çÂ§öÔºåÂ∞±‰∏ç‰ºöÂØπÊÄßËÉΩÈÄ†Êàê‰ªª‰ΩïÂΩ±ÂìçÔºöÊØîÂ¶ÇËØ¥ÔºåÂØπ‰∏â‰∫î‰∏™ËäÇÁÇπËøõË°åËøûÈîÅÊõ¥Êñ∞ÊòØÁªùÂØπ‰∏ç‰ºöÂΩ±ÂìçÊÄßËÉΩÁöÑÔºõ</p>
<h2 id="4-quicklist">4 quicklist</h2>
<p>quicklistÊòØRedisÂ∫ïÂ±ÇÊúÄÈáçË¶ÅÁöÑÊï∞ÊçÆÁªìÊûÑ‰πã‰∏ÄÔºåÂÆÉÊòØRedisÂØπÂ§ñÊèê‰æõÁöÑ6ÁßçÂü∫Êú¨Êï∞ÊçÆÁªìÊûÑ‰∏≠ListÁöÑÂ∫ïÂ±ÇÂÆûÁé∞ÔºåÂú®Redis 3.2ÁâàÊú¨‰∏≠ÂºïÂÖ•„ÄÇ</p>
<p>Âú®ÂºïÂÖ•quicklist‰πãÂâçÔºåRedisÈááÁî®ÂéãÁº©ÈìæË°®ÔºàziplistÔºâ‰ª•ÂèäÂèåÂêëÈìæË°®ÔºàadlistÔºâ‰Ωú‰∏∫ListÁöÑÂ∫ïÂ±ÇÂÆûÁé∞„ÄÇÂΩìÂÖÉÁ¥†‰∏™Êï∞ÊØîËæÉÂ∞ëÂπ∂‰∏îÂÖÉÁ¥†ÈïøÂ∫¶ÊØîËæÉÂ∞èÊó∂ÔºåRedisÈááÁî®ziplist‰Ωú‰∏∫ÂÖ∂Â∫ïÂ±ÇÂ≠òÂÇ®ÔºõÂΩì‰ªªÊÑè‰∏Ä‰∏™Êù°‰ª∂‰∏çÊª°Ë∂≥Êó∂ÔºåRedisÈááÁî®adlist‰Ωú‰∏∫Â∫ïÂ±ÇÂ≠òÂÇ®ÁªìÊûÑ„ÄÇ</p>
<p>Ëøô‰πàÂÅöÁöÑ‰∏ªË¶ÅÂéüÂõ†ÊòØÔºåÂΩìÂÖÉÁ¥†ÈïøÂ∫¶ËæÉÂ∞èÊó∂ÔºåÈááÁî®ziplistÂèØ‰ª•ÊúâÊïàËäÇÁúÅÂ≠òÂÇ®Á©∫Èó¥Ôºå‰ΩÜziplistÁöÑÂ≠òÂÇ®Á©∫Èó¥ÊòØËøûÁª≠ÁöÑÔºåÂΩìÂÖÉÁ¥†‰∏™Êï∞ÊØîËæÉÂ§öÊó∂Ôºå‰øÆÊîπÂÖÉÁ¥†Êó∂ÔºåÂøÖÈ°ªÈáçÊñ∞ÂàÜÈÖçÂ≠òÂÇ®Á©∫Èó¥ÔºåËøôÊó†Áñë‰ºöÂΩ±ÂìçRedisÁöÑÊâßË°åÊïàÁéáÔºåÊïÖËÄåÈááÁî®‰∏ÄËà¨ÁöÑÂèåÂêëÈìæË°®„ÄÇ</p>
<p>ÁªìÊûÑÂ¶Ç‰∏ãÔºö
<img src="https://cdn.jsdelivr.net/gh/lxbwolf/blog_source_image@main/20220212210432.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>‰ª£Á†ÅÂ¶Ç‰∏ã</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> quicklist{
</span></span><span style="display:flex;"><span>	quicklistNode <span style="color:#f92672">*</span>head;
</span></span><span style="display:flex;"><span>	quicklistNode <span style="color:#f92672">*</span>tail;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> count;<span style="color:#75715e">//quicklist‰∏≠ÂÖÉÁ¥†ÊÄªÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> len;<span style="color:#75715e">//quicklist NodeÔºàËäÇÁÇπÔºâ‰∏™Êï∞
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> fill : <span style="color:#ae81ff">16</span>;<span style="color:#75715e">//ÊØè‰∏™quicklistNode‰∏≠ziplistÈïøÂ∫¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}quicklist;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> quicklistNode{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> quicklistNode <span style="color:#f92672">*</span>prev;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> quicklistNode <span style="color:#f92672">*</span>next;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>zl;<span style="color:#75715e">//zlÊåáÂêëËØ•ËäÇÁÇπÂØπÂ∫îÁöÑziplistÁªìÊûÑÔºõ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> sz;<span style="color:#75715e">//Êï¥‰∏™ziplistÁªìÊûÑÁöÑÂ§ßÂ∞è
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> count:<span style="color:#ae81ff">16</span>;<span style="color:#75715e">//ziplistÁöÑ‰∏™Êï∞
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> coding<span style="color:#960050;background-color:#1e0010">Ôºö</span><span style="color:#ae81ff">2</span>;<span style="color:#75715e">//1‰ª£Ë°®ÊòØÂéüÁîüÁöÑÔºå2‰ª£Ë°®‰ΩøÁî®LZFËøõË°åÂéãÁº©Ôºõ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> containnr<span style="color:#960050;background-color:#1e0010">Ôºö</span><span style="color:#ae81ff">2</span>;<span style="color:#75715e">//container‰∏∫quicklistNodeËäÇÁÇπzlÊåáÂêëÁöÑÂÆπÂô®Á±ªÂûãÔºö1‰ª£Ë°®none,2‰ª£Ë°®‰ΩøÁî®ziplistÂ≠òÂÇ®Êï∞ÊçÆÔºõ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> recompress:<span style="color:#ae81ff">1</span>;<span style="color:#75715e">//recompress‰ª£Ë°®Ëøô‰∏™ËäÇÁÇπ‰πãÂâçÊòØÂê¶ÊòØÂéãÁº©ËäÇÁÇπ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> extra:<span style="color:#ae81ff">10</span>;<span style="color:#75715e">//extra‰∏∫È¢ÑÁïô
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}quicklistNode;
</span></span></code></pre></div><h3 id="Êï∞ÊçÆÂéãÁº©">Êï∞ÊçÆÂéãÁº©</h3>
<p>quicklistÊØè‰∏™ËäÇÁÇπÁöÑÂÆûÈôÖÊï∞ÊçÆÂ≠òÂÇ®ÁªìÊûÑ‰∏∫ziplistÔºåËøôÁßçÁªìÊûÑÁöÑ‰∏ªË¶Å‰ºòÂäøÂú®‰∫éËäÇÁúÅÂ≠òÂÇ®Á©∫Èó¥„ÄÇ‰∏∫‰∫ÜËøõ‰∏ÄÊ≠•Èôç‰ΩéziplistÊâÄÂç†Áî®ÁöÑÁ©∫Èó¥ÔºåRedisÂÖÅËÆ∏ÂØπziplistËøõ‰∏ÄÊ≠•ÂéãÁº©ÔºåRedisÈááÁî®ÁöÑÂéãÁº©ÁÆóÊ≥ïÊòØLZFÔºåÂéãÁº©ËøáÂêéÁöÑÊï∞ÊçÆÂèØ‰ª•ÂàÜÊàêÂ§ö‰∏™ÁâáÊÆµÔºåÊØè‰∏™ÁâáÊÆµÊúâ2ÈÉ®ÂàÜÔºö‰∏ÄÈÉ®ÂàÜÊòØËß£ÈáäÂ≠óÊÆµÔºåÂè¶‰∏ÄÈÉ®ÂàÜÊòØÂ≠òÊîæÂÖ∑‰ΩìÁöÑÊï∞ÊçÆÂ≠óÊÆµ„ÄÇ
Ëß£ÈáäÂ≠óÊÆµÂèØ‰ª•Âç†Áî®1ÔΩû3‰∏™Â≠óËäÇÔºåÊï∞ÊçÆÂ≠óÊÆµÂèØËÉΩ‰∏çÂ≠òÂú®„ÄÇ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> quicklistLZF{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> sz;<span style="color:#75715e">//szË°®Á§∫compressedÊâÄÂç†Â≠óËäÇÂ§ßÂ∞è
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">char</span> compress[];
</span></span><span style="display:flex;"><span>}quicklistLZF;
</span></span></code></pre></div><p>Ëß£ÈáäÂ≠óÊÆµÊúâ3Áßç:
1ÔºâÂ≠óÈù¢ÂûãÔºåËß£ÈáäÂ≠óÊÆµÂç†Áî®1‰∏™Â≠óËäÇÔºåÊï∞ÊçÆÂ≠óÊÆµÈïøÂ∫¶Áî±Ëß£ÈáäÂ≠óÊÆµÂêé5‰ΩçÂÜ≥ÂÆö„ÄÇ
2ÔºâÁÆÄÁü≠ÈáçÂ§çÂûãÔºåËß£ÈáäÂ≠óÊÆµÂç†Áî®2‰∏™Â≠óËäÇÔºåÊ≤°ÊúâÊï∞ÊçÆÂ≠óÊÆµÔºåÊï∞ÊçÆÂÜÖÂÆπ‰∏éÂâçÈù¢Êï∞ÊçÆÂÜÖÂÆπÈáçÂ§çÔºåÈáçÂ§çÈïøÂ∫¶Â∞è‰∫é8„ÄÇ
3ÔºâÊâπÈáèÈáçÂ§çÂûãÔºåËß£ÈáäÂ≠óÊÆµÂç†3‰∏™Â≠óËäÇÔºåÊ≤°ÊúâÊï∞ÊçÆÂ≠óÊÆµÔºåÊï∞ÊçÆÂÜÖÂÆπ‰∏éÂâçÈù¢ÂÜÖÂÆπÈáçÂ§ç„ÄÇ</p>
<p>ÂéãÁº©Ôºö
Êï∞ÊçÆ‰∏éÂâçÈù¢ÈáçÂ§çÁöÑÔºåËÆ∞ÂΩïÈáçÂ§ç‰ΩçÁΩÆ‰ª•ÂèäÈáçÂ§çÈïøÂ∫¶ÔºåÂê¶ÂàôÁõ¥Êé•ËÆ∞ÂΩïÂéüÂßãÊï∞ÊçÆÂÜÖÂÆπ„ÄÇÂéãÁº©ÁÆóÊ≥ïÁöÑÊµÅÁ®ãÂ¶Ç‰∏ãÔºöÈÅçÂéÜËæìÂÖ•Â≠óÁ¨¶‰∏≤ÔºåÂØπÂΩìÂâçÂ≠óÁ¨¶ÂèäÂÖ∂ÂêéÈù¢2‰∏™Â≠óÁ¨¶ËøõË°åÊï£ÂàóËøêÁÆóÔºåÂ¶ÇÊûúÂú®HashË°®‰∏≠ÊâæÂà∞ÊõæÁªèÂá∫Áé∞ÁöÑËÆ∞ÂΩïÔºåÂàôËÆ°ÁÆóÈáçÂ§çÂ≠óËäÇÁöÑÈïøÂ∫¶‰ª•Âèä‰ΩçÁΩÆÔºåÂèç‰πãÁõ¥Êé•ËæìÂá∫Êï∞ÊçÆ„ÄÇ
Ëß£ÂéãÔºö
ÂèØËÉΩÂ≠òÂú®ÈáçÂ§çÊï∞ÊçÆ‰∏éÂΩìÂâç‰ΩçÁΩÆÈáçÂè†ÁöÑÊÉÖÂÜµÔºå‰æãÂ¶ÇÂú®ÂΩìÂâç‰ΩçÁΩÆÂâçÁöÑ15‰∏™Â≠óËäÇÂ§ÑÔºåÈáçÂ§ç‰∫Ü20‰∏™Â≠óËäÇÔºåÊ≠§Êó∂ÈúÄË¶ÅÊåâ‰ΩçÈÄê‰∏™Â§çÂà∂„ÄÇ</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/9106c914/">
        
        

        <div class="article-details">
            <h2 class="article-title">RedisÁöÑÁ∫øÁ®ãÊ®°Âûã</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/f885fe0f/">
        
        

        <div class="article-details">
            <h2 class="article-title">RedisÊåÅ‰πÖÂåñÊú∫Âà∂</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/e98e0a2b/">
        
        

        <div class="article-details">
            <h2 class="article-title">redis Ë∑≥Ë°®ÂàÜÊûêÂπ∂Áî® Go ÂÆûÁé∞</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/7db296fb/">
        
        

        <div class="article-details">
            <h2 class="article-title">ÂàÜÂ∏ÉÂºèÈîÅÈ´òÂπ∂Âèë‰ºòÂåñ</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/9f188831/">
        
        

        <div class="article-details">
            <h2 class="article-title">Redis Á¨îËÆ∞</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="lxbwolf/lxbwolf.github.io"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2023 Xiaobin&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
