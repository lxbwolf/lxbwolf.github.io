<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Xiaobin&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://lxb.wiki/"/>
  <updated>2020-11-16T13:24:50.114Z</updated>
  <id>https://lxb.wiki/</id>
  
  <author>
    <name>Xiaobin.Liu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>目录切换：dirs、pushd、popd命令</title>
    <link href="https://lxb.wiki/1ca354f7/"/>
    <id>https://lxb.wiki/1ca354f7/</id>
    <published>2020-11-01T13:05:57.000Z</published>
    <updated>2020-11-16T13:24:50.114Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#目录栈指令">目录栈指令</a><ul><li><a href="#1-dirs">1 dirs</a><ul><li><a href="#11-功能">1.1 功能</a></li><li><a href="#12-语法">1.2 语法</a></li></ul></li><li><a href="#2-pushd">2 pushd</a><ul><li><a href="#21-功能">2.1 功能</a></li><li><a href="#22-语法">2.2 语法</a></li></ul></li><li><a href="#3-popd">3 popd</a><ul><li><a href="#31-功能">3.1 功能</a></li><li><a href="#32-语法">3.2 语法</a></li></ul></li><li><a href="#4-示例">4 示例</a></li></ul></li></ul><!-- tocstop --><h2 id="目录栈指令"><span id="目录栈指令">目录栈指令</span></h2><p>目录栈是用户最近访问过的系统目录列表，并以堆栈的形式管理。栈中的内容与Shell环境变量 <code>DIRSTACK</code> 的值对应</p><h3 id="1-dirs"><span id="1-dirs">1 dirs</span></h3><h4 id="11-功能"><span id="11-功能">1.1 功能</span></h4><p>显示当前目录栈中的所有记录（不带参数的dirs命令显示当前目录栈中的记录）</p><h4 id="12-语法"><span id="12-语法">1.2 语法</span></h4><p><strong>格式：</strong></p><p><code>dirs [-clpv] [+n] [-n]</code></p><p><strong>选项</strong></p><ul><li>-c  删除目录栈中的所有记录</li><li>-l   以完整格式显示(绝对路径)</li><li>-p  一个目录一行的方式显示</li><li>-v  每行一个目录来显示目录栈的内容，每个目录前加上的编号</li><li>+N 显示从左到右的第n个目录，数字从0开始</li><li>-N  显示从右到左的第n个日录，数字从0开始</li></ul><p>注意：dirs始终显示当人们目录, 再是堆栈中的内容；即使目录堆栈为空, dirs命令仍然只显示当前目录</p><h3 id="2-pushd"><span id="2-pushd">2 pushd</span></h3><h4 id="21-功能"><span id="21-功能">2.1 功能</span></h4><p>将目录加入到栈顶部，并切换到该目录；若 <code>pushd</code> 命令不加任何参数，则会将位于记录栈最上面的2个目录对换位置</p><h4 id="22-语法"><span id="22-语法">2.2 语法</span></h4><p><strong>格式：</strong></p><p><code>pushd [目录 | -N | +N]  [-n]</code></p><p><strong>选项</strong></p><ul><li>目录  将该目录加入到栈顶，并执行”cd 目录”，切换到该目录</li><li>+N  将第N个目录移至栈顶（从左边数起，数字从0开始）</li><li>-N  将第N个目录移至栈顶（从右边数起，数字从0开始）</li><li>-n  将目录入栈时，不切换目录</li></ul><h3 id="3-popd"><span id="3-popd">3 popd</span></h3><h4 id="31-功能"><span id="31-功能">3.1 功能</span></h4><p>删除目录栈中的记录；如果popd命令不加任何参数，则会先删除目录栈最上面的记录，然后切换到删除过后的目录栈中的最上面的目录</p><h4 id="32-语法"><span id="32-语法">3.2 语法</span></h4><p><strong>格式：</strong></p><p><code>pushd [-N | +N]  [-n]</code></p><p><strong>选项</strong></p><ul><li>+N  将第N个目录删除（从左边数起，数字从0开始）</li><li>-N  将第N个目录删除（从右边数起，数字从0开始）</li><li>-n  将目录出栈时，不切换目录</li></ul><h3 id="4-示例"><span id="4-示例">4 示例</span></h3><p><strong>入栈与出栈</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@root]:~<span class="comment"># mkdir /root/dir&#123;1,2,3,4&#125;</span></span><br><span class="line">[root@root]:~<span class="comment"># for ((i=1;i&lt;=4;i++)); do pushd /root/dir$&#123;i&#125;; done</span></span><br><span class="line">/root/dir1 ~</span><br><span class="line">/root/dir2 /root/dir1 ~</span><br><span class="line">/root/dir3 /root/dir2 /root/dir1 ~</span><br><span class="line">/root/dir4 /root/dir3 /root/dir2 /root/dir1 ~</span><br><span class="line"></span><br><span class="line">[root@root:/root/dir4]<span class="comment"># dirs </span></span><br><span class="line">/root/dir4 /root/dir3 /root/dir2 /root/dir1 ~</span><br><span class="line"><span class="built_in">dirs</span>显出了栈中的所有目录</span><br><span class="line"></span><br><span class="line">[root@root:/root/dir4]<span class="comment"># popd（相当于popd +0）</span></span><br><span class="line">/root/dir3 /root/dir2 /root/dir1 ~</span><br><span class="line">[root@root:/root/dir3]<span class="comment"># dirs</span></span><br><span class="line">/root/dir3 /root/dir2 /root/dir1 ~</span><br><span class="line">可以看出/root/dir4目录已被清除，此时栈里已经没有了dir4目录，切当前目录切换为dir3</span><br><span class="line"></span><br><span class="line">[root@root:/root/dir3]<span class="comment"># pushd /root/dir4 </span></span><br><span class="line">/root/dir4 /root/dir3 /root/dir2 /root/dir1 ~</span><br><span class="line">[root@root:/root/dir4]</span><br><span class="line">不推荐以上面的方法进行切换，因为这种方式和<span class="built_in">cd</span>没有区别。</span><br><span class="line"></span><br><span class="line">[root@root:/root/dir4]<span class="comment"># popd +1</span></span><br><span class="line">/root/dir4 /root/dir2 /root/dir1 ~</span><br><span class="line">推荐以这种方式进行切换，尤其是目录层次比较多时</span><br><span class="line"></span><br><span class="line">[root@root:/root/dir4]<span class="comment"># popd -2</span></span><br><span class="line">/root/dir4 /root/dir1 ~</span><br><span class="line"></span><br><span class="line">[root@root:/root/dir2]<span class="comment"># pushd -1</span></span><br><span class="line">/root/dir1 ~ /root/dir2 /root/dir3 /root/dir4</span><br><span class="line">[root@root:/root/dir3]</span><br><span class="line">注意：最左边表示栈顶，最右边表示栈底</span><br></pre></td></tr></table></figure><p><strong>清空栈</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@root]:~<span class="comment"># dirs</span></span><br><span class="line">~ /root/dir2 /root/dir3 /root/dir4 /root/dir1</span><br><span class="line">[root@root]:~<span class="comment"># dirs -c</span></span><br><span class="line">[root@root](mailto:root@root):~<span class="comment"># dirs</span></span><br><span class="line">~</span><br></pre></td></tr></table></figure><p><strong>列表形式显示的栈的内容</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@root:/root/dir4]<span class="comment"># dirs -l -v</span></span><br><span class="line">0 /root/dir4</span><br><span class="line">1 /root/dir3</span><br><span class="line">2 /root/dir2</span><br><span class="line">3 /root/dir1</span><br><span class="line">4 /root</span><br></pre></td></tr></table></figure><p>注：如果只是两个目录之间的切换 <code>cd -</code>足矣，而且方便。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#目录栈指令&quot;&gt;目录栈指令&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-dirs&quot;&gt;1 dirs&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#11-功能&quot;&gt;1.1 功能&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="Shell" scheme="https://lxb.wiki/categories/Shell/"/>
    
    
      <category term="Shell" scheme="https://lxb.wiki/tags/Shell/"/>
    
      <category term="dirs" scheme="https://lxb.wiki/tags/dirs/"/>
    
      <category term="pushd" scheme="https://lxb.wiki/tags/pushd/"/>
    
      <category term="popd" scheme="https://lxb.wiki/tags/popd/"/>
    
  </entry>
  
  <entry>
    <title>PHP检测图片是否有木马</title>
    <link href="https://lxb.wiki/9a49b652/"/>
    <id>https://lxb.wiki/9a49b652/</id>
    <published>2020-10-15T11:59:17.000Z</published>
    <updated>2020-11-12T15:21:04.304Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- tocstop --><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">"Content-type: text/html; charset=utf-8"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkHex</span><span class="params">($img)</span> </span>&#123;</span><br><span class="line">  $status = <span class="number">0</span>;</span><br><span class="line">  $tips = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"0"</span> =&gt; <span class="string">"文件没问题"</span>,</span><br><span class="line">    <span class="string">"5"</span> =&gt; <span class="string">"文件有毒"</span>,</span><br><span class="line">    <span class="string">"-1"</span> =&gt; <span class="string">"文件没有上传"</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">if</span> (file_exists($img)) &#123;</span><br><span class="line">    $resource = fopen($img, <span class="string">'rb'</span>);</span><br><span class="line">    $fileSize = filesize($img);</span><br><span class="line">    fseek($resource, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ($fileSize &gt; <span class="number">512</span>) &#123; <span class="comment">// 取头和尾</span></span><br><span class="line">      $hexCode = bin2hex(fread($resource, <span class="number">512</span>));</span><br><span class="line">      fseek($resource, $fileSize - <span class="number">512</span>);</span><br><span class="line">      $hexCode .= bin2hex(fread($resource, <span class="number">512</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 取全部</span></span><br><span class="line">      $hexCode = bin2hex(fread($resource, $fileSize));</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($resource);</span><br><span class="line">    <span class="comment">/* 匹配16进制中的 &lt;% ( ) %&gt; */</span></span><br><span class="line">    <span class="comment">/* 匹配16进制中的 &lt;? ( ) ?&gt; */</span></span><br><span class="line">    <span class="comment">/* 匹配16进制中的 &lt;script | /script&gt; 大小写亦可 */</span></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/(3c25.*?28.*?29.*?253e)|(3c3f.*?28.*?29.*?3f3e)|(3C534352495054)|(2F5343524950543E)|(3C736372697074)|(2F7363726970743E)/is"</span>, $hexCode)) &#123;</span><br><span class="line">      $status = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $status = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> $tips[$status];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$rs = checkHex(<span class="string">"du.png"</span>);</span><br><span class="line"></span><br><span class="line">print_r($rs);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;



&lt;!-- tocstop --&gt;

&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
    
      <category term="Pic" scheme="https://lxb.wiki/categories/Pic/"/>
    
    
      <category term="Pic" scheme="https://lxb.wiki/tags/Pic/"/>
    
  </entry>
  
  <entry>
    <title>流量复制重放工具goreplay</title>
    <link href="https://lxb.wiki/8c9efcce/"/>
    <id>https://lxb.wiki/8c9efcce/</id>
    <published>2020-10-04T15:17:17.000Z</published>
    <updated>2020-11-12T15:23:15.546Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#goreplay简介">goreplay简介</a></li><li><a href="#goreplay工作原理">goreplay工作原理</a><ul><li><a href="#goreplay常见用法">goreplay常见用法</a></li><li><a href="#gor参数">gor参数</a></li></ul></li></ul><!-- tocstop --><h1 id="goreplay简介"><span id="goreplay简介">goreplay简介</span></h1><p><a href="https://github.com/buger/goreplay" target="_blank" rel="noopener">https://github.com/buger/goreplay</a></p><p><a href="https://goreplay.org/" target="_blank" rel="noopener">https://goreplay.org</a></p><p>GoReplay是一个开源工具，用于捕获实时HTTP流量并将其重放到测试环境中，以便使用真实数据持续测试系统。<br>GoReplay不是代理，而是监听网络接口上的流量，不需要更改生产基础架构，而是在与服务相同的计算机上运行GoReplay守护程序。</p><h1 id="goreplay工作原理"><span id="goreplay工作原理">goreplay工作原理</span></h1><p><img src="https://camo.githubusercontent.com/1c65a684aeb1d16343d59c3ab6d3f9d41c77c36f/68747470733a2f2f692e696d6775722e636f6d2f494e327866446d2e706e67" alt></p><h2 id="goreplay常见用法"><span id="goreplay常见用法">goreplay常见用法</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 简单的 HTTP 流量复制：</span><br><span class="line">gor –input-raw :80 –output-http “http://staging.com”</span><br><span class="line"></span><br><span class="line">2.HTTP 流量复制频率控制：</span><br><span class="line">gor –input-tcp :28020 –output-http “http://staging.com|10″</span><br><span class="line"></span><br><span class="line">3.HTTP 流量复制缩小：</span><br><span class="line">gor –input-raw :80 –output-tcp “replay.local:28020|10%”</span><br><span class="line"></span><br><span class="line">4.HTTP 流量记录到本地文件：</span><br><span class="line">gor –input-raw :80 –output-file requests.gor</span><br><span class="line"></span><br><span class="line">5.HTTP 流量回放和压测：</span><br><span class="line">gor –input-file “requests.gor|200%” –output-http “staging.com”</span><br><span class="line"></span><br><span class="line">6.HTTP 流量过滤复制：</span><br><span class="line">gor –input-raw :8080 –output-http staging.com –output-http-url-regexp ^www.</span><br><span class="line"></span><br><span class="line">7.HTTP指定接口流量复制：</span><br><span class="line">gor --input-raw :80 --http-allow-url <span class="string">'/api/v1'</span> --output-stdout      //--output-stdout表示直接在控制台输出</span><br></pre></td></tr></table></figure><h2 id="gor参数"><span id="gor参数">gor参数</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">[root@~]<span class="comment"># gor --help</span></span><br><span class="line">Gor is a simple http traffic replication tool written <span class="keyword">in</span> Go. Its main goal is to replay traffic from production servers to staging and dev environments.</span><br><span class="line">Project page: https://github.com/buger/gor</span><br><span class="line">Author: &lt;Leonid Bugaev&gt; leonsbox@gmail.com</span><br><span class="line">Current Version: 1.0.0</span><br><span class="line"></span><br><span class="line">  -copy-buffer-size int</span><br><span class="line">    Set the buffer size <span class="keyword">for</span> an individual request (default 5M) (default 5242880)</span><br><span class="line">  -cpuprofile string</span><br><span class="line">    write cpu profile to file</span><br><span class="line">  -debug verbose//打开debug模式，显示所有接口的流量 </span><br><span class="line">    Turn on debug output, shows all intercepted traffic. Works only when with verbose flag</span><br><span class="line">  -<span class="built_in">exit</span>-after duration</span><br><span class="line">    <span class="built_in">exit</span> after specified duration</span><br><span class="line">  -http-allow-header value      //用一个正则表达式来匹配http头部，如果请求的头部没有匹配上，则被拒绝</span><br><span class="line">    A regexp to match a specific header against. Requests with non-matching headers will be dropped:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-allow-header api-version:^v1</span><br><span class="line">  -http-allow-method value      // 类似于一个白名单机制来允许通过的http请求方法，除此之外的方法都被拒绝.</span><br><span class="line">    Whitelist of HTTP methods to replay. Anything <span class="keyword">else</span> will be dropped:</span><br><span class="line">    gor --input-raw :8080 --output-http staging.com --http-allow-method GET --http-allow-method OPTIONS</span><br><span class="line">  -http-allow-url value             //一个正则表达式用来匹配url， 用来过滤完全匹配的的url，在此之外的都被过滤掉</span><br><span class="line">    A regexp to match requests against. Filter get matched against full url with domain. Anything <span class="keyword">else</span> will be dropped:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-allow-url ^www.</span><br><span class="line">  -http-basic-auth-filter value         //匹配认证头重放</span><br><span class="line">    A regexp to match the decoded basic auth string against. Requests with non-matching headers will be dropped:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-basic-auth-filter <span class="string">"^customer[0-9].*"</span></span><br><span class="line">  -http-disallow-header value       //用一个正则表达式来匹配http头部，匹配到的请求会被拒绝掉</span><br><span class="line">    A regexp to match a specific header against. Requests with matching headers will be dropped:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-disallow-header <span class="string">"User-Agent: Replayed by Gor"</span></span><br><span class="line">  -http-disallow-url value      //用一个正则表达式来匹配url，如果请求匹配上了，则会被拒绝</span><br><span class="line">    A regexp to match requests against. Filter get matched against full url with domain. Anything <span class="keyword">else</span> will be forwarded:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-disallow-url ^www.</span><br><span class="line">  -http-header-limiter value//读取请求，基于FNV32-1A散列来拒绝一定比例的特殊请求 </span><br><span class="line">    Takes a fraction of requests, consistently taking or rejecting a request based on the FNV32-1A <span class="built_in">hash</span> of a specific header:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-header-limiter user-id:25%</span><br><span class="line">  -http-original-host       //在--output-http的输出中，通常gor会使用取代请求的http头，所以应该禁用该选项，保留原始的主机头</span><br><span class="line">    Normally gor replaces the Host http header with the host supplied with --output-http.  This option disables that behavior, preserving the original Host header.</span><br><span class="line">  -http-param-limiter value</span><br><span class="line">    Takes a fraction of requests, consistently taking or rejecting a request based on the FNV32-1A <span class="built_in">hash</span> of a specific GET param:</span><br><span class="line">     gor --input-raw :8080 --output-http staging.com --http-param-limiter user_id:25%</span><br><span class="line">  -http-pprof :8181</span><br><span class="line">    Enable profiling. Starts  http server on specified port, exposing special /debug/pprof endpoint. Example: :8181</span><br><span class="line">  -http-rewrite-header value</span><br><span class="line">    Rewrite the request header based on a mapping:</span><br><span class="line">    gor --input-raw :8080 --output-http staging.com --http-rewrite-header Host: (.*).example.com,<span class="variable">$1</span>.beta.example.com</span><br><span class="line">  -http-rewrite-url value</span><br><span class="line">    Rewrite the request url based on a mapping:</span><br><span class="line">    gor --input-raw :8080 --output-http staging.com --http-rewrite-url /v1/user/([^\/]+)/ping:/v2/user/<span class="variable">$1</span>/ping</span><br><span class="line">  -http-set-header value</span><br><span class="line">    Inject additional headers to http reqest:</span><br><span class="line">    gor --input-raw :8080 --output-http staging.com --http-set-header <span class="string">'User-Agent: Gor'</span></span><br><span class="line">  -http-set-param value</span><br><span class="line">    Set request url param, <span class="keyword">if</span> param already exists it will be overwritten:</span><br><span class="line">    gor --input-raw :8080 --output-http staging.com --http-set-param api_key=1</span><br><span class="line">  -input-dummy value</span><br><span class="line">    Used <span class="keyword">for</span> testing outputs. Emits <span class="string">'Get /'</span> request every 1s</span><br><span class="line">  -input-file value//从一个文件中读取请求</span><br><span class="line">    Read requests from file: </span><br><span class="line">    gor --input-file ./requests.gor --output-http staging.com</span><br><span class="line">  -input-file-loop</span><br><span class="line">    Loop input files, useful <span class="keyword">for</span> performance testing.</span><br><span class="line">  -input-kafka-host string</span><br><span class="line">    Send request and response stats to Kafka:</span><br><span class="line">    gor --output-stdout --input-kafka-host <span class="string">'192.168.0.1:9092,192.168.0.2:9092'</span></span><br><span class="line">  -input-kafka-json-format</span><br><span class="line">    If turned on, it will assume that messages coming <span class="keyword">in</span> JSON format rather than  GoReplay text format.</span><br><span class="line">  -input-kafka-topic string</span><br><span class="line">    Send request and response stats to Kafka:</span><br><span class="line">    gor --output-stdout --input-kafka-topic <span class="string">'kafka-log'</span></span><br><span class="line">  -input-raw value</span><br><span class="line">    Capture traffic from given port (use RAW sockets and require *sudo* access):</span><br><span class="line">    <span class="comment"># Capture traffic from 8080 port</span></span><br><span class="line">    gor --input-raw :8080 --output-http staging.com</span><br><span class="line">  -input-raw-bpf-filter string</span><br><span class="line">    BPF filter to write custom expressions. Can be useful <span class="keyword">in</span> <span class="keyword">case</span> of non standard network interfaces like tunneling or SPAN port. Example: --input-raw-bpf-filter <span class="string">'dst port 80'</span></span><br><span class="line">  -input-raw-buffer-size int</span><br><span class="line">    Controls size of the OS buffer (<span class="keyword">in</span> bytes) <span class="built_in">which</span> holds packets until they dispatched. Default value depends by system: <span class="keyword">in</span> Linux around 2MB. If you see big package drop, increase this value.</span><br><span class="line">  -input-raw-engine libpcap</span><br><span class="line">    Intercept traffic using libpcap (default), and `raw_socket` (default <span class="string">"libpcap"</span>)</span><br><span class="line">  -input-raw-expire duration</span><br><span class="line">    How much it should <span class="built_in">wait</span> <span class="keyword">for</span> the last TCP packet, till consider that TCP message complete. (default 2s)</span><br><span class="line">  -input-raw-immediate-mode</span><br><span class="line">    Set pcap interface to immediate mode.</span><br><span class="line">  -input-raw-override-snaplen</span><br><span class="line">    Override the capture snaplen to be 64k. Required <span class="keyword">for</span> some Virtualized environments</span><br><span class="line">  -input-raw-realip-header string</span><br><span class="line">    If not blank, injects header with given name and real IP value to the request payload. Usually this header should be named: X-Real-IP</span><br><span class="line">  -input-raw-timestamp-type string</span><br><span class="line">    Possible values: PCAP_TSTAMP_HOST, PCAP_TSTAMP_HOST_LOWPREC, PCAP_TSTAMP_HOST_HIPREC, PCAP_TSTAMP_ADAPTER, PCAP_TSTAMP_ADAPTER_UNSYNCED. This values not supported on all systems, GoReplay will tell you available values of you put wrong one.</span><br><span class="line">  -input-raw-track-response</span><br><span class="line">    If turned on Gor will track responses <span class="keyword">in</span> addition to requests, and they will be available to middleware and file output.</span><br><span class="line">  -input-tcp value// 用来在多个gor之间流转流量</span><br><span class="line">    Used <span class="keyword">for</span> internal communication between Gor instances. Example: </span><br><span class="line">    <span class="comment"># Receive requests from other Gor instances on 28020 port, and redirect output to staging</span></span><br><span class="line">    gor --input-tcp :28020 --output-http staging.com</span><br><span class="line">  -input-tcp-certificate string</span><br><span class="line">    Path to PEM encoded certificate file. Used when TLS turned on.</span><br><span class="line">  -input-tcp-certificate-key string</span><br><span class="line">    Path to PEM encoded certificate key file. Used when TLS turned on.</span><br><span class="line">  -input-tcp-secure</span><br><span class="line">    Turn on TLS security. Do not forget to specify certificate and key files.</span><br><span class="line">  -memprofile string</span><br><span class="line">    write memory profile to this file</span><br><span class="line">  -middleware string</span><br><span class="line">    Used <span class="keyword">for</span> modifying traffic using external <span class="built_in">command</span></span><br><span class="line">  -output-dummy value//用来测试输入，打印出接收的数据.</span><br><span class="line">    DEPRECATED: use --output-stdout instead</span><br><span class="line">  -output-file value//把进入的请求写入一个文件中 </span><br><span class="line">    Write incoming requests to file: </span><br><span class="line">    gor --input-raw :80 --output-file ./requests.gor</span><br><span class="line">  -output-file-append</span><br><span class="line">    The flushed chunk is appended to existence file or not. </span><br><span class="line">  -output-file-flush-interval duration</span><br><span class="line">    Interval <span class="keyword">for</span> forcing buffer flush to the file, default: 1s. (default 1s)</span><br><span class="line">  -output-file-max-size-limit value</span><br><span class="line">    Max size of output file, Default: 1TB (default -1)</span><br><span class="line">  -output-file-queue-limit int</span><br><span class="line">    The length of the chunk queue. Default: 256 (default 256)</span><br><span class="line">  -output-file-size-limit value</span><br><span class="line">    Size of each chunk. Default: 32mb (default 33554432)</span><br><span class="line">  -output-http value//转发进入的请求到一个http地址上</span><br><span class="line">    Forwards incoming requests to given http address.</span><br><span class="line">    <span class="comment"># Redirect all incoming requests to staging.com address </span></span><br><span class="line">    gor --input-raw :80 --output-http http://staging.com</span><br><span class="line">  -output-http-compatibility-mode</span><br><span class="line">    Use standard Go client, instead of built-in implementation. Can be slower, but more compatible.</span><br><span class="line">  -output-http-debug</span><br><span class="line">    Enables http debug output.</span><br><span class="line">  -output-http-elasticsearch string//把请求和响应状态发送到ElasticSearch</span><br><span class="line">    Send request and response stats to ElasticSearch:</span><br><span class="line">    gor --input-raw :8080 --output-http staging.com --output-http-elasticsearch <span class="string">'es_host:api_port/index_name'</span></span><br><span class="line">  -output-http-header --output-http-header</span><br><span class="line">    WARNING: --output-http-header DEPRECATED, use `--http-set-header` instead</span><br><span class="line">  -output-http-header-filter --output-http-header-filter</span><br><span class="line">    WARNING: --output-http-header-filter DEPRECATED, use `--http-allow-header` instead</span><br><span class="line">  -output-http-header-hash-filter output-http-header-hash-filter</span><br><span class="line">    WARNING: output-http-header-hash-filter DEPRECATED, use `--http-header-hash-limiter` instead</span><br><span class="line">  -output-http-method --output-http-method</span><br><span class="line">    WARNING: --output-http-method DEPRECATED, use `--http-allow-method` instead</span><br><span class="line">  -output-http-queue-len int</span><br><span class="line">    Number of requests that can be queued <span class="keyword">for</span> output, <span class="keyword">if</span> all workers are busy. default = 1000 (default 1000)</span><br><span class="line">  -output-http-redirects int//设置多少次重定向被允许</span><br><span class="line">    Enable how often redirects should be followed.</span><br><span class="line">  -output-http-response-buffer int</span><br><span class="line">    HTTP response buffer size, all data after this size will be discarded.</span><br><span class="line">  -output-http-rewrite-url --output-http-rewrite-url</span><br><span class="line">    WARNING: --output-http-rewrite-url DEPRECATED, use `--http-rewrite-url` instead</span><br><span class="line">  -output-http-stats//每5秒钟输出一次输出队列的状态</span><br><span class="line">    Report http output queue stats to console every N milliseconds. See output-http-stats-ms</span><br><span class="line">  -output-http-stats-ms int</span><br><span class="line">    Report http output queue stats to console every N milliseconds. default: 5000 (default 5000)</span><br><span class="line">  -output-http-timeout duration//指定http的request/response超时时间，默认是5秒 </span><br><span class="line">    Specify HTTP request/response timeout. By default 5s. Example: --output-http-timeout 30s (default 5s)</span><br><span class="line">  -output-http-track-response</span><br><span class="line">    If turned on, HTTP output responses will be <span class="built_in">set</span> to all outputs like stdout, file and etc.</span><br><span class="line">  -output-http-url-regexp --output-http-url-regexp</span><br><span class="line">    WARNING: --output-http-url-regexp DEPRECATED, use `--http-allow-url` instead</span><br><span class="line">  -output-http-workers int// gor默认是动态的扩展工作者数量，你也可以指定固定数量的工作者</span><br><span class="line">    Gor uses dynamic worker scaling. Enter a number to <span class="built_in">set</span> a maximum number of workers. default = 0 = unlimited.</span><br><span class="line">  -output-http-workers-min int</span><br><span class="line">    Gor uses dynamic worker scaling. Enter a number to <span class="built_in">set</span> a minimum number of workers. default = 1.</span><br><span class="line">  -output-kafka-host string</span><br><span class="line">    Read request and response stats from Kafka:</span><br><span class="line">    gor --input-raw :8080 --output-kafka-host <span class="string">'192.168.0.1:9092,192.168.0.2:9092'</span></span><br><span class="line">  -output-kafka-json-format</span><br><span class="line">    If turned on, it will serialize messages from GoReplay text format to JSON.</span><br><span class="line">  -output-kafka-topic string</span><br><span class="line">    Read request and response stats from Kafka:</span><br><span class="line">    gor --input-raw :8080 --output-kafka-topic <span class="string">'kafka-log'</span></span><br><span class="line">  -output-null</span><br><span class="line">    Used <span class="keyword">for</span> testing inputs. Drops all requests.</span><br><span class="line">  -output-stdout</span><br><span class="line">    Used <span class="keyword">for</span> testing inputs. Just prints to console data coming from inputs.</span><br><span class="line">  -output-tcp value//用来在多个gor之间流转流量</span><br><span class="line">    Used <span class="keyword">for</span> internal communication between Gor instances. Example: </span><br><span class="line">    <span class="comment"># Listen for requests on 80 port and forward them to other Gor instance on 28020 port</span></span><br><span class="line">    gor --input-raw :80 --output-tcp replay.local:28020</span><br><span class="line">  -output-tcp-secure</span><br><span class="line">    Use TLS secure connection. --input-file on another end should have TLS turned on as well.</span><br><span class="line">  -output-tcp-stats//每5秒钟报告一次tcp输出队列的状态</span><br><span class="line">    Report TCP output queue stats to console every 5 seconds.</span><br><span class="line">  -prettify-http</span><br><span class="line">    If enabled, will automatically decode requests and responses with: Content-Encodning: gzip and Transfer-Encoding: chunked. Useful <span class="keyword">for</span> debugging, <span class="keyword">in</span> conjuction with --output-stdout</span><br><span class="line">  -split-output <span class="literal">true</span></span><br><span class="line">    By default each output gets same traffic. If <span class="built_in">set</span> to <span class="literal">true</span> it splits traffic equally among all outputs.</span><br><span class="line">  -stats//打开输出队列的状态</span><br><span class="line">    Turn on queue stats output</span><br><span class="line">  -verbose</span><br><span class="line">    Turn on more verbose output</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#goreplay简介&quot;&gt;goreplay简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#goreplay工作原理&quot;&gt;goreplay工作原理&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#goreplay常见用法
      
    
    </summary>
    
    
      <category term="Tools" scheme="https://lxb.wiki/categories/Tools/"/>
    
    
      <category term="工具" scheme="https://lxb.wiki/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>10大静态网站生成工具</title>
    <link href="https://lxb.wiki/690c8418/"/>
    <id>https://lxb.wiki/690c8418/</id>
    <published>2020-10-02T10:26:55.000Z</published>
    <updated>2020-11-12T15:23:48.853Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#静态网站是什么">静态网站是什么？</a></li><li><a href="#最好的开源静态网站生成工具">最好的开源静态网站生成工具</a><ul><li><a href="#1-jekyll">1、Jekyll</a></li><li><a href="#2-hugo">2、Hugo</a></li><li><a href="#3-hexo">3、Hexo</a></li><li><a href="#4-gatsby">4、Gatsby</a></li><li><a href="#5-vuepress">5、VuePress</a></li><li><a href="#6-nuxtjs">6、Nuxt.js</a></li><li><a href="#7-docusaurus">7、Docusaurus</a></li><li><a href="#8-eleventy">8、Eleventy</a></li><li><a href="#9-publii">9、Publii</a></li><li><a href="#10-primo">10、Primo</a></li></ul></li><li><a href="#结语">结语</a></li></ul><!-- tocstop --><p><img src="https://img.linux.net.cn/data/attachment/album/202010/01/123903lx1q0w2oh1lxx7wh.jpg" alt></p><blockquote><p>在寻找部署静态网页的方法吗？这几个开源的静态网站生成工具可以帮你迅速部署界面优美、功能强大的静态网站，无需掌握复杂的 HTML 和 CSS 技能。</p></blockquote><h3 id="静态网站是什么"><span id="静态网站是什么">静态网站是什么？</span></h3><p>技术上来讲，静态网站是指网页不是由服务器动态生成的。HTML、CSS 和 JavaScript 文件就静静地躺在服务器的某个路径下，它们的内容与终端用户接收到的版本是一样的。原始的源码文件已经提前编译好了，源码在每次请求后都不会变化。</p><p>Linux.CN 是一个依赖多个数据库的动态网站，当有浏览器的请求时，网页就会生成并提供服务。大部分网站是动态的，你与这些网站互动时，大量的内容会经常改变。</p><p>静态网站有一些好处，比如加载时间更短，请求的服务器资源更少、更安全（值得商榷）。</p><p>传统上，静态网站更适合于创建只有少量网页、内容变化不频繁的小网站。</p><p>然而，随着静态网站生成工具出现后，静态网站的适用范围越来越大。你还可以使用这些工具搭建博客网站。</p><p>我整理了几个开源的静态网站生成工具，这些工具可以帮你搭建界面优美的网站。</p><h3 id="最好的开源静态网站生成工具"><span id="最好的开源静态网站生成工具">最好的开源静态网站生成工具</span></h3><p>请注意，静态网站不会提供很复杂的功能。如果你需要复杂的功能，那么你可以参考适用于动态网站的<a href="https://itsfoss.com/open-source-cms/" target="_blank" rel="noopener">最佳开源 CMS</a>列表。</p><h4 id="1-jekyll"><span id="1-jekyll">1、Jekyll</span></h4><p><img src="https://i1.wp.com/itsfoss.com/wp-content/uploads/2018/01/jekyll-screenshot.jpg?resize=800%2C450&ssl=1" alt></p><p>Jekyll 是用 <a href="https://www.ruby-lang.org/en/" target="_blank" rel="noopener">Ruby</a> 写的最受欢迎的开源静态生成工具之一。实际上，Jekyll 是 <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub 页面</a> 的引擎，它可以让你免费用 GitHub 托管网站。</p><p>你可以很轻松地跨平台配置 Jekyll，包括 Ubuntu。它利用 <a href="https://github.com/Shopify/liquid/wiki" target="_blank" rel="noopener">Markdown</a>、<a href="https://github.com/Shopify/liquid/wiki" target="_blank" rel="noopener">Liquid</a>（模板语言）、HTML 和 CSS 来生成静态的网页文件。如果你要搭建一个没有广告或推广自己工具或服务的产品页的博客网站，它是个不错的选择。</p><p>它还支持从常见的 CMS（<ruby>内容管理系统<rt>Content management system</rt></ruby>）如 Ghost、WordPress、Drupal 7 迁移你的博客。你可以管理永久链接、类别、页面、文章，还可以自定义布局，这些功能都很强大。因此，即使你已经有了一个网站，如果你想转成静态网站，Jekyll 会是一个完美的解决方案。你可以参考<a href="https://jekyllrb.com/docs/" target="_blank" rel="noopener">官方文档</a>或 <a href="https://github.com/jekyll/jekyll" target="_blank" rel="noopener">GitHub 页面</a>了解更多内容。</p><ul><li><a href="https://jekyllrb.com/" target="_blank" rel="noopener">Jekyll</a></li></ul><h4 id="2-hugo"><span id="2-hugo">2、Hugo</span></h4><p><img src="https://i2.wp.com/itsfoss.com/wp-content/uploads/2020/09/hugo.jpg?resize=800%2C414&ssl=1" alt></p><p>Hugo 是另一个很受欢迎的用于搭建静态网站的开源框架。它是用 <a href="https://golang.org/" target="_blank" rel="noopener">Go 语言</a>写的。</p><p>它运行速度快、使用简单、可靠性高。如果你需要，它也可以提供更高级的主题。它还提供了一些有用的快捷方式来帮助你轻松完成任务。无论是组合展示网站还是博客网站，Hogo 都有能力管理大量的内容类型。</p><p>如果你想使用 Hugo，你可以参照它的<a href="https://gohugo.io/getting-started/" target="_blank" rel="noopener">官方文档</a>或它的 <a href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener">GitHub 页面</a>来安装以及了解更多相关的使用方法。如果需要的话，你还可以将 Hugo 部署在 GitHub 页面或任何 CDN 上。</p><ul><li><a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a></li></ul><h4 id="3-hexo"><span id="3-hexo">3、Hexo</span></h4><p><img src="https://i2.wp.com/itsfoss.com/wp-content/uploads/2020/09/hexo.jpg?resize=800%2C213&ssl=1" alt></p><p>Hexo 是一个有趣的开源框架，基于 <a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a>。像其他的工具一样，你可以用它搭建相当快速的网站，不仅如此，它还提供了丰富的主题和插件。</p><p>它还根据用户的每个需求提供了强大的 API 来扩展功能。如果你已经有一个网站，你可以用它的<a href="https://hexo.io/api/migrator.html" target="_blank" rel="noopener">迁移</a>扩展轻松完成迁移工作。</p><p>你可以参照<a href="https://hexo.io/docs/" target="_blank" rel="noopener">官方文档</a>或 <a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">GitHub 页面</a> 来使用 Hexo。</p><ul><li><a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a></li></ul><h4 id="4-gatsby"><span id="4-gatsby">4、Gatsby</span></h4><p><img src="https://i0.wp.com/itsfoss.com/wp-content/uploads/2020/09/gatsbyjs.png?resize=800%2C388&ssl=1" alt></p><p>Gatsby 是一个越来越流行的开源网站生成框架。它使用 <a href="https://reactjs.org/" target="_blank" rel="noopener">React.js</a> 来生成快速、界面优美的网站。</p><p>几年前在一个实验性的项目中，我曾经非常想尝试一下这个工具，它提供的成千上万的新插件和主题的能力让我印象深刻。与其他静态网站生成工具不同的是，你可以使用 Gatsby 生成一个网站，并在不损失任何功能的情况下获得静态网站的好处。</p><p>它提供了与很多流行的服务的整合功能。当然，你可以不使用它的复杂的功能，或将其与你选择的流行 CMS 配合使用，这也会很有趣。你可以查看他们的<a href="https://www.gatsbyjs.com/docs/" target="_blank" rel="noopener">官方文档</a>或它的 <a href="https://github.com/gatsbyjs/gatsby" target="_blank" rel="noopener">GitHub 页面</a>了解更多内容。</p><ul><li><a href="https://www.gatsbyjs.com/" target="_blank" rel="noopener">Gatsby</a></li></ul><h4 id="5-vuepress"><span id="5-vuepress">5、VuePress</span></h4><p><img src="https://i0.wp.com/itsfoss.com/wp-content/uploads/2020/09/VuePress.jpg?resize=800%2C498&ssl=1" alt></p><p>VuePress 是由 <a href="https://vuejs.org/" target="_blank" rel="noopener">Vue.js</a> 支持的静态网站生成工具，而 Vue.js 是一个开源的渐进式 JavaScript 框架。</p><p>如果你了解 HTML、CSS 和 JavaScript，那么你可以无压力地使用 VuePress。你应该可以找到几个有用的插件和主题来为你的网站建设开个头。此外，看起来 Vue.js 的更新一直很活跃，很多开发者都在关注 Vue.js，这是一件好事。</p><p>你可以参照他们的<a href="https://vuepress.vuejs.org/guide/" target="_blank" rel="noopener">官方文档</a>和 <a href="https://github.com/vuejs/vuepress" target="_blank" rel="noopener">GitHub 页面</a>了解更多。</p><ul><li><a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener">VuePress</a></li></ul><h4 id="6-nuxtjs"><span id="6-nuxtjs">6、Nuxt.js</span></h4><p><img src="https://i2.wp.com/itsfoss.com/wp-content/uploads/2020/09/nuxtjs.jpg?resize=800%2C415&ssl=1" alt></p><p>Nuxt.js 使用了 Vue.js 和 Node.js，但它致力于模块化，并且有能力依赖服务端而非客户端。不仅如此，它的目标是为开发者提供直观的体验，并提供描述性错误，以及详细的文档等。</p><p>正如它声称的那样，在你用来搭建静态网站的所有工具中，Nuxt.js 可以做到功能和灵活性两全其美。他们还提供了一个 <a href="https://template.nuxtjs.org/" target="_blank" rel="noopener">Nuxt 线上沙盒</a>，让你不费吹灰之力就能直接测试它。</p><p>你可以查看它的 <a href="https://github.com/nuxt/nuxt.js" target="_blank" rel="noopener">GitHub 页面</a>和<a href="https://nuxtjs.org/" target="_blank" rel="noopener">官方网站</a>了解更多。</p><ul><li><a href="https://nuxtjs.org/" target="_blank" rel="noopener">Nuxt.js</a></li></ul><h4 id="7-docusaurus"><span id="7-docusaurus">7、Docusaurus</span></h4><p><img src="https://i2.wp.com/itsfoss.com/wp-content/uploads/2020/09/docusaurus.jpg?resize=800%2C278&ssl=1" alt></p><p>Docusaurus 是一个有趣的开源静态网站生成工具，为搭建文档类网站量身定制。它还是 <a href="https://opensource.facebook.com/" target="_blank" rel="noopener">Facebook 开源计划</a>的一个项目。</p><p>Docusaurus 是用 React 构建的。你可以使用所有的基本功能，像文档版本管理、文档搜索和翻译大多是预先配置的。如果你想为你的产品或服务搭建一个文档网站，那么可以试试 Docusaurus。</p><p>你可以从它的 <a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener">GitHub 页面</a>和它的<a href="https://docusaurus.io/" target="_blank" rel="noopener">官网</a>获取更多信息。</p><ul><li><a href="https://docusaurus.io/" target="_blank" rel="noopener">Docusaurus</a></li></ul><h4 id="8-eleventy"><span id="8-eleventy">8、Eleventy</span></h4><p><img src="https://i1.wp.com/itsfoss.com/wp-content/uploads/2020/09/eleventy.png?resize=800%2C375&ssl=1" alt></p><p>Eleventy 自称是 Jekyll 的替代品，旨在以更简单的方法来制作更快的静态网站。</p><p>它似乎很容易上手，而且它还提供了适当的文档来帮助你。如果你想找一个简单的静态网站生成工具，Eleventy 似乎会是一个有趣的选择。</p><p>你可以参照它的 <a href="https://github.com/11ty/eleventy/" target="_blank" rel="noopener">GitHub 页面</a>和<a href="https://www.11ty.dev/" target="_blank" rel="noopener">官网</a>来了解更多的细节。</p><ul><li><a href="https://www.11ty.dev/" target="_blank" rel="noopener">Eleventy</a></li></ul><h4 id="9-publii"><span id="9-publii">9、Publii</span></h4><p><img src="https://i0.wp.com/itsfoss.com/wp-content/uploads/2020/09/publii.jpg?resize=800%2C311&ssl=1" alt></p><p>Publii 是一个令人印象深刻的开源 CMS，它能使生成一个静态网站变得很容易。它是用 <a href="https://www.electronjs.org" target="_blank" rel="noopener">Electron</a> 和 Vue.js 构建的。如果有需要，你也可以把你的文章从 WorkPress 网站迁移过来。此外，它还提供了与 GitHub 页面、Netlify 及其它类似服务的一键同步功能。</p><p>如果你利用 Publii 生成一个静态网站，你还可以得到一个所见即所得的编辑器。你可以从<a href="https://getpublii.com/" target="_blank" rel="noopener">官网</a>下载它，或者从它的 <a href="https://github.com/GetPublii/Publii" target="_blank" rel="noopener">GitHub 页面</a>了解更多信息。</p><ul><li><a href="https://getpublii.com/" target="_blank" rel="noopener">Publii</a></li></ul><h4 id="10-primo"><span id="10-primo">10、Primo</span></h4><p><img src="https://i1.wp.com/itsfoss.com/wp-content/uploads/2020/09/primo-af.jpg?resize=800%2C394&ssl=1" alt></p><p>一个有趣的开源静态网站生成工具，目前开发工作仍很活跃。虽然与其他的静态生成工具相比，它还不是一个成熟的解决方案，有些功能还不完善，但它是一个独特的项目。</p><p>Primo 旨在使用可视化的构建器帮你构建和搭建网站，这样你就可以轻松编辑和部署到任意主机上。</p><p>你可以参照<a href="https://primo.af/" target="_blank" rel="noopener">官网</a>或查看它的 <a href="https://github.com/primo-app/primo-desktop" target="_blank" rel="noopener">GitHub 页面</a>了解更多信息。</p><ul><li><a href="https://primo.af/" target="_blank" rel="noopener">Primo</a></li></ul><h3 id="结语"><span id="结语">结语</span></h3><p>还有很多文章中没有列出的网站生成工具。然而，我试图提到最好的静态生成器，为您提供最快的加载时间，最好的安全性和令人印象深刻的灵活性。</p><p>列表中没有你最喜欢的工具？在下面的评论中告诉我。</p><hr><p>via: <a href="https://itsfoss.com/open-source-static-site-generators/" target="_blank" rel="noopener">https://itsfoss.com/open-source-static-site-generators/</a></p><p>作者：<a href="https://itsfoss.com/author/ankush/" target="_blank" rel="noopener">Ankush Das</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/lxbwolf" target="_blank" rel="noopener">lxbwolf</a><br>校对：<a href="https://github.com/wxy" target="_blank" rel="noopener">wxy</a></p><p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#静态网站是什么&quot;&gt;静态网站是什么？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#最好的开源静态网站生成工具&quot;&gt;最好的开源静态网站生成工具&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-jekyll&quot;&gt;1、Jek
      
    
    </summary>
    
    
      <category term="Tools" scheme="https://lxb.wiki/categories/Tools/"/>
    
    
      <category term="工具" scheme="https://lxb.wiki/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>sed替换含有路径的字符串</title>
    <link href="https://lxb.wiki/e4c7cf89/"/>
    <id>https://lxb.wiki/e4c7cf89/</id>
    <published>2020-09-13T13:16:00.000Z</published>
    <updated>2020-11-13T15:25:50.434Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#问题描述">问题描述</a></li><li><a href="#初级思路">初级思路</a></li><li><a href="#更好的解决方案">更好的解决方案</a></li></ul><!-- tocstop --><h3 id="问题描述"><span id="问题描述">问题描述</span></h3><p><code>sed -i &quot;s/old/new/g&quot; file.txt</code></p><p>如果 <code>new</code> 是个路径，即字符串中含有<code>/</code>，这么执行会报错</p><h3 id="初级思路"><span id="初级思路">初级思路</span></h3><p>把 <code>new</code> 中的 <code>/</code> 进行转义</p><p>比如 <code>new</code> 为 <code>/home/users/config.yaml</code></p><p>替换时</p><p><code>sed -i &quot;s/old/\/home\/users\/config.yaml/g&quot; file.txt</code></p><p>如果 <code>new</code> 是变量，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">new=<span class="string">"/home/users/config.yaml"</span></span><br><span class="line">new_sed=$(<span class="built_in">echo</span> <span class="variable">$new</span> | sed -e <span class="string">'s/\//\\\//g'</span>)</span><br><span class="line">sed -i <span class="string">"s/old/<span class="variable">$&#123;new_sed&#125;</span>/g"</span> file.txt</span><br></pre></td></tr></table></figure><h3 id="更好的解决方案"><span id="更好的解决方案">更好的解决方案</span></h3><p>转义会降低可读性，只需用其他特殊字符作为<code>sed</code>表达式的“分隔符”（取代默认的<code>/</code>）即可。<br>例如：<code>sed &#39;s#\$CONFIG#/home/users/config.yaml#g&#39;</code>，使用<code>#</code>代替<code>/</code>从而避免大量转义。</p><p>你可以尝试一下 <code>echo aabbccdd | sed &#39;s#aa#bb#g&#39; | sed &#39;s?bb?cc?g&#39; | sed &#39;s@cc@dd@g&#39; | sed &#39;s%dd%ee%g&#39;</code>  用任意字符作间隔</p><p>这是 <code>sed</code> 命令方便用户的一个特性，<code>vim</code> 中的 <code>:s</code> 也同样支持</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#问题描述&quot;&gt;问题描述&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#初级思路&quot;&gt;初级思路&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#更好的解决方案&quot;&gt;更好的解决方案&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- to
      
    
    </summary>
    
    
      <category term="Shell" scheme="https://lxb.wiki/categories/Shell/"/>
    
    
      <category term="Shell" scheme="https://lxb.wiki/tags/Shell/"/>
    
      <category term="sed" scheme="https://lxb.wiki/tags/sed/"/>
    
  </entry>
  
  <entry>
    <title>hexo使用hexo-toc锚点失效问题</title>
    <link href="https://lxb.wiki/b4c41686/"/>
    <id>https://lxb.wiki/b4c41686/</id>
    <published>2020-09-03T13:02:23.000Z</published>
    <updated>2020-11-12T15:24:15.223Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#现象">现象</a></li><li><a href="#原因">原因</a></li><li><a href="#修复方法">修复方法</a></li></ul><!-- tocstop --><h4 id="现象"><span id="现象">现象</span></h4><p>使用 hexo-toc 生成文章目录时，点击某个目录，url 变成 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:4000/690c8418/#null</span><br></pre></td></tr></table></figure><h4 id="原因"><span id="原因">原因</span></h4><p>插件在把 markdown 编译成 HTML 时，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## title</span><br></pre></td></tr></table></figure><p>会编译为 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;&lt;span id=&quot;title&quot;&gt;title&lt;/span&gt;&lt;/h2&gt;</span><br></pre></td></tr></table></figure><p>而在插件源码的<a href="https://github.com/hexojs/hexo/blob/master/lib/plugins/helper/toc.js#L27" target="_blank" rel="noopener">这次提交</a>之前，是会编译成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2 id=&quot;title&quot;&gt;title&lt;/h2&gt;</span><br></pre></td></tr></table></figure><p>因此新版本的 <code>hexo-toc</code> 生成 TOC 时，元素没有 <code>id</code> 这个属性，进而导致 TOC 中的锚点失效。</p><h4 id="修复方法"><span id="修复方法">修复方法</span></h4><p>修改 <code>node_modules/hexo-toc/lib/filter.js</code></p><p>把 28 行的 <code>$title.attr(&#39;id&#39;, id);</code> 注释打开</p><p>把 31 行的 <code>$title.removeAttr(&#39;id&#39;);</code> 注释掉</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#现象&quot;&gt;现象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#原因&quot;&gt;原因&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#修复方法&quot;&gt;修复方法&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;

&lt;h4
      
    
    </summary>
    
    
      <category term="Tools" scheme="https://lxb.wiki/categories/Tools/"/>
    
    
      <category term="hexo" scheme="https://lxb.wiki/tags/hexo/"/>
    
      <category term="hexo-toc" scheme="https://lxb.wiki/tags/hexo-toc/"/>
    
      <category term="锚点失效" scheme="https://lxb.wiki/tags/%E9%94%9A%E7%82%B9%E5%A4%B1%E6%95%88/"/>
    
  </entry>
  
  <entry>
    <title>C++ Lambda 表达式</title>
    <link href="https://lxb.wiki/e4d97659/"/>
    <id>https://lxb.wiki/e4d97659/</id>
    <published>2020-08-20T23:13:27.000Z</published>
    <updated>2020-11-12T15:24:50.949Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#基础">基础</a><ul><li><a href="#1-值捕获">1. 值捕获</a></li><li><a href="#2-引用捕获">2. 引用捕获</a></li><li><a href="#3-隐式捕获"><strong>3. 隐式捕获</strong></a></li><li><a href="#4-表达式捕获"><strong>4. 表达式捕获</strong></a></li></ul></li><li><a href="#泛型-lambda">泛型 Lambda</a></li></ul><!-- tocstop --><p>Lambda 表达式是现代 C++ 中最重要的特性之一，而 Lambda 表达式，实际上就是提供了一个类似匿名函数的特性， 而匿名函数则是在需要一个函数，但是又不想费力去命名一个函数的情况下去使用的。这样的场景其实有很多很多， 所以匿名函数几乎是现代编程语言的标配。</p><h3 id="基础"><span id="基础">基础</span></h3><p>Lambda 表达式的基本语法如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[捕获列表](参数列表) <span class="keyword">mutable</span>(可选) 异常属性 -&gt; 返回类型 &#123;</span><br><span class="line"><span class="comment">// 函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的语法规则除了 <code>[捕获列表]</code> 内的东西外，其他部分都很好理解，只是一般函数的函数名被略去， 返回值使用了一个 <code>-&gt;</code> 的形式进行（我们在上一节前面的尾返回类型已经提到过这种写法了）。</p><p>所谓捕获列表，其实可以理解为参数的一种类型，lambda 表达式内部函数体在默认情况下是不能够使用函数体外部的变量的， 这时候捕获列表可以起到传递外部数据的作用。根据传递的行为，捕获列表也分为以下几种：</p><h4 id="1-值捕获"><span id="1-值捕获">1. 值捕获</span></h4><p>与参数传值类似，值捕获的前提是变量可以拷贝，不同之处则在于，<strong>被捕获的变量在 lambda 表达式被创建时拷贝， 而非调用时才拷贝</strong>：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lambda_value_capture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> copy_value = [value] &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">    value = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">auto</span> stored_value = copy_value();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"stored_value = "</span> &lt;&lt; stored_value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// 这时, stored_value == 1, 而 value == 100.</span></span><br><span class="line">    <span class="comment">// 因为 copy_value 在创建时就保存了一份 value 的拷贝</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-引用捕获"><span id="2-引用捕获">2. 引用捕获</span></h4><p>与引用传参类似，引用捕获保存的是引用，值会发生变化。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lambda_reference_capture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> copy_value = [&amp;value] &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">    value = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">auto</span> stored_value = copy_value();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"stored_value = "</span> &lt;&lt; stored_value &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// 这时, stored_value == 100, value == 100.</span></span><br><span class="line">    <span class="comment">// 因为 copy_value 保存的是引用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-隐式捕获"><span id="3-隐式捕获"><strong>3. 隐式捕获</strong></span></h4><p>手动书写捕获列表有时候是非常复杂的，这种机械性的工作可以交给编译器来处理，这时候可以在捕获列表中写一个 <code>&amp;</code> 或 <code>=</code> 向编译器声明采用引用捕获或者值捕获.</p><p>总结一下，捕获提供了lambda 表达式对外部值进行使用的功能，捕获列表的最常用的四种形式可以是：</p><ul><li>[] 空捕获列表</li><li>[name1, name2, …] 捕获一系列变量</li><li>[&amp;] 引用捕获, 让编译器自行推导捕获列表</li><li>[=] 值捕获, 让编译器执行推导引用列表</li></ul><h4 id="4-表达式捕获"><span id="4-表达式捕获"><strong>4. 表达式捕获</strong></span></h4><p>上面提到的值捕获、引用捕获都是已经在外层作用域声明的变量，因此这些捕获方式捕获的均为左值，而不能捕获右值。</p><p>C++14 给与了我们方便，允许捕获的成员用任意的表达式进行初始化，这就允许了右值的捕获， 被声明的捕获变量类型会根据表达式进行判断，判断方式与使用 <code>auto</code> 本质上是相同的：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> important = <span class="built_in">std</span>::make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> add = [v1 = <span class="number">1</span>, v2 = <span class="built_in">std</span>::move(important)](<span class="keyword">int</span> x, <span class="keyword">int</span> y) -&gt; <span class="keyword">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x+y+v1+(*v2);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; add(<span class="number">3</span>,<span class="number">4</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中，<code>important</code> 是一个独占指针，是不能够被捕获到的，这时候我们需要将其转移为右值， 在表达式中初始化。</p><h3 id="泛型-lambda"><span id="泛型-lambda">泛型 Lambda</span></h3><p>上一节中我们提到了 <code>auto</code> 关键字不能够用在参数表里，这是因为这样的写法会与模板的功能产生冲突。 但是 Lambda 表达式并不是普通函数，所以 Lambda 表达式并不能够模板化。 这就为我们造成了一定程度上的麻烦：参数表不能够泛化，必须明确参数表类型。</p><p>幸运的是，这种麻烦只存在于 C++11 中，从 C++14 开始， Lambda 函数的形式参数可以使用 <code>auto</code> 关键字来产生意义上的泛型：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> add = [](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y) &#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;;</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">add(<span class="number">1.1</span>, <span class="number">2.2</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#基础&quot;&gt;基础&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-值捕获&quot;&gt;1. 值捕获&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-引用捕获&quot;&gt;2. 引用捕获&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-
      
    
    </summary>
    
    
      <category term="C++" scheme="https://lxb.wiki/categories/C/"/>
    
    
  </entry>
  
  <entry>
    <title>Pillow 库</title>
    <link href="https://lxb.wiki/ab6bf24d/"/>
    <id>https://lxb.wiki/ab6bf24d/</id>
    <published>2020-08-01T13:10:55.000Z</published>
    <updated>2020-11-12T15:25:17.170Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#pil中所涉及的基本概念">PIL中所涉及的基本概念</a></li><li><a href="#pil中有九种不同模式">PIL中有九种不同模式。</a></li><li><a href="#请注意gif文件总是以灰度形式读取-l-或调色板模式-p-图像">请注意，GIF文件总是以灰度形式读取。（ L ）或调色板模式（ P ）图像。</a></li></ul><!-- tocstop --><p>Pillow(PIL) 库中的 Image 类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from PIL import Image</span><br><span class="line">&gt;&gt;&gt; im = Image.open(&quot;lena.ppm&quot;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from __future__ import print_function</span><br><span class="line">&gt;&gt;&gt; print(im.format, im.size, im.mode)</span><br><span class="line">PPM (512, 512) RGB</span><br></pre></td></tr></table></figure><p>format 这个属性代表图片文件的扩展名, 如果图片文件打开失败, 则其值为None. size 这个属性代表图片的大小, 以像素为单位, 使用包含两个元素的元组来返回. mode 这个属性代表图片的band属性, 一般情况(黑白)下为 “L”, 当图片是彩色的时候是 “RGB”, 如果图片经过压缩, 则是 “CMYK”.</p><h3 id="pil中所涉及的基本概念"><span id="pil中所涉及的基本概念">PIL中所涉及的基本概念</span></h3><p>通道（bands）、模式（mode）、尺寸（size）、坐标系统（coordinate system）、调色板（palette）、信息（info）和滤波器（filters）。</p><h3 id="pil中有九种不同模式"><span id="pil中有九种不同模式">PIL中有九种不同模式。</span></h3><p>分别为1，L，P，RGB，RGBA，CMYK，YCbCr，I，F。</p><p><strong>模式 1</strong><br>二值图像</p><p>模式“1”为二值图像，非黑即白。但是它每个像素用8个bit表示，0表示黑，255表示白。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;from PIL import Image</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena =Image.open(&quot;D:\\Code\\Python\\test\\img\\lena.jpg&quot;)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena.mode</span><br><span class="line"> </span><br><span class="line">&apos;RGB&apos;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena.getpixel((0,0))</span><br><span class="line"> </span><br><span class="line">(197, 111, 78)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_1 = lena.convert(&quot;1&quot;)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_1.mode</span><br><span class="line"> </span><br><span class="line">&apos;1&apos;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_1.size</span><br><span class="line"> </span><br><span class="line">(512, 512)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt;lena_1.getpixel((0,0))</span><br><span class="line"> </span><br><span class="line">255</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_1.getpixel((10,10))</span><br><span class="line"> </span><br><span class="line">255</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt;lena_1.getpixel((10,120))</span><br><span class="line"> </span><br><span class="line">0</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt;lena_1.getpixel((130,120))</span><br><span class="line"> </span><br><span class="line">255</span><br></pre></td></tr></table></figure><p><strong>模式 L</strong></p><p>模式“L”为灰色图像，它的每个像素用8个bit表示，0表示黑，255表示白，其他数字表示不同的灰度</p><p><strong>模式 P</strong></p><p>模式“P”为8位彩色图像，它的每个像素用8个bit表示，其对应的彩色值是按照调色板查询出来的</p><p><strong>模式“RGBA”</strong></p><p>模式“RGBA”为32位彩色图像，它的每个像素用32个bit表示，其中24bit表示红色、绿色和蓝色三个通道，另外8bit表示alpha通道，即透明通道。</p><p>从实例中可以看到，使用当前这个方式将“RGB”图像转为“RGBA”图像时，alpha通道全部设置为255，即完全不透明。</p><p><strong>模式“CMYK”</strong></p><p>模式“CMYK”为32位彩色图像，它的每个像素用32个bit表示。模式“CMYK”就是印刷四分色模式，它是彩色印刷时采用的一种套色模式，利用色料的三原色混色原理，加上黑色油墨，共计四种颜色混合叠加，形成所谓“全彩印刷”。</p><p>四种标准颜色是：C：Cyan = 青色，又称为‘天蓝色’或是‘湛蓝’M：Magenta = 品红色，又称为‘洋红色’；Y：Yellow = 黄色；K：Key Plate(blacK) = 定位套版色（黑色）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt;&gt;from PIL import Image</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena =Image.open(&quot;D:\\Code\\Python\\test\\img\\lena.jpg&quot;)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_cmyk =lena.convert(&quot;CMYK&quot;)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_cmyk.mode</span><br><span class="line"> </span><br><span class="line">&apos;CMYK&apos;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt;lena_cmyk.getpixel((0,0))</span><br><span class="line"> </span><br><span class="line">(58, 144, 177, 0)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; lena_cmyk.getpixel((0,1))</span><br><span class="line"> </span><br><span class="line">(59, 145, 178, 0)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt;lena.getpixel((0,0))</span><br><span class="line"> </span><br><span class="line">(197, 111, 78)</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt;lena.getpixel((0,1))</span><br><span class="line"> </span><br><span class="line">(196, 110, 77)</span><br></pre></td></tr></table></figure><p>从实例中可以得知PIL中“RGB”转换为“CMYK”的公式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C = 255 - R</span><br><span class="line">M = 255 - G</span><br><span class="line">Y = 255 - B</span><br><span class="line">K = 0</span><br></pre></td></tr></table></figure><p>由于该转换公式比较简单，转换后的图像颜色有些失真。</p><p><strong>模式“YCbCr”</strong></p><p>模式“YCbCr”为24位彩色图像，它的每个像素用24个bit表示。YCbCr其中Y是指亮度分量，Cb指蓝色色度分量，而Cr指红色色度分量。人的肉眼对视频的Y分量更敏感，因此在通过对色度分量进行子采样来减少色度分量后，肉眼将察觉不到的图像质量的变化。</p><p>模式“RGB”转换为“YCbCr”的公式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Y= 0.257*R+0.504*G+0.098*B+16</span><br><span class="line">Cb = -0.148*R-0.291*G+0.439*B+128</span><br><span class="line">Cr = 0.439*R-0.368*G-0.071*B+128</span><br></pre></td></tr></table></figure><p><strong>模式“I”</strong></p><p>模式“I”为32位整型灰色图像，它的每个像素用32个bit表示，0表示黑，255表示白，(0,255)之间的数字表示不同的灰度。在PIL中，从模式“RGB”转换为“I”模式是按照下面的公式转换的：</p><p><code>I = R * 299/1000 + G * 587/1000 + B * 114/1000</code></p><p><strong>模式“F”</strong></p><p>模式“F”为32位浮点灰色图像，它的每个像素用32个bit表示，0表示黑，255表示白，(0,255)之间的数字表示不同的灰度。在PIL中，从模式“RGB”转换为“F”模式是按照下面的公式转换的：</p><p><code>F = R * 299/1000+ G * 587/1000 + B * 114/1000</code></p><h3 id="请注意gif文件总是以灰度形式读取-l-或调色板模式-p-图像"><span id="请注意gif文件总是以灰度形式读取-l-或调色板模式-p-图像">请注意，GIF文件总是以灰度形式读取。（ L ）或调色板模式（ P ）图像。</span></h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#pil中所涉及的基本概念&quot;&gt;PIL中所涉及的基本概念&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#pil中有九种不同模式&quot;&gt;PIL中有九种不同模式。&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#请注意gif文件
      
    
    </summary>
    
    
      <category term="Pic" scheme="https://lxb.wiki/categories/Pic/"/>
    
    
      <category term="Python" scheme="https://lxb.wiki/tags/Python/"/>
    
      <category term="Pic" scheme="https://lxb.wiki/tags/Pic/"/>
    
  </entry>
  
  <entry>
    <title>gif图片文件信息</title>
    <link href="https://lxb.wiki/2bf7952d/"/>
    <id>https://lxb.wiki/2bf7952d/</id>
    <published>2020-07-28T13:25:36.000Z</published>
    <updated>2020-11-12T15:25:31.289Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#文件头">文件头</a></li><li><a href="#帧信息描述">帧信息描述</a></li></ul><!-- tocstop --><p>一个GIF文件主要由以下几部分组成。</p><ul><li>文件头</li><li>图像帧信息</li><li>注释</li></ul><h4 id="文件头"><span id="文件头">文件头</span></h4><p>GIF格式文件头和一般文件头差别不大，也包含有</p><ul><li>格式声明</li><li>逻辑屏幕描述块</li><li>全局调色盘</li></ul><p><strong>格式声明</strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/tnZGrhTk4dcOLQJXeHsDogOyXd92N3VtovhRvPDl9xmZGq04CPVHTiboiamvbknPv3ogwpxuf9KDWVusicGPaWXOg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt></p><p>Signature 为“GIF”3 个字符；Version 为“87a”或“89a”3 个字符。</p><p><strong>逻辑屏幕描述块</strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/tnZGrhTk4dcOLQJXeHsDogOyXd92N3VtB20zKIDrePvrWOoK8JzPGISiaNF2qVXHhcZze9hicKFONu46BB8u1RcA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt></p><p>前两字节为像素单位的宽、高，用以标识图片的视觉尺寸。</p><p>Packet里是调色盘信息，分别来看——</p><p>Global Color Table Flag 为全局颜色表标志，即为1时表明全局颜色表有定义。</p><p>Color Resolution 代表颜色表中每种基色位长（需要+1），为111时，每个颜色用8bit表示，即我们熟悉的RGB表示法，一个颜色三字节。</p><p>Sort Flag 表示是否对颜色表里的颜色进行优先度排序，把常用的排在前面，这个主要是为了适应一些颜色解析度低的早期渲染器，现在已经很少使用了。</p><p>Global Color Table 表示颜色表的长度，计算规则是值+1作为2的幂，得到的数字就是颜色表的项数，取最大值111时，项数=256，也就是说GIF格式最多支持256色的位图，再乘以Color Resolution算出的字节数，就是调色盘的总长度。</p><p>这四个字段一起定义了调色盘的信息。</p><p>Background color Index 定义了图像透明区域的背景色在调色盘里的索引。</p><p>Pixel Aspect Ratio 定义了像素宽高比，一般为0。</p><h4 id="帧信息描述"><span id="帧信息描述">帧信息描述</span></h4><p>帧信息描述就是每一帧的图像信息和相关标志位</p><p>大部分GIF存储时采用了公共区域排除和透明区域叠加的优化</p><p><strong>帧数据说明</strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/tnZGrhTk4dcOLQJXeHsDogOyXd92N3VtKP4gCwmicIZYlOgNgibkDbjGRsS0nGJdM3HlfjsWWxeXVmDhrpMzRYfg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#文件头&quot;&gt;文件头&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#帧信息描述&quot;&gt;帧信息描述&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;

&lt;p&gt;一个GIF文件主要由以下几部分组成。&lt;/p&gt;
&lt;ul
      
    
    </summary>
    
    
      <category term="Pic" scheme="https://lxb.wiki/categories/Pic/"/>
    
    
      <category term="GIF" scheme="https://lxb.wiki/tags/GIF/"/>
    
  </entry>
  
  <entry>
    <title>URL特殊字符处理</title>
    <link href="https://lxb.wiki/c587a198/"/>
    <id>https://lxb.wiki/c587a198/</id>
    <published>2020-07-09T22:45:47.000Z</published>
    <updated>2020-11-12T15:25:45.773Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- tocstop --><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> hexVals[<span class="number">16</span>] = &#123;<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'F'</span>&#125;;</span><br><span class="line"><span class="built_in">string</span> CURLEncode::csUnsafeString= <span class="string">"\"&lt;&gt;%\\^[]`+$,@:;/!#?=&amp;"</span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">convert</span><span class="params">(<span class="keyword">char</span> val)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> csRet;</span><br><span class="line">    csRet += <span class="string">"%"</span>;</span><br><span class="line">    csRet += decToHex(val, <span class="number">16</span>);   </span><br><span class="line">    <span class="keyword">return</span>  csRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">decToHex</span><span class="params">(<span class="keyword">char</span> num, <span class="keyword">int</span> radix)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="keyword">int</span>     temp=<span class="number">0</span>;   </span><br><span class="line">    <span class="built_in">string</span>  csTmp;</span><br><span class="line">    <span class="keyword">int</span> num_char;</span><br><span class="line">    num_char = (<span class="keyword">int</span>) num;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// ISO-8859-1 </span></span><br><span class="line">    <span class="comment">// IF THE IF LOOP IS COMMENTED, THE CODE WILL FAIL TO GENERATE A </span></span><br><span class="line">    <span class="comment">// PROPER URL ENCODE FOR THE CHARACTERS WHOSE RANGE IN 127-255(DECIMAL)</span></span><br><span class="line">    <span class="keyword">if</span> (num_char &lt; <span class="number">0</span>)</span><br><span class="line">        num_char = <span class="number">256</span> + num_char;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (num_char &gt;= radix)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = num_char % radix;</span><br><span class="line">        num_char = (<span class="keyword">int</span>)<span class="built_in">floor</span>((num_char / radix) * <span class="number">1.0</span>);</span><br><span class="line">        csTmp = hexVals[temp];</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    csTmp += hexVals[num_char];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(csTmp.length() &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        csTmp += <span class="string">'0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">string</span> strdecToHex = csTmp;</span><br><span class="line">    <span class="comment">// Reverse the String</span></span><br><span class="line">    <span class="built_in">std</span>::reverse(strdecToHex.begin(), strdecToHex.end());</span><br><span class="line">         </span><br><span class="line">    <span class="keyword">return</span> strdecToHex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isUnsafe</span><span class="params">(<span class="keyword">char</span> compareChar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> bcharfound = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> tmpsafeChar;</span><br><span class="line">    <span class="keyword">int</span> m_strLen = <span class="number">0</span>;</span><br><span class="line">     </span><br><span class="line">    m_strLen = csUnsafeString.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ichar_pos = <span class="number">0</span>; ichar_pos &lt; m_strLen ;ichar_pos++)</span><br><span class="line">    &#123;</span><br><span class="line">        tmpsafeChar = csUnsafeString[ichar_pos]; </span><br><span class="line">        <span class="keyword">if</span>(tmpsafeChar == compareChar)</span><br><span class="line">        &#123; </span><br><span class="line">            bcharfound = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> char_ascii_value = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//char_ascii_value = __toascii(compareChar);</span></span><br><span class="line">    char_ascii_value = (<span class="keyword">int</span>) compareChar;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(bcharfound == <span class="literal">false</span> &amp;&amp;  char_ascii_value &gt; <span class="number">32</span> &amp;&amp; char_ascii_value &lt; <span class="number">123</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// found no unsafe chars, return false       </span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">URLEncode</span><span class="params">(<span class="built_in">string</span> strEncode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span>  strSrc;</span><br><span class="line">    <span class="built_in">string</span>    strDest;   </span><br><span class="line"> </span><br><span class="line">    strSrc = strEncode;   </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; strSrc.length(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> ch = strSrc[i];</span><br><span class="line">        <span class="keyword">if</span> (ch &lt; <span class="string">' '</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            ch = ch;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(!isUnsafe(ch))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Safe Character               </span></span><br><span class="line">            strDest += ch;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// get Hex Value of the Character</span></span><br><span class="line">            strDest += convert(ch);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> strDest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;



&lt;!-- tocstop --&gt;

&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
    
      <category term="Web" scheme="https://lxb.wiki/categories/Web/"/>
    
    
  </entry>
  
  <entry>
    <title>url编码解码</title>
    <link href="https://lxb.wiki/fdc9c210/"/>
    <id>https://lxb.wiki/fdc9c210/</id>
    <published>2020-06-24T22:37:14.000Z</published>
    <updated>2020-11-12T15:25:58.321Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- tocstop --><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BURSIZE 2048</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hex2dec</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'0'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'9'</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">'0'</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'a'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'f'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">'a'</span> + <span class="number">10</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">'A'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'F'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> c - <span class="string">'A'</span> + <span class="number">10</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">dec2hex</span><span class="params">(<span class="keyword">short</span> <span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &lt;= c &amp;&amp; c &lt;= <span class="number">9</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> c + <span class="string">'0'</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">10</span> &lt;= c &amp;&amp; c &lt;= <span class="number">15</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> c + <span class="string">'A'</span> - <span class="number">10</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//编码一个url</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">urlencode</span><span class="params">(<span class="keyword">char</span> url[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(url);</span><br><span class="line">    <span class="keyword">int</span> res_len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> res[BURSIZE];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; ++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> c = url[i];</span><br><span class="line">        <span class="keyword">if</span> (    (<span class="string">'0'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'9'</span>) ||</span><br><span class="line">                (<span class="string">'a'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'z'</span>) ||</span><br><span class="line">                (<span class="string">'A'</span> &lt;= c &amp;&amp; c &lt;= <span class="string">'Z'</span>) || </span><br><span class="line">                c == <span class="string">'/'</span> || c == <span class="string">'.'</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            res[res_len++] = c;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> j = (<span class="keyword">short</span> <span class="keyword">int</span>)c;</span><br><span class="line">            <span class="keyword">if</span> (j &lt; <span class="number">0</span>)</span><br><span class="line">                j += <span class="number">256</span>;</span><br><span class="line">            <span class="keyword">int</span> i1, i0;</span><br><span class="line">            i1 = j / <span class="number">16</span>;</span><br><span class="line">            i0 = j - i1 * <span class="number">16</span>;</span><br><span class="line">            res[res_len++] = <span class="string">'%'</span>;</span><br><span class="line">            res[res_len++] = dec2hex(i1);</span><br><span class="line">            res[res_len++] = dec2hex(i0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res[res_len] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(url, res);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 解码url</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">urldecode</span><span class="params">(<span class="keyword">char</span> url[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(url);</span><br><span class="line">    <span class="keyword">int</span> res_len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> res[BURSIZE];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; ++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> c = url[i];</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="string">'%'</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            res[res_len++] = c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> c1 = url[++i];</span><br><span class="line">            <span class="keyword">char</span> c0 = url[++i];</span><br><span class="line">            <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">            num = hex2dec(c1) * <span class="number">16</span> + hex2dec(c0);</span><br><span class="line">            res[res_len++] = num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res[res_len] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(url, res);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> url[<span class="number">100</span>] = <span class="string">"http://'测试/@mike"</span>;</span><br><span class="line">    urlencode(url); <span class="comment">//编码后</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"http://'测试/@mike  ----&gt; %s\n"</span>, url);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">100</span>] = <span class="string">"http%3A//%27%E6%B5%8B%E8%AF%95/%40mike"</span>;</span><br><span class="line">    urldecode(buf); <span class="comment">//解码后</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"http%%3A//%%27%%E6%%B5%%8B%%E8%%AF%%95/%%40mike  ----&gt; %s\n"</span>, buf);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;



&lt;!-- tocstop --&gt;

&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
    
      <category term="Web" scheme="https://lxb.wiki/categories/Web/"/>
    
    
  </entry>
  
  <entry>
    <title>从图片头信息中获取图片格式</title>
    <link href="https://lxb.wiki/be14bd28/"/>
    <id>https://lxb.wiki/be14bd28/</id>
    <published>2020-06-14T22:26:23.000Z</published>
    <updated>2020-11-12T15:26:26.662Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#图片文件头标识分析">图片文件头标识分析</a></li></ul><!-- tocstop --><h3 id="图片文件头标识分析"><span id="图片文件头标识分析">图片文件头标识分析</span></h3><p>一个图片文件的后缀名并不能说明这个图片的真正格式什么，读取图片文件的文件头标识可以获取图片的格式。用十六进制编辑器察看图片的文件头</p><p>1.JPEG</p><ul><li>文件头标识 (2 bytes): $ff, $d8 (SOI) (JPEG 文件标识) </li><li>文件结束标识 (2 bytes): $ff, $d9 (EOI)</li></ul><p>2.TGA</p><ul><li>未压缩的前5字节    00 00 02 00 00</li><li>RLE压缩的前5字节   00 00 10 00 00</li></ul><p>3.PNG</p><ul><li>文件头标识 (8 bytes)   89 50 4E 47 0D 0A 1A 0A</li></ul><p>4.GIF</p><ul><li>文件头标识 (6 bytes)   47 49 46 38 39(37) 61<pre><code>G    I    F     8    9 (7)     a</code></pre></li></ul><p>5.BMP</p><ul><li>文件头标识 (2 bytes)   42 4D<pre><code>B    M</code></pre></li></ul><p>6.PCX</p><ul><li>文件头标识 (1 bytes)   0A</li></ul><p>7.TIFF</p><ul><li>文件头标识 (2 bytes)   4D 4D 或 49 49</li></ul><p>8.ICO</p><ul><li>文件头标识 (8 bytes)   00 00 01 00 01 00 20 20</li></ul><p>9.CUR</p><ul><li>文件头标识 (8 bytes)   00 00 02 00 01 00 20 20</li></ul><p>10.IFF</p><ul><li>文件头标识 (4 bytes)   46 4F 52 4D<pre><code>F    O   R    M</code></pre></li></ul><p>11.ANI</p><ul><li>文件头标识 (4 bytes)   52 49 46 46<pre><code>R     I     F    F</code></pre></li></ul><p>根据这些文件头标识的收集，我可以写一个识别图像格式的模块了。但是在写这个模块之前可以对收集到的文件头标识进行优化，使得程序中字符串比对次数尽量的少。<br>1.JPEG我们知需要比对文件头的$ff, $d8这两个字符，而不用读取最后的两个结束标识了。<br>2.TGA，ICO，CUR只需比对第三个与第五个字符即可。<br>3.PNG比对[89][50]这两个字符。<br>4.GIF比对[47][49][46]与第五个字符。</p><p>模块代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&apos;枚举图片格式种类</span><br><span class="line">Public Enum ImageForm</span><br><span class="line">   [BMP] = 0</span><br><span class="line">   [JPEG] = 1</span><br><span class="line">   [GIF87] = 2</span><br><span class="line">   [GIF89] = 3</span><br><span class="line">   [PNG] = 4</span><br><span class="line">   [TGA Normal] = 5 &apos;TGA未压缩</span><br><span class="line">   [TGA RLE] = 6     &apos;TGA经过RLE压缩后的</span><br><span class="line">   [PCX] = 7</span><br><span class="line">   [TIFF] = 8</span><br><span class="line">   [ICO] = 9</span><br><span class="line">   [CUR] = 10</span><br><span class="line">   [IFF] = 11</span><br><span class="line">   [ANI] = 12</span><br><span class="line">   [Other] = 13</span><br><span class="line">   [FileError] = 14</span><br><span class="line">End Enum</span><br></pre></td></tr></table></figure><p>常用的图片格式有一下几种。</p><ul><li>PNG</li><li>JPEG</li><li>GIF</li><li>WebP 是 Google 制造的一个图片格式，针对网络上快速传输就行了优化</li><li>TIFF/TIF 在数字影响、遥感、医学等领域中得到了广泛的应用。TIFF文件的后缀是.tif或者.tiff</li><li>HEIC iOS11 后，苹果拍照图片的默认格式</li><li>HEIF 用于存储动态图像</li></ul><h5 id="jpge-二进制数据前两个字节数据为"><span id="jpge-二进制数据前两个字节数据为">JPGE 二进制数据前两个字节数据为</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">FF D8</span><br></pre></td></tr></table></figure><h5 id="png"><span id="png">PNG</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">89 50 4E 47 0D 0A 1A 0A</span><br></pre></td></tr></table></figure><h5 id="gif"><span id="gif">GIF</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">47 49 46 38 37 61 or</span><br><span class="line">47 49 46 38 39 61</span><br></pre></td></tr></table></figure><h5 id="tiff"><span id="tiff">TIFF</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">49 20 49 or</span><br><span class="line">49 49 2A 00 or</span><br><span class="line">4D 4D 00 2B or</span><br><span class="line">4D 4D 00 2A</span><br></pre></td></tr></table></figure><h5 id="heic"><span id="heic">HEIC</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">00</span><br></pre></td></tr></table></figure><h5 id="heif"><span id="heif">HEIF</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">00</span><br></pre></td></tr></table></figure><h5 id="webp"><span id="webp">WEBP</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hex Signature</span><br><span class="line">52</span><br></pre></td></tr></table></figure><p>判断 Webp 为什么是截取 0-12 的长度？转换成 ASCII 之后判断的依据？</p><p>在 Google 官方介绍中找到了此图。说明的是：头文件的大小是 <code>12Bytes</code></p><p>WEBP的 header 中写明了 <code>ASCII</code> 是 <code>RIFF</code> 或者 <code>WEBP</code> Google Developer: <a href="https://developers.google.com/speed/webp/docs/riff_container" target="_blank" rel="noopener">developers.google.com/speed/webp/…</a></p><p>demo 代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">enum ImageFormat &#123;</span><br><span class="line">    case Unknow</span><br><span class="line">    case JPEG</span><br><span class="line">    case PNG</span><br><span class="line">    case GIF</span><br><span class="line">    case TIFF</span><br><span class="line">    case WebP</span><br><span class="line">    case HEIC</span><br><span class="line">    case HEIF</span><br><span class="line">&#125;</span><br><span class="line">extension Data &#123;</span><br><span class="line">    func getImageFormat() -&gt; ImageFormat  &#123;</span><br><span class="line">        var buffer = [UInt8](repeating: 0, count: 1)</span><br><span class="line">        self.copyBytes(to: &amp;buffer, count: 1)</span><br><span class="line">        </span><br><span class="line">        switch buffer &#123;</span><br><span class="line">        case [0xFF]: return .JPEG</span><br><span class="line">        case [0x89]: return .PNG</span><br><span class="line">        case [0x47]: return .GIF</span><br><span class="line">        case [0x49],[0x4D]: return .TIFF</span><br><span class="line">        case [0x52] where self.count &gt;= 12:</span><br><span class="line">            if let str = String(data: self[0...11], encoding: .ascii), str.hasPrefix(&quot;RIFF&quot;), str.hasSuffix(&quot;WEBP&quot;) &#123;</span><br><span class="line">                return .WebP</span><br><span class="line">            &#125;</span><br><span class="line">        case [0x00] where self.count &gt;= 12:</span><br><span class="line">            if let str = String(data: self[8...11], encoding: .ascii) &#123;</span><br><span class="line">                let HEICBitMaps = Set([&quot;heic&quot;, &quot;heis&quot;, &quot;heix&quot;, &quot;hevc&quot;, &quot;hevx&quot;])</span><br><span class="line">                if HEICBitMaps.contains(str) &#123;</span><br><span class="line">                    return .HEIC</span><br><span class="line">                &#125;</span><br><span class="line">                let HEIFBitMaps = Set([&quot;mif1&quot;, &quot;msf1&quot;])</span><br><span class="line">                if HEIFBitMaps.contains(str) &#123;</span><br><span class="line">                    return .HEIF</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        default: break;</span><br><span class="line">        &#125;</span><br><span class="line">        return .Unknow</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>C++ 代码1</strong></p><p>Image_file.cpp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;config.h&quot;</span><br><span class="line">#include &quot;ImageFile.h&quot;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">namespace blink &#123;</span><br><span class="line"></span><br><span class="line">#define JPEG_FILE_TYPE          1</span><br><span class="line">#define BMP_FILE_TYPE           2</span><br><span class="line">#define PNG_FILE_TYPE           3</span><br><span class="line">#define GIF_FILE_TYPE           4</span><br><span class="line"></span><br><span class="line">/* </span><br><span class="line">　　通过文件头标识判断图片格式，</span><br><span class="line">　　jpg： FF, D8</span><br><span class="line">　　bmp： 42 4D</span><br><span class="line">　　gif： 47 49 46 38</span><br><span class="line">　　png： 89 50 4E 47</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">int check_fileType(const unsigned char *buf)</span><br><span class="line">&#123;</span><br><span class="line">    if(buf[0] == 0xFF &amp;&amp; buf[1] == 0xd8 &amp;&amp; buf[2] == 0xFF) </span><br><span class="line">    &#123;</span><br><span class="line">        return JPEG_FILE_TYPE; </span><br><span class="line">    &#125;</span><br><span class="line">    if(buf[0] == 0x42 &amp;&amp; buf[1] == 0x4d)</span><br><span class="line">    &#123;</span><br><span class="line">        return BMP_FILE_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line">    if(buf[0] == 0x47 &amp;&amp; buf[1] == 0x49 &amp;&amp; buf[2] == 0x46 &amp;&amp; buf[3] == 0x38)</span><br><span class="line">    &#123;</span><br><span class="line">        return GIF_FILE_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line">    if(buf[0] == 0x89 &amp;&amp; buf[1] == 0x50 &amp;&amp; buf[2] == 0x4e &amp;&amp; buf[3] == 0x47)</span><br><span class="line">    &#123;</span><br><span class="line">        return PNG_FILE_TYPE;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*在构造函数内获取像素宽高：mwidth、mheigh*/</span><br><span class="line"></span><br><span class="line">ImageFile::ImageFile(const String&amp; path)</span><br><span class="line">&#123;</span><br><span class="line">    int type;</span><br><span class="line">    mpath = path;</span><br><span class="line">    mwidth = 0;</span><br><span class="line">    mheight = 0;</span><br><span class="line">    mtype = &quot;&quot;;</span><br><span class="line">    src = (char *)path.utf8().data();</span><br><span class="line">    int i = 0;</span><br><span class="line">    int size;</span><br><span class="line">    unsigned char *buff = NULL;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    if((fp = fopen(src,&quot;rb+&quot;)) == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        mtype = &quot;The file was not opened!&quot;;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    fseek(fp,0,SEEK_END);</span><br><span class="line">    size = ftell(fp);</span><br><span class="line">    buff = (unsigned char*)malloc(size);</span><br><span class="line">    if(buff)</span><br><span class="line">        memset(buff,0,size);</span><br><span class="line">    fseek(fp,0,SEEK_SET);   </span><br><span class="line">    if(fread(buff,1,size,fp)!=size)</span><br><span class="line">    &#123;</span><br><span class="line">        mtype =&quot;read error!&quot;;</span><br><span class="line">        return;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    type = check_fileType(buff);</span><br><span class="line">    switch(type)</span><br><span class="line">    &#123;</span><br><span class="line">        case JPEG_FILE_TYPE:</span><br><span class="line">            mtype = &quot;jpg file!&quot;;</span><br><span class="line">            for(i = 0; i &lt; size ; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if(buff[i] == 0xff &amp;&amp; buff[i+1] == 0xc0)</span><br><span class="line">                &#123;</span><br><span class="line">                    mwidth = (buff[i+7]&lt;&lt;8) | buff[i+8];</span><br><span class="line">                    mheight = (buff[i+5]&lt;&lt;8) | buff[i+6];</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">            </span><br><span class="line">        case BMP_FILE_TYPE:</span><br><span class="line">            mtype = &quot;bmp file!&quot;;</span><br><span class="line">            for(i = 0; i &lt; size ; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if(buff[i] == 0x28 &amp;&amp; buff[i+1] == 0x00)</span><br><span class="line">                &#123;</span><br><span class="line">                    mwidth = (buff[i+7]&lt;&lt;24) | buff[i+6]&lt;&lt;16 | buff[i+5]&lt;&lt;8 | buff[i+4];</span><br><span class="line">                    mheight = (buff[i+11]&lt;&lt;24) | buff[i+10]&lt;&lt;16 | buff[i+9]&lt;&lt;8 | buff[i+8];</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">            </span><br><span class="line">        case PNG_FILE_TYPE:</span><br><span class="line">            mtype = &quot;png file!&quot;;</span><br><span class="line">            for(i = 0; i &lt; size ; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if(buff[i] == 0x49 &amp;&amp; buff[i+1] == 0x48)</span><br><span class="line">                &#123;</span><br><span class="line">                    mheight = (buff[i+8]&lt;&lt;24) | buff[i+9]&lt;&lt;16 | buff[i+10]&lt;&lt;8 | buff[i+11];</span><br><span class="line">                    mwidth = (buff[i+4]&lt;&lt;24) | buff[i+5]&lt;&lt;16 | buff[i+6]&lt;&lt;8 | buff[i+7];</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">            </span><br><span class="line">        case GIF_FILE_TYPE:</span><br><span class="line">            mtype = &quot;gif file!&quot;;</span><br><span class="line">            for(i = 0; i &lt; size ; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if(buff[i] == 0x00 &amp;&amp; buff[i+1] == 0x2c)</span><br><span class="line">                &#123;</span><br><span class="line">                    mwidth = (buff[i+7]&lt;&lt;8) | buff[i+6];</span><br><span class="line">                    mheight = (buff[i+9]&lt;&lt;8) | buff[i+8];</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">    free(buff);</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">String ImageFile::type() const</span><br><span class="line">&#123;</span><br><span class="line">    return mtype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String ImageFile::location() const</span><br><span class="line">&#123;</span><br><span class="line">    int length = mpath.length();</span><br><span class="line">    int pos = mpath.reverseFind(&apos;/&apos;);</span><br><span class="line">    </span><br><span class="line">    while (pos == length - 1)</span><br><span class="line">    &#123;</span><br><span class="line">        pos = mpath.reverseFind(&apos;/&apos; ,pos - 1);</span><br><span class="line">        length--;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (pos &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return mpath.substring(0,pos + 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String ImageFile::fileName() const</span><br><span class="line">&#123;</span><br><span class="line">    int length = mpath.length();</span><br><span class="line">    int pos = mpath.reverseFind(&apos;/&apos;);</span><br><span class="line">    </span><br><span class="line">    while (pos == length - 1)</span><br><span class="line">    &#123;</span><br><span class="line">        pos = mpath.reverseFind(&apos;/&apos; , pos - 1);</span><br><span class="line">        length--;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (pos &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return mpath.substring(pos + 1,length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">double ImageFile::width() const</span><br><span class="line">&#123;</span><br><span class="line">    return mwidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">double ImageFile::height() const</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    return mheight;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>image_file.h</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ImageFile_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ImageFile_H</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> blink &#123;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">ImageFile</span>  &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> ImageFile* <span class="title">create</span><span class="params">(<span class="keyword">const</span> String&amp; path)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        FILE* fS;</span><br><span class="line">        fS =fopen(path.utf8().data(),<span class="string">"r"</span>);</span><br><span class="line">        <span class="keyword">if</span>(fS !=<span class="literal">NULL</span>)</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            <span class="keyword">int</span> iLen = path.length() ;</span><br><span class="line">            <span class="keyword">int</span> iPos = path.reverseFind(<span class="string">'.'</span>);</span><br><span class="line">            <span class="keyword">if</span> (iPos &lt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String name=path.substring(iPos + <span class="number">1</span>, iLen);</span><br><span class="line">            <span class="keyword">char</span> s1[<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">char</span> s2[]=<span class="string">"jpg"</span>;</span><br><span class="line">            <span class="keyword">char</span> s3[]=<span class="string">"bmp"</span>;</span><br><span class="line">            <span class="keyword">char</span> s4[]=<span class="string">"gif"</span>;</span><br><span class="line">            <span class="keyword">char</span> s5[]=<span class="string">"png"</span>;</span><br><span class="line">            <span class="keyword">char</span> s6[]=<span class="string">"jpeg"</span>;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;name.length();i++)</span><br><span class="line">                s1[i] = name[i];</span><br><span class="line">            s1[i] = <span class="string">'\0'</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strncmp</span>(s1,s2,<span class="number">3</span>)==<span class="number">0</span> || <span class="built_in">strncmp</span>(s1,s3,<span class="number">3</span>)==<span class="number">0</span> || <span class="built_in">strncmp</span>(s1,s4,<span class="number">3</span>)==<span class="number">0</span> || <span class="built_in">strncmp</span>(s1,s5,<span class="number">3</span>)==<span class="number">0</span>|| <span class="built_in">strncmp</span>(s1,s6,<span class="number">4</span>)==<span class="number">0</span>) </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> NGBImageFile(path);     <span class="comment">//路径正确且图片文件格式是以上四种，创建文件对象</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NULL</span>;       </span><br><span class="line">        &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">type</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">location</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">fileName</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">width</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">height</span><span class="params">()</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    ImageFile(<span class="keyword">const</span> String&amp; path);</span><br><span class="line">    <span class="keyword">char</span>* src;</span><br><span class="line">    String mpath;</span><br><span class="line">    String mtype;</span><br><span class="line">    <span class="keyword">double</span> mwidth;</span><br><span class="line">    <span class="keyword">double</span> mheight;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace blink</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// ImageFile_H</span></span></span><br></pre></td></tr></table></figure><p><strong>Qt 代码</strong></p><p>imageinfo.h</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#ifndef IMAGEINFO_H</span><br><span class="line">#define IMAGEINFO_H</span><br><span class="line">#include &lt;QObject&gt;</span><br><span class="line">#include &lt;QDebug&gt;</span><br><span class="line">#include &lt;QUrl&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;QSize&gt;</span><br><span class="line">#include &lt;QDate&gt;</span><br><span class="line">class ImageInfo : public QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">    enum IMAGE_FORMAT&#123;</span><br><span class="line">        BMP_FORMAT,</span><br><span class="line">        JPG_FORMAT,</span><br><span class="line">        GIF_FORMAT,</span><br><span class="line">        PNG_FORMAT,</span><br><span class="line">        NVL_FORMAT</span><br><span class="line">    &#125;;</span><br><span class="line">public:</span><br><span class="line">    explicit ImageInfo(QObject *parent = 0);</span><br><span class="line">    ~ImageInfo();</span><br><span class="line">public:</span><br><span class="line">    Q_INVOKABLE QString getImageFormat(QString imageUrl);</span><br><span class="line">    Q_INVOKABLE QString getImageSize(QString imageUrl);</span><br><span class="line">    Q_INVOKABLE QSize getImageDimension(QString imageUrl);</span><br><span class="line">    Q_INVOKABLE QDate getImageDate(QString imageUrl);</span><br><span class="line">    Q_INVOKABLE QString getImageTitle(QString imageUrl);</span><br><span class="line">Q_SIGNALS:</span><br><span class="line">public Q_SLOTS :</span><br><span class="line">private:</span><br><span class="line">    int getImageFormat(std::string path);</span><br><span class="line">    long getBMPSize(std::string path);</span><br><span class="line">    long getGIFSize(std::string path);</span><br><span class="line">    long getPNGSize(std::string path);</span><br><span class="line">    long getJPGSize(std::string path);</span><br><span class="line">    QSize getBMPDimension(std::string path);</span><br><span class="line">    QSize getPNGDimension(std::string path);</span><br><span class="line">    QSize getJPGDimension(std::string path);</span><br><span class="line">    QSize getGIFDimension(std::string path);</span><br><span class="line">&#125;;</span><br><span class="line">#endif // IMAGEINFO_H</span><br></pre></td></tr></table></figure><p>imageinfo.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"imageinfo.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QFile&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QFileInfo&gt;</span></span></span><br><span class="line"></span><br><span class="line">ImageInfo::ImageInfo(QObject *parent) :</span><br><span class="line">    QObject(parent)</span><br><span class="line">&#123;</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">"---------------------------- image info constructed "</span>;</span><br><span class="line">&#125;</span><br><span class="line">ImageInfo::~ImageInfo()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">QDate ImageInfo::getImageDate(QString imageUrl)</span><br><span class="line">&#123;</span><br><span class="line">    QDate date;</span><br><span class="line">    <span class="keyword">if</span>(!imageUrl.isEmpty()) &#123;</span><br><span class="line">        <span class="function">QUrl <span class="title">fileUrl</span><span class="params">(imageUrl)</span></span>;</span><br><span class="line">        QString filePath = fileUrl.toLocalFile();</span><br><span class="line">        <span class="keyword">if</span>(QFile::exists(filePath)) &#123;</span><br><span class="line">            <span class="function">QFileInfo <span class="title">fileinfo</span><span class="params">(filePath)</span></span>;</span><br><span class="line">            date = fileinfo.lastModified().date();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> date;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//从文件头中读取相应字段以判断图片格式</span></span><br><span class="line"><span class="comment">//详情参看: http://www.garykessler.net/library/file_sigs.html</span></span><br><span class="line"><span class="keyword">int</span> ImageInfo::getImageFormat(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//BMP格式特征码</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> BMPHeader[] = &#123;<span class="number">0x42</span>, <span class="number">0x4d</span>&#125;;</span><br><span class="line">    <span class="comment">//JPG,JPEG格式特征码</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> JPGHeader1[] = &#123;<span class="number">0xff</span>, <span class="number">0xd8</span>, <span class="number">0xff</span>, <span class="number">0xdb</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> JPGHeader2[] = &#123;<span class="number">0xff</span>, <span class="number">0xd8</span>, <span class="number">0xff</span>, <span class="number">0xe0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> JPGHeader3[] = &#123;<span class="number">0xff</span>, <span class="number">0xd8</span>, <span class="number">0xff</span>, <span class="number">0xe1</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> JPGHeader4[] = &#123;<span class="number">0xff</span>, <span class="number">0xd8</span>, <span class="number">0xff</span>, <span class="number">0xe2</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> JPGHeader5[] = &#123;<span class="number">0xff</span>, <span class="number">0xd8</span>, <span class="number">0xff</span>, <span class="number">0xe3</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> JPGHeader6[] = &#123;<span class="number">0xff</span>, <span class="number">0xd8</span>, <span class="number">0xff</span>, <span class="number">0xe8</span>&#125;;</span><br><span class="line">    <span class="comment">//GIF格式特征码</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> GIFHeader1[] = &#123;<span class="number">0x47</span>, <span class="number">0x49</span>, <span class="number">0x46</span>, <span class="number">0x38</span>, <span class="number">0x37</span>, <span class="number">0x61</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> GIFHeader2[] = &#123;<span class="number">0x47</span>, <span class="number">0x49</span>, <span class="number">0x46</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x61</span>&#125;;</span><br><span class="line">    <span class="comment">//PNG格式特征码</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> PNGHeader[] = &#123;<span class="number">0x89</span>, <span class="number">0x50</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> step = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//以二进制方式打开文件并读取前几个字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> header[<span class="number">16</span>];</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"文件路径: "</span>&lt;&lt;path.c_str();</span><br><span class="line">    <span class="built_in">std</span>::<span class="function">ifstream <span class="title">readf</span><span class="params">(path.c_str(), <span class="built_in">std</span>::ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span>(!readf.is_open()) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">        <span class="keyword">return</span> NVL_FORMAT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//先读两个，判断是否BMP格式</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;step; i++) &#123;</span><br><span class="line">        readf&gt;&gt;header[count+i];</span><br><span class="line">    &#125;</span><br><span class="line">    count = count + step;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">memcmp</span>(header, BMPHeader, count) == <span class="number">0</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"文件格式特征码:"</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%0x\t"</span>,header[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"BMP格式"</span>;</span><br><span class="line">        <span class="keyword">return</span> BMP_FORMAT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//再读两个，判断是否JPG格式、PNG格式</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;step; i++) &#123;</span><br><span class="line">        readf&gt;&gt;header[count+i];</span><br><span class="line">    &#125;</span><br><span class="line">    count = count + step;</span><br><span class="line">    <span class="keyword">if</span>((<span class="built_in">memcmp</span>(header, JPGHeader1, count) == <span class="number">0</span>)</span><br><span class="line">            || (<span class="built_in">memcmp</span>(header, JPGHeader2, count) == <span class="number">0</span>)</span><br><span class="line">            || (<span class="built_in">memcmp</span>(header, JPGHeader3, count) == <span class="number">0</span>)</span><br><span class="line">            || (<span class="built_in">memcmp</span>(header, JPGHeader4, count) == <span class="number">0</span>)</span><br><span class="line">            || (<span class="built_in">memcmp</span>(header, JPGHeader5, count) == <span class="number">0</span>)</span><br><span class="line">            || (<span class="built_in">memcmp</span>(header, JPGHeader6, count) == <span class="number">0</span>)) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"文件格式特征码:"</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%0x\t"</span>,header[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"JPG格式"</span>;</span><br><span class="line">        <span class="keyword">return</span> JPG_FORMAT;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">memcmp</span>(header, PNGHeader, count) == <span class="number">0</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"文件格式特征码:"</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%0x\t"</span>,header[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"PNG格式"</span>;</span><br><span class="line">        <span class="keyword">return</span> PNG_FORMAT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//再读两个，判断是否GIF格式</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;step; i++) &#123;</span><br><span class="line">        readf&gt;&gt;header[count+i];</span><br><span class="line">    &#125;</span><br><span class="line">    count = count + step;</span><br><span class="line">    <span class="keyword">if</span>((<span class="built_in">memcmp</span>(header, GIFHeader1, count) == <span class="number">0</span>)</span><br><span class="line">            || (<span class="built_in">memcmp</span>(header, GIFHeader2, count) == <span class="number">0</span>)) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"文件格式特征码:"</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%0x\t"</span>,header[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"GIF格式"</span>;</span><br><span class="line">        <span class="keyword">return</span> GIF_FORMAT;</span><br><span class="line">    &#125;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"文件格式特征码:"</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%0x\t"</span>,header[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"不属于以上任何一种格式"</span>;</span><br><span class="line">    <span class="keyword">return</span> NVL_FORMAT;</span><br><span class="line">&#125;</span><br><span class="line">QString ImageInfo::getImageFormat(QString imageUrl)</span><br><span class="line">&#123;</span><br><span class="line">    QString strFormat = <span class="string">"NA"</span>;</span><br><span class="line">    <span class="keyword">if</span>(!imageUrl.isEmpty()) &#123;</span><br><span class="line">        <span class="function">QUrl <span class="title">fileUrl</span><span class="params">(imageUrl)</span></span>;</span><br><span class="line">        QString filePath = fileUrl.toLocalFile();</span><br><span class="line">        <span class="keyword">if</span>(QFile::exists(filePath)) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> path = filePath.toStdString();</span><br><span class="line">            <span class="keyword">int</span> iFormat = getImageFormat(path);</span><br><span class="line">            <span class="keyword">switch</span>(iFormat) &#123;</span><br><span class="line">            <span class="keyword">case</span> BMP_FORMAT:</span><br><span class="line">                strFormat = <span class="string">"BMP"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> JPG_FORMAT:</span><br><span class="line">                strFormat = <span class="string">"JPG"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> GIF_FORMAT:</span><br><span class="line">                strFormat = <span class="string">"GIF"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PNG_FORMAT:</span><br><span class="line">                strFormat = <span class="string">"PNG"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strFormat;</span><br><span class="line">&#125;</span><br><span class="line">QString ImageInfo::getImageSize(QString imageUrl)</span><br><span class="line">&#123;</span><br><span class="line">    QString strSize;</span><br><span class="line">    <span class="keyword">long</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!imageUrl.isEmpty()) &#123;</span><br><span class="line">        <span class="function">QUrl <span class="title">fileUrl</span><span class="params">(imageUrl)</span></span>;</span><br><span class="line">        QString filePath = fileUrl.toLocalFile();</span><br><span class="line">        <span class="keyword">if</span>(QFile::exists(filePath)) &#123;</span><br><span class="line">            <span class="function">QFile <span class="title">file</span><span class="params">(filePath)</span></span>;</span><br><span class="line">            <span class="keyword">bool</span> ret = file.open(QIODevice::ReadOnly);</span><br><span class="line">            <span class="keyword">if</span> (!ret) &#123;</span><br><span class="line">                qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">                size = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                size = file.size();</span><br><span class="line">            &#125;</span><br><span class="line">            file.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"!!!!!"</span>&lt;&lt;size;</span><br><span class="line">    strSize = QString::number(size, <span class="number">10</span>);</span><br><span class="line">    qDebug()&lt;&lt;strSize;</span><br><span class="line">    <span class="keyword">return</span> strSize;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//BMP文件头的第2、3字为文件大小信息</span></span><br><span class="line"><span class="keyword">long</span> ImageInfo::getBMPSize(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fid;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">if</span>((fid=fopen(path.c_str(),<span class="string">"rb+"</span>))==<span class="literal">NULL</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//跳过图片特征码</span></span><br><span class="line">    fseek(fid, <span class="number">2</span>, SEEK_SET);</span><br><span class="line">    fread(&amp;size, <span class="keyword">sizeof</span>(<span class="keyword">long</span>), <span class="number">1</span>, fid);</span><br><span class="line">    fclose(fid);</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"size="</span>&lt;&lt;size;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> ImageInfo::getGIFSize(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    Q_UNUSED(path);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> ImageInfo::getPNGSize(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    Q_UNUSED(path);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> ImageInfo::getJPGSize(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fid;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">if</span>((fid = fopen(path.c_str(),<span class="string">"rb+"</span>)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fseek(fid, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    size = ftell(fid);</span><br><span class="line">    fclose(fid);</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"size="</span>&lt;&lt;size;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//BMP文件头的第10、11字为文件宽度信息</span></span><br><span class="line"><span class="comment">//BMP文件头的第12、13字为文件高度信息</span></span><br><span class="line">QSize ImageInfo::getBMPDimension(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fid;</span><br><span class="line">    <span class="keyword">if</span>((fid=fopen(path.c_str(),<span class="string">"rb+"</span>))==<span class="literal">NULL</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">        <span class="keyword">return</span> QSize(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="comment">//读取宽度和高度</span></span><br><span class="line">    fseek(fid, <span class="number">18</span>, SEEK_SET); <span class="comment">//偏移18个字节</span></span><br><span class="line">    fread(&amp;width, <span class="keyword">sizeof</span>(<span class="keyword">long</span>), <span class="number">1</span>, fid);</span><br><span class="line">    fread(&amp;height, <span class="keyword">sizeof</span>(<span class="keyword">long</span>), <span class="number">1</span>, fid);</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"width="</span>&lt;&lt;width;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"height="</span>&lt;&lt;height;</span><br><span class="line">    fclose(fid);</span><br><span class="line">    <span class="keyword">return</span> QSize(width, height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参考： http://mcljc.blog.163.com/blog/static/83949820102239610974/</span></span><br><span class="line"><span class="comment">//http://download.csdn.net/download/chp845/4255011</span></span><br><span class="line">QSize ImageInfo::getJPGDimension(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fid;</span><br><span class="line">    <span class="keyword">if</span>((fid = fopen(path.c_str(),<span class="string">"rb+"</span>)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">        <span class="keyword">return</span> QSize(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> height;</span><br><span class="line">    fseek(fid,<span class="number">0</span>,SEEK_END);</span><br><span class="line">    <span class="keyword">long</span> length = ftell(fid);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *buffer = <span class="keyword">new</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>[length];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *buffer_bakup = buffer;</span><br><span class="line">    fseek(fid, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">    fread(buffer, length, <span class="number">1</span>, fid);</span><br><span class="line">    fclose(fid);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *temp = buffer + length;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *temp_ori = buffer;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> ff;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> type=<span class="number">0xff</span>;</span><br><span class="line">    <span class="keyword">int</span> m_pos = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//跳过文件头中标志文件类型的两个字节</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++) &#123;</span><br><span class="line">        buffer++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>((temp &gt; buffer) &amp;&amp; (type != <span class="number">0xDA</span>)) &#123;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            ff = *buffer++;</span><br><span class="line">        &#125; <span class="keyword">while</span>(ff != <span class="number">0xff</span>);</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            type = *buffer++;</span><br><span class="line">        &#125; <span class="keyword">while</span>(type == <span class="number">0xff</span>);</span><br><span class="line">        <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x00</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x01</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD0</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD1</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD2</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD3</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD4</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD5</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD6</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xD7</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xC0</span>:<span class="comment">//SOF0段</span></span><br><span class="line">            temp_ori = buffer;</span><br><span class="line">            m_pos = (*buffer++)&lt;&lt;<span class="number">8</span>;</span><br><span class="line">            m_pos += *buffer++;</span><br><span class="line">            buffer++; <span class="comment">//舍弃精度值</span></span><br><span class="line">            height = (*buffer++)&lt;&lt;<span class="number">8</span>;</span><br><span class="line">            height += *buffer++;</span><br><span class="line">            width = (*buffer++)&lt;&lt;<span class="number">8</span>;</span><br><span class="line">            width += *buffer;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xE0</span>: <span class="comment">//APP0段</span></span><br><span class="line">            qDebug()&lt;&lt;<span class="string">"APP0段"</span>;</span><br><span class="line">            temp_ori = buffer;</span><br><span class="line">            m_pos = (*buffer++)&lt;&lt;<span class="number">8</span>;</span><br><span class="line">            m_pos += *buffer++;</span><br><span class="line">            buffer = buffer + <span class="number">12</span>;</span><br><span class="line">            <span class="comment">//丢弃APP0标记(5bytes)、主版本号(1bytes)、次版本号(1bytes)、像素点单位(1bytes)、垂直像素点(2bytes)、 水平像素点(2bytes)</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            temp_ori = buffer;</span><br><span class="line">            m_pos = (*buffer++)&lt;&lt;<span class="number">8</span>;</span><br><span class="line">            m_pos += *buffer++;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        buffer = temp_ori + m_pos;</span><br><span class="line">    &#125;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"width="</span>&lt;&lt;width;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"height="</span>&lt;&lt;height;</span><br><span class="line">    <span class="comment">//记得释放内存</span></span><br><span class="line">    <span class="keyword">delete</span>[] buffer_bakup;</span><br><span class="line">    <span class="keyword">return</span> QSize(width, height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//PNG文件头的第9字为文件宽度信息</span></span><br><span class="line"><span class="comment">//PNG文件头的第10字为文件高度信息</span></span><br><span class="line"><span class="comment">//参考：http://blog.chinaunix.net/uid-25799257-id-3358174.html</span></span><br><span class="line">QSize ImageInfo::getPNGDimension(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fid = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>((fid=fopen(path.c_str(),<span class="string">"rb+"</span>))==<span class="literal">NULL</span>) &#123;</span><br><span class="line">        qDebug()&lt;&lt;<span class="string">"打开文件失败"</span>;</span><br><span class="line">        <span class="keyword">return</span> QSize(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> wtmp[<span class="number">4</span>]=&#123;<span class="string">'0'</span>&#125;;   <span class="comment">//宽度</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> htmp[<span class="number">4</span>]=&#123;<span class="string">'0'</span>&#125;;   <span class="comment">//高度</span></span><br><span class="line">    fseek(fid, <span class="number">16</span>, SEEK_SET);</span><br><span class="line">    fread(wtmp, <span class="number">4</span>, <span class="number">1</span>, fid);         <span class="comment">// example 00000080</span></span><br><span class="line">    fread(htmp, <span class="number">4</span>, <span class="number">1</span>, fid);         <span class="comment">// example 00000080</span></span><br><span class="line">    fclose(fid);</span><br><span class="line">    width = ((<span class="keyword">int</span>)(<span class="keyword">unsigned</span> <span class="keyword">char</span>)wtmp[<span class="number">2</span>]) * <span class="number">256</span> + (<span class="keyword">int</span>)(<span class="keyword">unsigned</span> <span class="keyword">char</span>)wtmp[<span class="number">3</span>];</span><br><span class="line">    height = ((<span class="keyword">int</span>)(<span class="keyword">unsigned</span> <span class="keyword">char</span>)htmp[<span class="number">2</span>]) * <span class="number">256</span> + (<span class="keyword">int</span>)(<span class="keyword">unsigned</span> <span class="keyword">char</span>)htmp[<span class="number">3</span>];</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"width="</span>&lt;&lt;width;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"height="</span>&lt;&lt;height;</span><br><span class="line">    <span class="keyword">return</span> QSize(width, height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//GIF文件头的第4字为文件宽度信息</span></span><br><span class="line"><span class="comment">//GIF文件头的第5字为文件高度信息</span></span><br><span class="line"><span class="comment">//参考：http://blog.csdn.net/zhaoweikid/article/details/156422</span></span><br><span class="line"><span class="comment">//参考：http://blog.csdn.net/asaasa66/article/details/5875340</span></span><br><span class="line">QSize ImageInfo::getGIFDimension(<span class="built_in">std</span>::<span class="built_in">string</span> path)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="function">ifstream <span class="title">ffin</span><span class="params">(path.c_str(), <span class="built_in">std</span>::ios::binary)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!ffin)&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"Can not open this file."</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> QSize(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="keyword">char</span> s1[<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;, s2[<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ffin.seekg(<span class="number">6</span>);</span><br><span class="line">    ffin.read(s1, <span class="number">2</span>);</span><br><span class="line">    ffin.read(s2, <span class="number">2</span>);</span><br><span class="line">    width = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(s1[<span class="number">1</span>])&lt;&lt;<span class="number">8</span>|(<span class="keyword">unsigned</span> <span class="keyword">int</span>)(s1[<span class="number">0</span>]);</span><br><span class="line">    height = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(s2[<span class="number">1</span>])&lt;&lt;<span class="number">8</span>|(<span class="keyword">unsigned</span> <span class="keyword">int</span>)(s2[<span class="number">0</span>]);</span><br><span class="line">    ffin.close();</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"width="</span>&lt;&lt;width;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"height="</span>&lt;&lt;height;</span><br><span class="line">    <span class="keyword">return</span> QSize(width, height);</span><br><span class="line">&#125;</span><br><span class="line">QSize ImageInfo::getImageDimension(QString imageUrl)</span><br><span class="line">&#123;</span><br><span class="line">    QSize dimension;</span><br><span class="line">    <span class="keyword">if</span>(!imageUrl.isEmpty()) &#123;</span><br><span class="line">        <span class="function">QUrl <span class="title">fileUrl</span><span class="params">(imageUrl)</span></span>;</span><br><span class="line">        QString filePath = fileUrl.toLocalFile();</span><br><span class="line">        <span class="keyword">if</span>(QFile::exists(filePath)) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> path = filePath.toStdString();</span><br><span class="line">            <span class="keyword">int</span> iFormat = getImageFormat(path);</span><br><span class="line">            <span class="keyword">switch</span>(iFormat) &#123;</span><br><span class="line">            <span class="keyword">case</span> BMP_FORMAT:</span><br><span class="line">                dimension = getBMPDimension(path);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> JPG_FORMAT:</span><br><span class="line">                dimension = getJPGDimension(path);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> GIF_FORMAT:</span><br><span class="line">                dimension = getGIFDimension(path);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PNG_FORMAT:</span><br><span class="line">                dimension = getPNGDimension(path);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    qDebug()&lt;&lt;<span class="string">"图片尺寸:"</span>&lt;&lt;dimension;</span><br><span class="line">    <span class="keyword">return</span> dimension;</span><br><span class="line">&#125;</span><br><span class="line">QString ImageInfo::getImageTitle(QString imageUrl)</span><br><span class="line">&#123;</span><br><span class="line">    QString title;</span><br><span class="line">    <span class="keyword">if</span>(!imageUrl.isEmpty()) &#123;</span><br><span class="line">        <span class="function">QUrl <span class="title">fileUrl</span><span class="params">(imageUrl)</span></span>;</span><br><span class="line">        QString filePath = fileUrl.toLocalFile();</span><br><span class="line">        <span class="keyword">if</span>(QFile::exists(filePath)) &#123;</span><br><span class="line">            <span class="function">QFileInfo <span class="title">fileinfo</span><span class="params">(filePath)</span></span>;</span><br><span class="line">            title = fileinfo.baseName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#图片文件头标识分析&quot;&gt;图片文件头标识分析&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;

&lt;h3 id=&quot;图片文件头标识分析&quot;&gt;&lt;span id=&quot;图片文件头标识分析&quot;&gt;图片文件头标识分析&lt;/sp
      
    
    </summary>
    
    
      <category term="Pic" scheme="https://lxb.wiki/categories/Pic/"/>
    
    
      <category term="Pic" scheme="https://lxb.wiki/tags/Pic/"/>
    
  </entry>
  
  <entry>
    <title>Go 1.14 中接口的菱形组合</title>
    <link href="https://lxb.wiki/ace0b2ab/"/>
    <id>https://lxb.wiki/ace0b2ab/</id>
    <published>2020-06-01T13:00:20.000Z</published>
    <updated>2020-06-01T13:03:28.408Z</updated>
    
    <content type="html"><![CDATA[<p>按照<a href="https://github.com/golang/proposal/blob/master/design/6977-overlapping-interfaces.md" target="_blank" rel="noopener">部分重叠的接口提议</a>，Go 1.14 现在允许嵌入有部分方法重叠的接口。本文是一篇解释这次修改的简要说明。</p><p>我们先来看 io 包中的三个关键接口：io.Reader、io.Writer 和 io.Closer：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">Read([]<span class="keyword">byte</span>) (<span class="keyword">int</span>, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">Write([]<span class="keyword">byte</span>) (<span class="keyword">int</span>, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Closer <span class="keyword">interface</span> &#123;</span><br><span class="line">Close() error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在结构体中嵌入类型时，如果在结构体中声明了被嵌入的类型，那么该类型的字段和方法允许被访问<a href="也就是说，嵌入提升了类型的字段和方法。">^1</a>，对于接口来说这个处理也成立。因此下面两种方式：显式声明</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadCloser <span class="keyword">interface</span> &#123;</span><br><span class="line">Read([]<span class="keyword">byte</span>) (<span class="keyword">int</span>, error)</span><br><span class="line">Close() error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>和使用嵌入来组成接口</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadCloser <span class="keyword">interface</span> &#123;</span><br><span class="line">Reader</span><br><span class="line">Closer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没有区别。</p><p>你甚至可以混合使用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> WriteCloser <span class="keyword">interface</span> &#123;</span><br><span class="line">Write([]<span class="keyword">byte</span>) (<span class="keyword">int</span>, error)</span><br><span class="line">Closer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然而，在 Go 1.14 之前，如果你用这种方式来声明接口，你可能会得到类似这样的结果：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadWriteCloser <span class="keyword">interface</span> &#123;</span><br><span class="line">ReadCloser</span><br><span class="line">WriterCloser</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% Go build interfaces.go</span><br><span class="line"><span class="built_in">command</span>-line-arguments</span><br><span class="line">./interfaces.go:27:2: duplicate method Close</span><br></pre></td></tr></table></figure><p>幸运的是，在 Go 1.14 中这不再是一个限制了，因此这个改动解决了在菱形嵌入时出现的问题。</p><p>然而，在我向本地的用户组解释这个特性时也陷入了麻烦 — 只有 Go 编译器使用 1.14（或更高版本）语言规范时才支持这个特性。</p><p>我理解的编译过程中 Go 语言规范所使用的版本的规则似乎是这样的：</p><ol><li>如果你的源码是在 GOPATH 下（或者你用 GO111MODULE=off <em>关闭</em>了 module），那么 Go 语言规范会使用你编译器的版本来编译。换句话说，如果安装了 Go 1.13，那么你的 Go 版本就是 1.13。如果你安装了 Go 1.14，那么你的版本就是 1.14。这里符合认知。</li><li>如果你的源码保存在 GOPATH 外（或你用 GO111MODULE=on 强制开启了 module），那么 Go tool 会从 go.mod 文件中获取 Go 版本。</li><li>如果 go.mod 中没有列出 Go 版本，那么语言规范会使用安装的 Go 的版本。这跟第 1 点是一致的。</li><li>如果你用的是 Go module 模式，不管是源码在 GOPATH 外还是设置了 GO111MODULE=on，但是在当前目录或所有父目录中都没有 go.mod 文件，那么 Go 语言规范会默认用 Go 1.13 版本来编译你的代码。</li></ol><p>我曾经遇到过第 4 点的情况。</p><hr><p>via: <a href="https://dave.cheney.net/2020/05/24/diamond-interface-composition-in-go-1-14" target="_blank" rel="noopener">https://dave.cheney.net/2020/05/24/diamond-interface-composition-in-go-1-14</a></p><p>作者：<a href="https://dave.cheney.net/" target="_blank" rel="noopener">Dave Cheney</a> </p><p>译者：<a href="https://github.com/lxbwolf" target="_blank" rel="noopener">lxbwolf</a> </p><p>校对：<a href="https://github.com/polaris1119" target="_blank" rel="noopener">polaris1119</a></p><p>本文由 <a href="https://github.com/studygolang/GCTT" target="_blank" rel="noopener">GCTT</a> 原创编译，<a href="https://studygolang.com/" target="_blank" rel="noopener">Go 中文网</a> 荣誉推出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;按照&lt;a href=&quot;https://github.com/golang/proposal/blob/master/design/6977-overlapping-interfaces.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;部分重叠的接口提议
      
    
    </summary>
    
    
      <category term="Golang" scheme="https://lxb.wiki/categories/Golang/"/>
    
    
      <category term="Go" scheme="https://lxb.wiki/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>树莓派安装TT-RSS</title>
    <link href="https://lxb.wiki/afdc720c/"/>
    <id>https://lxb.wiki/afdc720c/</id>
    <published>2020-05-30T14:05:48.000Z</published>
    <updated>2020-05-30T14:07:10.012Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://tt-rss.org/" target="_blank" rel="noopener">Tiny Tiny RSS</a>（TT-RSS）是一个自由开源的基于 Web 的新闻<ruby>馈送<rt>feed</rt></ruby>（RSS/Atom）阅读器和聚合工具。它非常适合那些注重隐私，并且仍然依赖 RSS 来获取日常新闻的人。TT-RSS 是自行托管的软件，因此你可以 100% 的掌控你的服务器、数据以及你的全部隐私。它还支持大量的插件、扩展和主题。你喜欢黑暗模式的界面？没问题。想基于关键词过滤发来的消息？TT-RSS 也能让你得偿所愿。</p><p><img src="https://opensource.com/sites/default/files/uploads/tt-rss.jpeg" alt="Tiny Tiny RSS screenshot" title="Tiny Tiny RSS screenshot"></p><p>现在你知道 TT-RSS 是什么了，那么为什么你可能会想用它。我会讲述要把它安装到树莓派或 Debian 10 服务器上你需要了解的所有的东西。</p><h3 id="安装和配置-tt-rss"><span id="安装和配置-tt-rss">安装和配置 TT-RSS</span></h3><p>要把 TT-RSS 安装到树莓派上，你还需要安装和配置最新版本的 PHP（本文撰写时 PHP 最新版本是 7.3）、后端数据库 PostgreSQL、Nginx web 服务器、Git，最后才是 TT-RSS。</p><h4 id="1-安装-php-7"><span id="1-安装-php-7">1、安装 PHP 7</span></h4><p>安装 PHP 7 是整个过程中最复杂的部分。幸运的是，它并不像看起来那样困难。从安装下面的支持包开始：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install -y ca-certificates apt-transport-https</span><br></pre></td></tr></table></figure><p>现在，添加存储库 PGP 密钥：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -q https://packages.sury.org/php/apt.gpg -O- | sudo apt-key add -</span><br></pre></td></tr></table></figure><p>下一步，把 PHP 库添加到你的 apt 源：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;deb https://packages.sury.org/php/ buster main&quot; | sudo tee /etc/apt/sources.list.d/php.list</span><br></pre></td></tr></table></figure><p>然后更新你的存储库索引：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br></pre></td></tr></table></figure><p>最后，安装 PHP 7.3（或最新版本）和一些通用组件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install -y php7.3 php7.3-cli php7.3-fpm php7.3-opcache php7.3-curl php7.3-mbstring php7.3-pgsql php7.3-zip php7.3-xml php7.3-gd php7.3-intl</span><br></pre></td></tr></table></figure><p>上面的命令默认你使用的后端数据库是 PostgreSQL，会安装 <code>php7.3-pgsql</code>。如果你想用 MySQL 或 MariaDB，你可以把命令参数改为 <code>php7.3-mysql</code>。</p><p>下一步，确认 PHP 已安装并在你的树莓派上运行着：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php -v</span><br></pre></td></tr></table></figure><p>现在是时候安装和配置 Web 服务器了。</p><h4 id="2-安装-nginx"><span id="2-安装-nginx">2、安装 Nginx</span></h4><p>可以用下面的命令安装 Nginx：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install -y nginx</span><br></pre></td></tr></table></figure><p>修改默认的 Nginx 虚拟主机配置，这样 Web 服务器才能识别 PHP 文件以及知道如何处理它们。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p>你可以安全地删除原文件中的所有内容，用下面的内容替换：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80 default_server;</span><br><span class="line">        listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">        root /var/www/html;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        server_name _;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                try_files $uri $uri/ =404;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">          include snippets/fastcgi-php.conf;</span><br><span class="line">          fastcgi_pass unix:/run/php/php7.3-fpm.sock;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按 <code>Ctrl+O</code> 保存修改后的配置文件，然后按 <code>Ctrl+X</code> 退出 Nano。你可以用下面的命令测试你的新配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nginx -t</span><br></pre></td></tr></table></figure><p>如果没有报错，重启 Nginx 服务：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart nginx</span><br></pre></td></tr></table></figure><h4 id="3-安装-postgresql"><span id="3-安装-postgresql">3、安装 PostgreSQL</span></h4><p>接下来是安装数据库服务器。在树莓派上安装 PostgreSQL 超级简单：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install -y postgresql postgresql-client postgis</span><br></pre></td></tr></table></figure><p>输入下面的命令看一下数据库服务器安装是否成功：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ psql --version</span><br></pre></td></tr></table></figure><h4 id="4-创建-tiny-tiny-rss-数据库"><span id="4-创建-tiny-tiny-rss-数据库">4、创建 Tiny Tiny RSS 数据库</span></h4><p>在做其他事之前，你需要创建一个数数据库，用来给 TT-RSS 软件保存数据。首先，登录 PostgreSQL 服务器：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u postgres psql</span><br></pre></td></tr></table></figure><p>下一步，新建一个用户，设置密码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER username WITH PASSWORD &apos;your_password&apos; VALID UNTIL &apos;infinity&apos;;</span><br></pre></td></tr></table></figure><p>然后创建一个给 TT-RSS 用的数据库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE tinyrss;</span><br></pre></td></tr></table></figure><p>最后，给新建的用户赋最高权限：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON DATABASE tinyrss to user_name;</span><br></pre></td></tr></table></figure><p>这是安装数据库的步骤。你可以输入 <code>\q</code> 来退出 <code>psql</code> 程序。</p><h4 id="5-安装-git"><span id="5-安装-git">5、安装 Git</span></h4><p>安装 TT-RSS 需要用 Git，所以输入下面的命令安装 Git：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install git -y</span><br></pre></td></tr></table></figure><p>现在，进入到 Nginx 服务器的根目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd /var/www/html</span><br></pre></td></tr></table></figure><p>下载 TT-RSS 最新源码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://git.tt-rss.org/fox/tt-rss.git tt-rss</span><br></pre></td></tr></table></figure><p>注意，这一步会创建一个 <code>tt-rss</code> 文件夹。</p><h4 id="6-安装和配置tiny-tiny-rss"><span id="6-安装和配置tiny-tiny-rss">6、安装和配置Tiny Tiny RSS</span></h4><p>现在是安装和配置你的新 TT-RSS 服务器的最后时刻了。首先，确认下你在浏览器中能打开 <code>http://your.site/tt-rss/install/index.php</code>。如果浏览器显示 <code>403 Forbidden</code>，那么就证明 <code>/var/www/html</code> 文件夹的权限没有设置正确。下面的命令通常能解决这个问题：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 755 /var/www/html/ -v</span><br></pre></td></tr></table></figure><p>如果一切正常，你会看到 TT-RSS 安装页面，它会让你输入一些数据的信息。你只需要输入前面你创建的数据库用户名和密码；数据库名；主机名填 <code>localhost</code>；端口填 <code>5432</code>。</p><p>点击“Test Configuration”。如果一切正常，你会看到一个标记着“Initialize Database”的红色按钮。点击它来开始安装。结束后，你会看到一个配置文件，你可以把它复制到 TT-RSS 的目录，另存为 <code>config.php</code>。</p><p>安装过程结束后，浏览器输入 <code>http://yoursite/tt-rss/</code> 打开 TT-RSS，使用默认的凭证登录（用户名：<code>admin</code>，密码：<code>password</code>）。登录后系统会提示你修改密码。我强烈建议你尽快修改密码。</p><h3 id="配置-tt-rss"><span id="配置-tt-rss">配置 TT-RSS</span></h3><p>如果一切正常，你现在就可以开始使用 TT-RSS 了。建议你新建一个非管理员用户，使用新用户名登录，并开始导入你的馈送、订阅，按照你的意愿来配置它。</p><p>最后，并且是超级重要的事，不要忘了阅读 TT-RSS 维基上的 <a href="https://tt-rss.org/wiki/UpdatingFeeds" target="_blank" rel="noopener">Updating Feeds</a> 部分。它讲述了如何创建一个简单的 systemd 服务来更新馈送。如果你跳过了这一步，你的 RSS 馈送就不会自动更新。</p><h3 id="总结"><span id="总结">总结</span></h3><p>呵！工作量不小，但是你做完了！你现在有自己的 RSS 聚合服务器了。想了解 TT-RSS 更多的知识？我推荐你去看官方的 <a href="https://tt-rss.org/wiki/FAQ" target="_blank" rel="noopener">FAQ</a>、<a href="https://community.tt-rss.org/c/tiny-tiny-rss/support" target="_blank" rel="noopener">支持</a>论坛，和详细的<a href="https://tt-rss.org/wiki/InstallationNotes" target="_blank" rel="noopener">安装</a>笔记。如果你有任何问题，尽情地在下面评论吧。</p><hr><p>via: <a href="https://opensource.com/article/20/2/ttrss-raspberry-pi" target="_blank" rel="noopener">https://opensource.com/article/20/2/ttrss-raspberry-pi</a></p><p>作者：<a href="https://opensource.com/users/pmullins" target="_blank" rel="noopener">Patrick H. Mullins</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/lxbwolf" target="_blank" rel="noopener">lxbwolf</a><br>校对：<a href="https://github.com/wxy" target="_blank" rel="noopener">wxy</a></p><p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://tt-rss.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Tiny Tiny RSS&lt;/a&gt;（TT-RSS）是一个自由开源的基于 Web 的新闻&lt;ruby&gt;馈送&lt;rt&gt;feed&lt;/rt&gt;&lt;/ruby&gt;（RSS/
      
    
    </summary>
    
    
      <category term="RPI" scheme="https://lxb.wiki/categories/RPI/"/>
    
    
      <category term="树莓派" scheme="https://lxb.wiki/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"/>
    
  </entry>
  
  <entry>
    <title>通过禁止比较让 Go 二进制文件变小</title>
    <link href="https://lxb.wiki/27d7ea27/"/>
    <id>https://lxb.wiki/27d7ea27/</id>
    <published>2020-05-23T04:24:34.000Z</published>
    <updated>2020-05-23T04:41:28.498Z</updated>
    
    <content type="html"><![CDATA[<!-----![](https://img.linux.net.cn/data/attachment/album/202005/22/101617lcha7vvqzhh7d565.jpg)------><p>大家常规的认知是，Go 程序中声明的类型越多，生成的二进制文件就越大。这个符合直觉，毕竟如果你写的代码不去操作定义的类型，那么定义一堆类型就没有意义了。然而，链接器的部分工作就是检测没有被程序引用的函数（比如说它们是一个库的一部分，其中只有一个子集的功能被使用），然后把它们从最后的编译产出中删除。常言道，“类型越多，二进制文件越大”，对于多数 Go 程序还是正确的。</p><p>本文中我会深入讲解在 Go 程序的上下文中“相等”的意义，以及为什么<a href="https://github.com/golang/net/commit/e0ff5e5a1de5b859e2d48a2830d7933b3ab5b75f" target="_blank" rel="noopener">像这样</a>的修改会对 Go 程序的大小有重大的影响。</p><h3 id="定义两个值相等"><span id="定义两个值相等">定义两个值相等</span></h3><p>Go 的语法定义了“赋值”和“相等”的概念。赋值是把一个值赋给一个标识符的行为。并不是所有声明的标识符都可以被赋值，如常量和函数就不可以。相等是通过检查标识符的内容是否相等来比较两个标识符的行为。</p><p>作为强类型语言，“相同”的概念从根源上被植入标识符的类型中。两个标识符只有是相同类型的前提下，才有可能相同。除此之外，值的类型定义了如何比较该类型的两个值。</p><p>例如，整型是用算数方法进行比较的。对于指针类型，是否相等是指它们指向的地址是否相同。映射和通道等引用类型，跟指针类似，如果它们指向相同的地址，那么就认为它们是相同的。</p><p>上面都是按位比较相等的例子，即值占用的内存的位模式是相同的，那么这些值就相等。这就是所谓的 memcmp，即内存比较，相等是通过比较两个内存区域的内容来定义的。</p><p>记住这个思路，我过会儿再来谈。</p><h3 id="结构体相等"><span id="结构体相等">结构体相等</span></h3><p>除了整型、浮点型和指针等标量类型，还有复合类型：结构体。所有的结构体以程序中的顺序被排列在内存中。因此下面这个声明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type S struct &#123;</span><br><span class="line">    a, b, c, d int64</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>会占用 32 字节的内存空间；<code>a</code> 占用 8 个字节，<code>b</code> 占用 8 个字节，以此类推。Go 的规则说如果结构体所有的字段都是可以比较的，那么结构体的值就是可以比较的。因此如果两个结构体所有的字段都相等，那么它们就相等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := S&#123;1, 2, 3, 4&#125;</span><br><span class="line">b := S&#123;1, 2, 3, 4&#125;</span><br><span class="line">fmt.Println(a == b) // 输出 true</span><br></pre></td></tr></table></figure><p>编译器在底层使用 memcmp 来比较 <code>a</code> 的 32 个字节和 <code>b</code> 的 32 个字节。</p><h3 id="填充和对齐"><span id="填充和对齐">填充和对齐</span></h3><p>然而，在下面的场景下过分简单化的按位比较的策略会返回错误的结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type S struct &#123;</span><br><span class="line">    a byte</span><br><span class="line">    b uint64</span><br><span class="line">    c int16</span><br><span class="line">    d uint32</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main()</span><br><span class="line">    a := S&#123;1, 2, 3, 4&#125;</span><br><span class="line">    b := S&#123;1, 2, 3, 4&#125;</span><br><span class="line">    fmt.Println(a == b) // 输出 true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译代码后，这个比较表达式的结果还是 <code>true</code>，但是编译器在底层并不能仅依赖比较 <code>a</code> 和 <code>b</code> 的位模式，因为结构体有<em>填充</em>。</p><p>Go 要求结构体的所有字段都对齐。2 字节的值必须从偶数地址开始，4 字节的值必须从 4 的倍数地址开始，以此类推。编译器根据字段的类型和底层平台加入了填充来确保字段都<em>对齐</em>。在填充之后，编译器实际上看到的是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type S struct &#123;</span><br><span class="line">    a byte</span><br><span class="line">    _ [7]byte // 填充</span><br><span class="line">    b uint64</span><br><span class="line">    c int16</span><br><span class="line">    _ [2]int16 // 填充</span><br><span class="line">    d uint32</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>填充的存在保证了字段正确对齐，而填充确实占用了内存空间，但是填充字节的内容是未知的。你可能会认为在 Go 中 填充字节都是 0，但实际上并不是 — 填充字节的内容是未定义的。由于它们并不是被定义为某个确定的值，因此按位比较会因为分布在 <code>s</code> 的 24 字节中的 9 个填充字节不一样而返回错误结果。</p><p>Go 通过生成所谓的相等函数来解决这个问题。在这个例子中，<code>s</code> 的相等函数只比较函数中的字段略过填充部分，这样就能正确比较类型 <code>s</code> 的两个值。</p><h3 id="类型算法"><span id="类型算法">类型算法</span></h3><p>呵，这是个很大的设置，说明了为什么，对于 Go 程序中定义的每种类型，编译器都会生成几个支持函数，编译器内部把它们称作类型的算法。如果类型是一个映射的键，那么除相等函数外，编译器还会生成一个哈希函数。为了维持稳定，哈希函数在计算结果时也会像相等函数一样考虑诸如填充等因素。</p><p>凭直觉判断编译器什么时候生成这些函数实际上很难，有时并不明显，（因为）这超出了你的预期，而且链接器也很难消除没有被使用的函数，因为反射往往导致链接器在裁剪类型时变得更保守。</p><h3 id="通过禁止比较来减小二进制文件的大小"><span id="通过禁止比较来减小二进制文件的大小">通过禁止比较来减小二进制文件的大小</span></h3><p>现在，我们来解释一下 Brad 的修改。向类型添加一个不可比较的字段，结构体也随之变成不可比较的，从而强制编译器不再生成相等函数和哈希函数，规避了链接器对那些类型的消除，在实际应用中减小了生成的二进制文件的大小。作为这项技术的一个例子，下面的程序：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    type t struct &#123;</span><br><span class="line">        // _ [0][]byte // 取消注释以阻止比较</span><br><span class="line">        a byte</span><br><span class="line">        b uint16</span><br><span class="line">        c int32</span><br><span class="line">        d uint64</span><br><span class="line">    &#125;</span><br><span class="line">    var a t</span><br><span class="line">    fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用 Go 1.14.2（darwin/amd64）编译，大小从 2174088 降到了 2174056，节省了 32 字节。单独看节省的这 32 字节似乎微不足道，但是考虑到你的程序中每个类型及其传递闭包都会生成相等和哈希函数，还有它们的依赖，这些函数的大小随类型大小和复杂度的不同而不同，禁止它们会大大减小最终的二进制文件的大小，效果比之前使用 <code>-ldflags=&quot;-s -w&quot;</code> 还要好。</p><p>最后总结一下，如果你不想把类型定义为可比较的，可以在源码层级强制实现像这样的奇技淫巧，会使生成的二进制文件变小。</p><hr><p>via: <a href="https://dave.cheney.net/2020/05/09/ensmallening-go-binaries-by-prohibiting-comparisons" target="_blank" rel="noopener">https://dave.cheney.net/2020/05/09/ensmallening-go-binaries-by-prohibiting-comparisons</a></p><p>作者：<a href="https://dave.cheney.net/author/davecheney" target="_blank" rel="noopener">Dave Cheney</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/lxbwolf" target="_blank" rel="noopener">lxbwolf</a><br>校对：<a href="https://github.com/wxy" target="_blank" rel="noopener">wxy</a></p><p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-----
![](https://img.linux.net.cn/data/attachment/album/202005/22/101617lcha7vvqzhh7d565.jpg)
------&gt;

&lt;p&gt;大家常规的认知是，Go 程序中声明的类型越多，生成的二进制文件
      
    
    </summary>
    
    
      <category term="Golang" scheme="https://lxb.wiki/categories/Golang/"/>
    
    
      <category term="翻译" scheme="https://lxb.wiki/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="Go" scheme="https://lxb.wiki/tags/Go/"/>
    
      <category term="编译器" scheme="https://lxb.wiki/tags/%E7%BC%96%E8%AF%91%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Go：异步抢占</title>
    <link href="https://lxb.wiki/5698ca18/"/>
    <id>https://lxb.wiki/5698ca18/</id>
    <published>2020-05-05T07:24:46.000Z</published>
    <updated>2020-05-16T07:31:16.920Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/00.png" alt="Illustration created for “A Journey With Go”, made from the original Go Gopher, created by Renee French"></p><p>ℹ️ 本文基于 Go 1.14。</p><p>抢占是调度器的重要部分，基于抢占调度器可以在各个协程中分配运行的时间。实际上，如果没有抢占机制，一个长时间占用 CPU 的协程会阻塞其他的协程被调度。1.14 版本引入了一项新的异步抢占的技术，赋予了调度器更大的能力和控制力。</p><p><em>我推荐你阅读我的文章<a href="https://medium.com/a-journey-with-go/go-goroutine-and-preemption-d6bc2aa2f4b7" target="_blank" rel="noopener">”Go：协程和抢占“</a>来了解更多之前的特性和它的弊端。</em></p><h2 id="工作流"><span id="工作流">工作流</span></h2><p>我们以一个需要抢占的例子来开始。下面一段代码开启了几个协程，在几个循环中没有其他的函数调用，意味着调度器没有机会抢占它们：</p><p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/01.png" alt></p><p>然而，当把这个程序的追踪过程可视化后，我们清晰地看到了协程间的抢占和切换：</p><p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/02.png" alt></p><p>我们还可以看到表示协程的每个块儿的长度都相等。所有的协程运行时间相同（约 10 到 20 毫秒）。</p><p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/03.png" alt></p><p>异步抢占是基于一个时间条件触发的。当一个协程运行超过 10ms 时，Go 会尝试抢占它。</p><p>抢占是由线程 <code>sysmon</code> 初始化的，该线程专门用于监控包括长时间运行的协程在内的运行时。当某个协程被检测到运行超过 10ms 后，<code>sysmon</code> 向当前的线程发出一个抢占信号。</p><p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/04.png" alt></p><p>之后，当信息被信号处理器接收到时，线程中断当前的操作来处理信号，因此不会再运行当前的协程，在我们的例子中是 <code>G7</code>。取而代之的是，<code>gsignal</code> 被调度为管理发送来的信号。当它发现它是一个抢占指令后，在程序处理信号后恢复时它准备好指令来中止当前的协程。下面是这第二个阶段的示意图：</p><p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/05.png" alt></p><p><em>如果你想了解更多关于 <code>gsignal</code> 的信息，我推荐你读一下我的文章<a href="https://medium.com/a-journey-with-go/go-gsignal-master-of-signals-329f7ff39391" target="_blank" rel="noopener">”Go：gsignal，信号的掌控者“</a>。</em></p><h2 id="实现"><span id="实现">实现</span></h2><p>我们在被选中的信号 <code>SIGURG</code> 中第一次看到了实现的细节。这个选择在提案<a href="https://github.com/golang/proposal/blob/master/design/24543-non-cooperative-preemption.md" target="_blank" rel="noopener">”提案：非合作式协程抢占“</a>中有详细的解释：</p><blockquote><ul><li>它应该是调试者默认传递过来的一个信号。</li><li>它不应该是 Go/C 混合二进制中 libc 内部使用的信号。</li><li>它应该是一个可以伪造而没有其他后果的信号。</li><li>我们需要在没有实时信号时与平台打交道。<br>然后，当信号被注入和接收时，Go 需要一种在程序恢复时能终止当前协程的方式。为了实现这个过程，Go 会把一条指令推进程序计数器，这样看起来运行中的程序调用了运行时的函数。该函数暂停了协程并把它交给了调度器，调度器之后还会运行其他的协程。</li></ul></blockquote><p><em>我们应该注意到 Go 不能做到在任何地方终止程序；当前的指令必须是一个安全点。例如，如果程序现在正在调用运行时，那么抢占协程并不安全，因为运行时很多函数不应该被抢占。</em></p><p>这个新的抢占机制也让垃圾回收器受益，可以用更高效的方式终止所有的协程。诚然，STW 现在非常容易，Go 仅需要向所有运行的线程发出一个信号就可以了。下面是垃圾回收器运行时的一个例子：</p><p><img src="https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/06.png" alt></p><p>然后，所有的线程都接收到这个信号，在垃圾回收器重新开启全局之前会暂停执行。</p><p><em>如果你想了解更多关于 STW 的信息，我建议你阅读我的文章<a href="https://medium.com/a-journey-with-go/go-how-does-go-stop-the-world-1ffab8bc8846" target="_blank" rel="noopener">”Go：Go 怎样实现 STW？“</a>。</em></p><p>最后，这个特性被封装在一个参数中，你可以用这个参数关闭异步抢占。你可以用 <code>GODEBUG=asyncpreemptoff=1</code> 来运行你的程序，如果你因为升级到了 Go 1.14 发现了不正常的现象就可以调试你的程序，或者观察你的程序有无异步抢占时的不同表现。</p><hr><p>via: <a href="https://medium.com/a-journey-with-go/go-asynchronous-preemption-b5194227371c" target="_blank" rel="noopener">https://medium.com/a-journey-with-go/go-asynchronous-preemption-b5194227371c</a></p><p>作者：<a href="https://medium.com/@blanchon.vincent" target="_blank" rel="noopener">Vincent Blanchon</a><br>译者：<a href="https://github.com/lxbwolf" target="_blank" rel="noopener">lxbwolf</a><br>校对：<a href="https://github.com/polaris1119" target="_blank" rel="noopener">polaris1119</a></p><p>本文由 <a href="https://github.com/studygolang/GCTT" target="_blank" rel="noopener">GCTT</a> 原创编译，<a href="https://studygolang.com/" target="_blank" rel="noopener">Go 中文网</a> 荣誉推出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/studygolang/gctt-images2/master/20200501-Go-Asynchronous-Preemption/00.png&quot; alt=&quot;Illustration
      
    
    </summary>
    
    
      <category term="Golang" scheme="https://lxb.wiki/categories/Golang/"/>
    
    
      <category term="Go" scheme="https://lxb.wiki/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Inlining Optimisations in Go</title>
    <link href="https://lxb.wiki/6ce34c49/"/>
    <id>https://lxb.wiki/6ce34c49/</id>
    <published>2020-04-29T13:05:10.000Z</published>
    <updated>2020-05-05T11:39:31.603Z</updated>
    
    <content type="html"><![CDATA[<h1 id="go-中的内联优化"><span id="go-中的内联优化">Go 中的内联优化</span></h1><blockquote><p>本文讨论 Go 编译器是如何实现内联的，以及这种优化方法如何影响你的 Go 代码。</p></blockquote><p><img src="https://img.linux.net.cn/data/attachment/album/202005/02/222202e3v3pppkhnndpbpn.jpg" alt></p><p><em>请注意：</em>本文重点讨论 <em>gc</em>，这是来自 <a href="https://github.com/golang/go" target="_blank" rel="noopener">golang.org</a> 的事实标准的 Go 编译器。讨论到的概念可以广泛适用于其它 Go 编译器，如 gccgo 和 llgo，但它们在实现方式和功效上可能有所差异。</p><h3 id="内联是什么"><span id="内联是什么">内联是什么？</span></h3><p><ruby>内联<rt>inlining</rt></ruby>就是把简短的函数在调用它的地方展开。在计算机发展历程的早期，这个优化是由程序员手动实现的。现在，内联已经成为编译过程中自动实现的基本优化过程的其中一步。</p><h3 id="为什么内联很重要"><span id="为什么内联很重要">为什么内联很重要？</span></h3><p>有两个原因。第一个是它消除了函数调用本身的开销。第二个是它使得编译器能更高效地执行其他的优化策略。</p><h4 id="函数调用的开销"><span id="函数调用的开销">函数调用的开销</span></h4><p>在任何语言中，调用一个函数 [^1] 都会有消耗。把参数编组进寄存器或放入栈中（取决于 ABI），在返回结果时的逆反过程都会有开销。引入一次函数调用会导致程序计数器从指令流的一点跳到另一点，这可能导致管道滞后。函数内部通常有<ruby>前置处理<rt>preamble</rt></ruby>，需要为函数执行准备新的栈帧，还有与前置相似的<ruby>后续处理<rt>epilogue</rt></ruby>，需要在返回给调用方之前释放栈帧空间。</p><p>在 Go 中函数调用会消耗额外的资源来支持栈的动态增长。在进入函数时，goroutine 可用的栈空间与函数需要的空间大小进行比较。如果可用空间不同，前置处理就会跳到<ruby>运行时<rt>runtime</rt></ruby>的逻辑中，通过把数据复制到一块新的、更大的空间的来增长栈空间。当这个复制完成后，运行时就会跳回到原来的函数入口，再执行栈空间检查，现在通过了检查，函数调用继续执行。这种方式下，goroutine 开始时可以申请很小的栈空间，在有需要时再申请更大的空间。[^2]</p><p>这个检查消耗很小，只有几个指令，而且由于 goroutine 的栈是成几何级数增长的，因此这个检查很少失败。这样，现代处理器的分支预测单元可以通过假定检查肯定会成功来隐藏栈空间检查的消耗。当处理器预测错了栈空间检查，不得不放弃它在推测性执行所做的操作时，与为了增加 goroutine 的栈空间运行时所需的操作消耗的资源相比，管道滞后的代价更小。</p><p>虽然现代处理器可以用预测性执行技术优化每次函数调用中的泛型和 Go 特定的元素的开销，但那些开销不能被完全消除，因此在每次函数调用执行必要的工作过程中都会有性能消耗。一次函数调用本身的开销是固定的，与更大的函数相比，调用小函数的代价更大，因为在每次调用过程中它们做的有用的工作更少。</p><p>因此，消除这些开销的方法必须是要消除函数调用本身，Go 的编译器就是这么做的，在某些条件下通过用函数的内容来替换函数调用来实现。这个过程被称为<em>内联</em>，因为它在函数调用处把函数体展开了。</p><h4 id="改进的优化机会"><span id="改进的优化机会">改进的优化机会</span></h4><p>Cliff Click 博士把内联描述为现代编译器做的优化措施，像常量传播（LCTT 译注：此处作者笔误，原文为 constant proportion，修正为 constant propagation）和死代码消除一样，都是编译器的基本优化方法。实际上，内联可以让编译器看得更深，使编译器可以观察调用的特定函数的上下文内容，可以看到能继续简化或彻底消除的逻辑。由于可以递归地执行内联，因此不仅可以在每个独立的函数上下文处进行这种优化决策，也可以在整个函数调用链中进行。</p><h3 id="实践中的内联"><span id="实践中的内联">实践中的内联</span></h3><p>下面这个例子可以演示内联的影响：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//go:noinline</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Result <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkMax</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        r = max(<span class="number">-1</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">    Result = r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行这个基准，会得到如下结果：[^3]</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% go <span class="built_in">test</span> -bench=. </span><br><span class="line">BenchmarkMax-4   530687617         2.24 ns/op</span><br></pre></td></tr></table></figure><p>在我的 2015 MacBook Air 上 <code>max(-1, i)</code> 的耗时约为 2.24 纳秒。现在去掉 <code>//go:noinline</code> 编译指令，再看下结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% go <span class="built_in">test</span> -bench=. </span><br><span class="line">BenchmarkMax-4   1000000000         0.514 ns/op</span><br></pre></td></tr></table></figure><p>从 2.24 纳秒降到了 0.51 纳秒，或者从 <code>benchstat</code> 的结果可以看出，有 78% 的提升。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% benchstat &#123;old,new&#125;.txt</span><br><span class="line">name   old time/op  new time/op  delta</span><br><span class="line">Max-4  2.21ns ± 1%  0.49ns ± 6%  -77.96%  (p=0.000 n=18+19)</span><br></pre></td></tr></table></figure><p>这个提升是从哪儿来的呢？</p><p>首先，移除掉函数调用以及与之关联的前置处理 [^4] 是主要因素。把 <code>max</code> 函数的函数体在调用处展开，减少了处理器执行的指令数量并且消除了一些分支。</p><p>现在由于编译器优化了 <code>BenchmarkMax</code>，因此它可以看到 <code>max</code> 函数的内容，进而可以做更多的提升。当 <code>max</code> 被内联后，<code>BenchmarkMax</code> 呈现给编译器的样子，看起来是这样的：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkMax</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="number">-1</span> &gt; i &#123;</span><br><span class="line">            r = <span class="number">-1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            r = i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Result = r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再运行一次基准，我们看一下手动内联的版本和编译器内联的版本的表现：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% benchstat &#123;old,new&#125;.txt</span><br><span class="line">name   old time/op  new time/op  delta</span><br><span class="line">Max-4  2.21ns ± 1%  0.48ns ± 3%  -78.14%  (p=0.000 n=18+18)</span><br></pre></td></tr></table></figure><p>现在编译器能看到在 <code>BenchmarkMax</code> 里内联 <code>max</code> 的结果，可以执行以前不能执行的优化措施。例如，编译器注意到 <code>i</code> 初始值为 <code>0</code>，仅做自增操作，因此所有与 <code>i</code> 的比较都可以假定 <code>i</code> 不是负值。这样条件表达式 <code>-1 &gt; i</code> 永远不是 <code>true</code>。[^5]</p><p>证明了 <code>-1 &gt; i</code> 永远不为 true 后，编译器可以把代码简化为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkMax</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">false</span> &#123;</span><br><span class="line">            r = <span class="number">-1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            r = i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Result = r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>并且因为分支里是个常量，编译器可以通过下面的方式移除不会走到的分支：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkMax</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        r = i</span><br><span class="line">    &#125;</span><br><span class="line">    Result = r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，通过内联和由内联解锁的优化过程，编译器把表达式 <code>r = max(-1, i))</code> 简化为 <code>r = i</code>。</p><h3 id="内联的限制"><span id="内联的限制">内联的限制</span></h3><p>本文中我论述的内联称作<ruby>叶子内联<rt>leaf inlining</rt></ruby>：把函数调用栈中最底层的函数在调用它的函数处展开的行为。内联是个递归的过程，当把函数内联到调用它的函数 A 处后，编译器会把内联后的结果代码再内联到 A 的调用方，这样持续内联下去。例如，下面的代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkMaxMaxMax</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        r = max(max(<span class="number">-1</span>, i), max(<span class="number">0</span>, i))</span><br><span class="line">    &#125;</span><br><span class="line">    Result = r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与之前的例子中的代码运行速度一样快，因为编译器可以对上面的代码重复地进行内联，也把代码简化到 <code>r = i</code> 表达式。</p><p>下一篇文章中，我会论述当 Go 编译器想要内联函数调用栈中间的某个函数时选用的另一种内联策略。最后我会论述编译器为了内联代码准备好要达到的极限，这个极限 Go 现在的能力还达不到。</p><p>[^1]: 在 Go 中，一个方法就是一个有预先定义的形参和接受者的函数。假设这个方法不是通过接口调用的，调用一个无消耗的函数所消耗的代价与引入一个方法是相同的。<br>[^2]: 在 Go 1.14 以前，栈检查的前置处理也被垃圾回收器用于 STW，通过把所有活跃的 goroutine 栈空间设为 0，来强制它们切换为下一次函数调用时的运行时状态。这个机制<a href="https://github.com/golang/proposal/blob/master/design/24543-non-cooperative-preemption.md" target="_blank" rel="noopener">最近被替换</a>为一种新机制，新机制下运行时可以不用等 goroutine 进行函数调用就可以暂停 goroutine。<br>[^3]: 我用 <code>//go:noinline</code> 编译指令来阻止编译器内联 <code>max</code>。这是因为我想把内联 <code>max</code> 的影响与其他影响隔离开，而不是用 <code>-gcflags=&#39;-l -N&#39;</code> 选项在全局范围内禁止优化。关于 <code>//go:</code> 注释在<a href="https://dave.cheney.net/2018/01/08/gos-hidden-pragmas" target="_blank" rel="noopener">这篇文章</a>中详细论述。<br>[^4]: 你可以自己通过比较 <code>go test -bench=. -gcflags=-S</code> 有无 <code>//go:noinline</code> 注释时的不同结果来验证一下。<br>[^5]: 你可以用 <code>-gcflags=-d=ssa/prove/debug=on</code> 选项来自己验证一下。</p><h4 id="相关文章"><span id="相关文章">相关文章：</span></h4><ol><li><a href="https://dave.cheney.net/2014/06/07/five-things-that-make-go-fast" target="_blank" rel="noopener">使 Go 变快的 5 件事</a></li><li><a href="https://dave.cheney.net/2013/06/02/why-is-a-goroutines-stack-infinite" target="_blank" rel="noopener">为什么 Goroutine 的栈空间会无限增长？</a></li><li><a href="https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go" target="_blank" rel="noopener">Go 中怎么写基准测试</a></li><li><a href="https://dave.cheney.net/2018/01/08/gos-hidden-pragmas" target="_blank" rel="noopener">Go 中隐藏的编译指令</a></li></ol><hr><p>via: <a href="https://dave.cheney.net/2020/04/25/inlining-optimisations-in-go" target="_blank" rel="noopener">https://dave.cheney.net/2020/04/25/inlining-optimisations-in-go</a></p><p>作者：<a href="https://dave.cheney.net/author/davecheney" target="_blank" rel="noopener">Dave Cheney</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/lxbwolf" target="_blank" rel="noopener">lxbwolf</a><br>校对：<a href="https://github.com/wxy" target="_blank" rel="noopener">wxy</a></p><p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;go-中的内联优化&quot;&gt;&lt;span id=&quot;go-中的内联优化&quot;&gt;Go 中的内联优化&lt;/span&gt;&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;本文讨论 Go 编译器是如何实现内联的，以及这种优化方法如何影响你的 Go 代码。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;
      
    
    </summary>
    
    
      <category term="Golang" scheme="https://lxb.wiki/categories/Golang/"/>
    
    
      <category term="Go" scheme="https://lxb.wiki/tags/Go/"/>
    
      <category term="编译器" scheme="https://lxb.wiki/tags/%E7%BC%96%E8%AF%91%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>树莓派做BT下载器</title>
    <link href="https://lxb.wiki/fb1d9193/"/>
    <id>https://lxb.wiki/fb1d9193/</id>
    <published>2020-03-11T14:29:00.000Z</published>
    <updated>2020-05-10T19:40:07.694Z</updated>
    
    <content type="html"><![CDATA[<p>可以用 <a href="https://www.transmissionbt.com/" target="_blank" rel="noopener">transmission</a>，它提供了 Web 界面</p><h4 id="1-安装-transmission"><span id="1-安装-transmission">1. 安装 transmission：</span></h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install transmission-daemon</span><br></pre></td></tr></table></figure><h4 id="2-创建下载目录一个是下载完成的目录一个是未完成的目录"><span id="2-创建下载目录一个是下载完成的目录一个是未完成的目录">2. 创建下载目录，一个是下载完成的目录，一个是未完成的目录</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir Public/bt_complete</span><br><span class="line">mkdir Public/bt_incomplete</span><br></pre></td></tr></table></figure><h3 id="3-配置目录权限"><span id="3-配置目录权限">3. 配置目录权限</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G debian-transmission pi</span><br><span class="line">sudo chgrp debian-transmission bt_complete</span><br><span class="line">sudo chgrp debian-transmission bt_incomplete</span><br><span class="line">sudo chmod 770 bt_complete</span><br><span class="line">sudo chmod 770 bt_incomplete</span><br></pre></td></tr></table></figure><h4 id="4-修改配置文件-etctransmission-daemonsettingsjson"><span id="4-修改配置文件-etctransmission-daemonsettingsjson">4. 修改配置文件 /etc/transmission-daemon/settings.json</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;download-dir&quot;:&quot;/home/pi/Public/bt_complete&quot;</span><br><span class="line">&quot;incomplete-dir&quot;:&quot;/home/pi/Public/bt_incomplete&quot;</span><br><span class="line">&quot;rpc-host-whitelist&quot;: &quot;192.168.1.*&quot;,</span><br></pre></td></tr></table></figure><h4 id="5-重启-transmission"><span id="5-重启-transmission">5. 重启 transmission</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service transmission-daemon reload</span><br><span class="line">sudo service transmission-daemon restart</span><br></pre></td></tr></table></figure><p>两个命令按顺序执行，单独 restart 的话配置不会保存：</p><p>浏览器中输入 <code>http://192.168.1.8:9091/</code>，默认用户名密码：<code>transmission</code></p><p><strong>修改 transmission 用户名和密码的方法：</strong></p><ol><li>先停止服务： <code>sudo service transmission-daemon stop</code></li><li>修改配置文件，看到这个是加密的密码，直接把密码改为密码明文就可以：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">“rpc-username”: “明文”,</span><br><span class="line">“rpc-password”: “密文”,</span><br></pre></td></tr></table></figure><ol start="3"><li>再此启动服务 ：<code>sudo service transmission-daemon start</code><br>  启动的时候 transmission 会自动把新密码加密。</li></ol><p><strong>transmission 默认监听 51413 端口，最好在路由器上做个端口转发，把这个端口转到它的 IP 地址</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;可以用 &lt;a href=&quot;https://www.transmissionbt.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;transmission&lt;/a&gt;，它提供了 Web 界面&lt;/p&gt;
&lt;h4 id=&quot;1-安装-transmission&quot;&gt;
      
    
    </summary>
    
    
      <category term="RPI" scheme="https://lxb.wiki/categories/RPI/"/>
    
    
      <category term="torrent" scheme="https://lxb.wiki/tags/torrent/"/>
    
  </entry>
  
  <entry>
    <title>树莓派搭建GitHub镜像服务</title>
    <link href="https://lxb.wiki/2073ae8b/"/>
    <id>https://lxb.wiki/2073ae8b/</id>
    <published>2020-03-10T11:03:42.000Z</published>
    <updated>2020-05-20T15:37:42.070Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-树莓派上创建-git-账号创建用于存放代码的目录"><span id="1-树莓派上创建-git-账号创建用于存放代码的目录">1.  树莓派上创建 git 账号，创建用于存放代码的目录</span></h3><p><code>/srv/</code></p><h3 id="2-github-库-clone-到树莓派"><span id="2-github-库-clone-到树莓派">2. GitHub 库 clone 到树莓派</span></h3><p><code>git clone git@github.com:user/XXXX.git /srv/</code></p><h3 id="3-添加-remote"><span id="3-添加-remote">3. 添加 remote</span></h3><p><code>git remote add upstream https://github.com/abcd/XXXX</code></p><h3 id="4-修改-hook"><span id="4-修改-hook">4. 修改 hook</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#.git/hooks/post-update</span></span><br><span class="line">param=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">push_branch=<span class="variable">$&#123;param##refs/heads/&#125;</span> <span class="comment">#获取到更新的分支名</span></span><br><span class="line">git push origin <span class="variable">$push_branch</span></span><br></pre></td></tr></table></figure><h3 id="5-添加定时任务"><span id="5-添加定时任务">5. 添加定时任务</span></h3><p><code>5,35 * * * * cd /srv/XXXX &amp;&amp; git pull upstream master</code></p><h3 id="6-在本地代码添加-remote"><span id="6-在本地代码添加-remote">6. 在本地代码添加 remote</span></h3><h4 id="61-有多个项目时为避免修改每个项目的-remote直接添加-host"><span id="61-有多个项目时为避免修改每个项目的-remote直接添加-host">6.1 有多个项目时，为避免修改每个项目的 remote，直接添加 host</span></h4><p><code>192.168.1.8 gitsrv</code></p><h4 id="62-在每个项目在添加一次-remote"><span id="62-在每个项目在添加一次-remote">6.2 在每个项目在添加一次 remote</span></h4><p><code>git remote add pi git@192.168.1.8:/srv/XXXX</code></p><p>这样即使以后地址改变，只需要改一次 host 就可以了</p><h3 id="7-推拉代码时从-pi-推拉"><span id="7-推拉代码时从-pi-推拉">7. 推拉代码时，从 pi 推拉</span></h3><p><code>git pull pi branch</code></p><p><code>git push pi branch</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-树莓派上创建-git-账号创建用于存放代码的目录&quot;&gt;&lt;span id=&quot;1-树莓派上创建-git-账号创建用于存放代码的目录&quot;&gt;1.  树莓派上创建 git 账号，创建用于存放代码的目录&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;/srv/&lt;/code&gt;&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="RPI" scheme="https://lxb.wiki/categories/RPI/"/>
    
    
      <category term="GitHub" scheme="https://lxb.wiki/tags/GitHub/"/>
    
      <category term="树莓派" scheme="https://lxb.wiki/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"/>
    
  </entry>
  
  <entry>
    <title>非实时信号表</title>
    <link href="https://lxb.wiki/c77ce28f/"/>
    <id>https://lxb.wiki/c77ce28f/</id>
    <published>2020-02-15T11:19:45.000Z</published>
    <updated>2020-05-05T14:53:40.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="信号类型"><span id="信号类型">信号类型</span></h1><p>Linux系统共定义了64种信号，分为两大类：可靠信号与不可靠信号，前32种信号为不可靠信号，后32种为可靠信号。</p><h3 id="概念"><span id="概念">概念</span></h3><p>不可靠信号： 也称为非实时信号，不支持排队，信号可能会丢失, 比如发送多次相同的信号, 进程只能收到一次. 信号值取值区间为<code>1~31</code>；<br>可靠信号： 也称为实时信号，支持排队, 信号不会丢失, 发多少次, 就可以收到多少次. 信号值取值区间为<code>32~64</code></p><h3 id="信号表"><span id="信号表">信号表</span></h3><p>在终端，可通过kill -l查看所有的signal信号</p><table><thead><tr><th align="left">取值</th><th align="left">名称</th><th align="left">解释</th><th align="left">默认动作</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">SIGHUP</td><td align="left">挂起</td><td align="left"></td></tr><tr><td align="left">2</td><td align="left">SIGINT</td><td align="left">中断</td><td align="left"></td></tr><tr><td align="left">3</td><td align="left">SIGQUIT</td><td align="left">退出</td><td align="left"></td></tr><tr><td align="left">4</td><td align="left">SIGILL</td><td align="left">非法指令</td><td align="left"></td></tr><tr><td align="left">5</td><td align="left">SIGTRAP</td><td align="left">断点或陷阱指令</td><td align="left"></td></tr><tr><td align="left">6</td><td align="left">SIGABRT</td><td align="left">abort发出的信号</td><td align="left"></td></tr><tr><td align="left">7</td><td align="left">SIGBUS</td><td align="left">非法内存访问</td><td align="left"></td></tr><tr><td align="left">8</td><td align="left">SIGFPE</td><td align="left">浮点异常</td><td align="left"></td></tr><tr><td align="left">9</td><td align="left">SIGKILL</td><td align="left">kill信号</td><td align="left">不能被忽略、处理和阻塞</td></tr><tr><td align="left">10</td><td align="left">SIGUSR1</td><td align="left">用户信号1</td><td align="left"></td></tr><tr><td align="left">11</td><td align="left">SIGSEGV</td><td align="left">无效内存访问</td><td align="left"></td></tr><tr><td align="left">12</td><td align="left">SIGUSR2</td><td align="left">用户信号2</td><td align="left"></td></tr><tr><td align="left">13</td><td align="left">SIGPIPE</td><td align="left">管道破损，没有读端的管道写数据</td><td align="left"></td></tr><tr><td align="left">14</td><td align="left">SIGALRM</td><td align="left">alarm发出的信号</td><td align="left"></td></tr><tr><td align="left">15</td><td align="left">SIGTERM</td><td align="left">终止信号</td><td align="left"></td></tr><tr><td align="left">16</td><td align="left">SIGSTKFLT</td><td align="left">栈溢出</td><td align="left"></td></tr><tr><td align="left">17</td><td align="left">SIGCHLD</td><td align="left">子进程退出</td><td align="left">默认忽略</td></tr><tr><td align="left">18</td><td align="left">SIGCONT</td><td align="left">进程继续</td><td align="left"></td></tr><tr><td align="left">19</td><td align="left">SIGSTOP</td><td align="left">进程停止</td><td align="left">不能被忽略、处理和阻塞</td></tr><tr><td align="left">20</td><td align="left">SIGTSTP</td><td align="left">进程停止</td><td align="left"></td></tr><tr><td align="left">21</td><td align="left">SIGTTIN</td><td align="left">进程停止，后台进程从终端读数据时</td><td align="left"></td></tr><tr><td align="left">22</td><td align="left">SIGTTOU</td><td align="left">进程停止，后台进程想终端写数据时</td><td align="left"></td></tr><tr><td align="left">23</td><td align="left">SIGURG</td><td align="left">I/O有紧急数据到达当前进程</td><td align="left">默认忽略</td></tr><tr><td align="left">24</td><td align="left">SIGXCPU</td><td align="left">进程的CPU时间片到期</td><td align="left"></td></tr><tr><td align="left">25</td><td align="left">SIGXFSZ</td><td align="left">文件大小的超出上限</td><td align="left"></td></tr><tr><td align="left">26</td><td align="left">SIGVTALRM</td><td align="left">虚拟时钟超时</td><td align="left"></td></tr><tr><td align="left">27</td><td align="left">SIGPROF</td><td align="left">profile时钟超时</td><td align="left"></td></tr><tr><td align="left">28</td><td align="left">SIGWINCH</td><td align="left">窗口大小改变</td><td align="left">默认忽略</td></tr><tr><td align="left">29</td><td align="left">SIGIO</td><td align="left">I/O相关</td><td align="left"></td></tr><tr><td align="left">30</td><td align="left">SIGPWR</td><td align="left">关机</td><td align="left">默认忽略</td></tr><tr><td align="left">31</td><td align="left">SIGSYS</td><td align="left">系统调用异常</td><td align="left"></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;信号类型&quot;&gt;&lt;span id=&quot;信号类型&quot;&gt;信号类型&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;Linux系统共定义了64种信号，分为两大类：可靠信号与不可靠信号，前32种信号为不可靠信号，后32种为可靠信号。&lt;/p&gt;
&lt;h3 id=&quot;概念&quot;&gt;&lt;span id=&quot;概念&quot;&gt;概念&lt;
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://lxb.wiki/categories/Linux/"/>
    
    
      <category term="signal" scheme="https://lxb.wiki/tags/signal/"/>
    
  </entry>
  
</feed>
