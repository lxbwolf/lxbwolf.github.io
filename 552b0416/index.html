<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè'>

<meta name="keywords" content="lucene , Á¥¢ÂºïÊñá‰ª∂Ê†ºÂºè"><title>Lucene ‰∏â: Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè</title>

<link rel='canonical' href='https://lxb.wiki/552b0416/'>

<link rel="stylesheet" href="/scss/style.min.e5fa5972b3e81b9d9b61e2598991a71c444ca50e38b034d78f5651a82802e894.css"><meta property='og:title' content='Lucene ‰∏â: Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè'>
<meta property='og:description' content='Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè'>
<meta property='og:url' content='https://lxb.wiki/552b0416/'>
<meta property='og:site_name' content='Xiaobin&#39;s Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='lucene' /><meta property='article:published_time' content='2023-09-03T22:05:28&#43;08:00'/><meta property='article:modified_time' content='2023-09-03T22:05:28&#43;08:00'/>
<meta name="twitter:title" content="Lucene ‰∏â: Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè">
<meta name="twitter:description" content="Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè">
<link rel="shortcut icon" href="/favicon.png" />




<script async src="https://www.googletagmanager.com/gtag/js?id=G-JZ2PWLT6JY"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-JZ2PWLT6JY');
</script>
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e710560ffa44cae2b3a6259e0171fb5f";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
<script>
    (function () {
        var el = document.createElement("script");
        el.src = "https://lf1-cdn-tos.bytegoofy.com/goofy/ttzz/push.js?f146251743600ee0672cdcc8455ce18def91cdb255ad969a2ef5c715d5ed5baecaf7cd753709c168f20e6a2e9019123fd11e31a222d3a2fe01ad05c6b8f519b2";
        el.id = "ttzz";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(el, s);
    })(window)
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu692828361b78eaa42fdbdbbf5a7177a9_44446_300x0_resize_q75_box.jpeg" width="300"
                            height="298" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Xiaobin&#39;s Notes</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header>


    <ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>È¶ñÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/' >
                
                
                
                <span>ÂàÜÁ±ª</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' >
                
                
                
                <span>Ê†áÁ≠æ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                <span>ÂèãÈìæ</span>
            </a>
        </li>
        

        <div class="menu-bottom-section"><ol class="social-menu">
                    
                        <li>
                            <a 
                                href='mailto://me@lxb.wiki'
                                target="_blank"
                                title="Email"
                                rel="me"
                            >
                                
                                
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                
                            </a>
                        </li>
                    
                        <li>
                            <a 
                                href='https://github.com/lxbwolf'
                                target="_blank"
                                title="GitHub"
                                rel="me"
                            >
                                
                                
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                                
                            </a>
                        </li>
                    
                        <li>
                            <a 
                                href='https://lxb.wiki/atom.xml'
                                target="_blank"
                                title="Rss"
                                rel="me"
                            >
                                
                                
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="5" cy="19" r="1" />
  <path d="M4 4a16 16 0 0 1 16 16" />
  <path d="M4 11a9 9 0 0 1 9 9" />
</svg>



                                
                            </a>
                        </li>
                    
                </ol>
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>ÊöóËâ≤Ê®°Âºè</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
<section class="widget archives">
    
    <h2 class="widget-title section-title">ÁõÆÂΩï</h2>

    <div class="widget--toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#‰∏ÄÂü∫Êú¨Ê¶ÇÂøµ"><strong>‰∏Ä„ÄÅÂü∫Êú¨Ê¶ÇÂøµ</strong></a></li>
    <li><a href="#‰∫åÂü∫Êú¨Á±ªÂûã"><strong>‰∫å„ÄÅÂü∫Êú¨Á±ªÂûã</strong></a></li>
    <li><a href="#‰∏âÂü∫Êú¨ËßÑÂàô"><strong>‰∏â„ÄÅÂü∫Êú¨ËßÑÂàô</strong></a>
      <ul>
        <li><a href="#1-ÂâçÁºÄÂêéÁºÄËßÑÂàôprefixsuffix"><strong>1. ÂâçÁºÄÂêéÁºÄËßÑÂàô(Prefix+Suffix)</strong></a></li>
        <li><a href="#2-Â∑ÆÂÄºËßÑÂàôdelta"><strong>2. Â∑ÆÂÄºËßÑÂàô(Delta)</strong></a></li>
        <li><a href="#3-ÊàñÁÑ∂Ë∑üÈöèËßÑÂàôa-b"><strong>3. ÊàñÁÑ∂Ë∑üÈöèËßÑÂàô(A, B?)</strong></a></li>
        <li><a href="#4-Ë∑≥Ë∑ÉË°®ËßÑÂàôskip-list"><strong>4. Ë∑≥Ë∑ÉË°®ËßÑÂàô(Skip list)</strong></a></li>
      </ul>
    </li>
    <li><a href="#ÂõõÂÖ∑‰ΩìÊ†ºÂºè"><strong>Âõõ„ÄÅÂÖ∑‰ΩìÊ†ºÂºè</strong></a>
      <ul>
        <li><a href="#41-Ê≠£Âêë‰ø°ÊÅØ"><strong>4.1. Ê≠£Âêë‰ø°ÊÅØ</strong></a></li>
        <li><a href="#42-ÂèçÂêë‰ø°ÊÅØ"><strong>4.2. ÂèçÂêë‰ø°ÊÅØ</strong></a></li>
        <li><a href="#43-ÂÖ∂‰ªñ‰ø°ÊÅØ"><strong>4.3. ÂÖ∂‰ªñ‰ø°ÊÅØ</strong></a></li>
      </ul>
    </li>
    <li><a href="#‰∫îÊÄª‰ΩìÁªìÊûÑ"><strong>‰∫î„ÄÅÊÄª‰ΩìÁªìÊûÑ</strong></a></li>
  </ul>
</nav>
    </div>
</section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
        <a href="/categories/Lang/" >
            Lang
        </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/552b0416/">Lucene ‰∏â: Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè</a>
        </h2>

        
        <h3 class="article-subtitle">
            Lucene ÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºè
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
            <time class="article-time--published">Sep 03, 2023</time>
        </div>
        

        
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



            <time class="article-time--reading">
                ÈòÖËØªÊó∂Èïø: 40 ÂàÜÈíü
            </time>
        </div>
        
        <small>
    <section class="article-tags">
        
            <a href="/tags/lucene/">lucene</a>
        
    </section>
</small>
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <p>LuceneÁöÑÁ¥¢ÂºïÈáåÈù¢Â≠ò‰∫Ü‰∫õ‰ªÄ‰πàÔºåÂ¶Ç‰ΩïÂ≠òÊîæÁöÑÔºå‰πüÂç≥LuceneÁöÑÁ¥¢ÂºïÊñá‰ª∂Ê†ºÂºèÔºåÊòØËØªÊáÇLuceneÊ∫ê‰ª£Á†ÅÁöÑ‰∏ÄÊääÈí•Âåô„ÄÇ</p>
<p>ÂΩìÊàë‰ª¨ÁúüÊ≠£ËøõÂÖ•Âà∞LuceneÊ∫ê‰ª£Á†Å‰πã‰∏≠ÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨‰ºöÂèëÁé∞:</p>
<ul>
<li>LuceneÁöÑÁ¥¢ÂºïËøáÁ®ãÔºåÂ∞±ÊòØÊåâÁÖßÂÖ®ÊñáÊ£ÄÁ¥¢ÁöÑÂü∫Êú¨ËøáÁ®ãÔºåÂ∞ÜÂÄíÊéíË°®ÂÜôÊàêÊ≠§Êñá‰ª∂Ê†ºÂºèÁöÑËøáÁ®ã„ÄÇ</li>
<li>LuceneÁöÑÊêúÁ¥¢ËøáÁ®ãÔºåÂ∞±ÊòØÊåâÁÖßÊ≠§Êñá‰ª∂Ê†ºÂºèÂ∞ÜÁ¥¢ÂºïËøõÂéªÁöÑ‰ø°ÊÅØËØªÂá∫Êù•ÔºåÁÑ∂ÂêéËÆ°ÁÆóÊØèÁØáÊñáÊ°£ÊâìÂàÜ(score)ÁöÑËøáÁ®ã„ÄÇ</li>
</ul>
<p>ÂèÇËÄÉÂÆòÁΩë <a class="link" href="http://lucene.apache.org/java/2_9_0/fileformats.html"  target="_blank" rel="noopener"
    >Apache Lucene - Index File Formats</a>„ÄÇ</p>
<h2 id="‰∏ÄÂü∫Êú¨Ê¶ÇÂøµ"><strong>‰∏Ä„ÄÅÂü∫Êú¨Ê¶ÇÂøµ</strong></h2>
<p>‰∏ãÂõæÂ∞±ÊòØLuceneÁîüÊàêÁöÑÁ¥¢ÂºïÁöÑ‰∏Ä‰∏™ÂÆû‰æãÔºö</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402262111476.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>LuceneÁöÑÁ¥¢ÂºïÁªìÊûÑÊòØÊúâÂ±ÇÊ¨°ÁªìÊûÑÁöÑÔºå‰∏ªË¶ÅÂàÜ‰ª•‰∏ãÂá†‰∏™Â±ÇÊ¨°Ôºö</p>
<ul>
<li>Á¥¢Âºï(Index)Ôºö
<ul>
<li>Âú®Lucene‰∏≠‰∏Ä‰∏™Á¥¢ÂºïÊòØÊîæÂú®‰∏Ä‰∏™Êñá‰ª∂Â§π‰∏≠ÁöÑ„ÄÇ</li>
<li>Â¶Ç‰∏äÂõæÔºåÂêå‰∏ÄÊñá‰ª∂Â§π‰∏≠ÁöÑÊâÄÊúâÁöÑÊñá‰ª∂ÊûÑÊàê‰∏Ä‰∏™LuceneÁ¥¢Âºï„ÄÇ</li>
</ul>
</li>
<li>ÊÆµ(Segment)Ôºö
<ul>
<li>‰∏Ä‰∏™Á¥¢ÂºïÂèØ‰ª•ÂåÖÂê´Â§ö‰∏™ÊÆµÔºåÊÆµ‰∏éÊÆµ‰πãÈó¥ÊòØÁã¨Á´ãÁöÑÔºåÊ∑ªÂä†Êñ∞ÊñáÊ°£ÂèØ‰ª•ÁîüÊàêÊñ∞ÁöÑÊÆµÔºå‰∏çÂêåÁöÑÊÆµÂèØ‰ª•ÂêàÂπ∂„ÄÇ</li>
<li>Â¶Ç‰∏äÂõæÔºåÂÖ∑ÊúâÁõ∏ÂêåÂâçÁºÄÊñá‰ª∂ÁöÑÂ±ûÂêå‰∏Ä‰∏™ÊÆµÔºåÂõæ‰∏≠ÂÖ±‰∏§‰∏™ÊÆµ &ldquo;_0&rdquo; Âíå &ldquo;_1&rdquo;„ÄÇ</li>
<li>segments.genÂíåsegments_5ÊòØÊÆµÁöÑÂÖÉÊï∞ÊçÆÊñá‰ª∂Ôºå‰πüÂç≥ÂÆÉ‰ª¨‰øùÂ≠ò‰∫ÜÊÆµÁöÑÂ±ûÊÄß‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
<li>ÊñáÊ°£(Document)Ôºö
<ul>
<li>ÊñáÊ°£ÊòØÊàë‰ª¨Âª∫Á¥¢ÂºïÁöÑÂü∫Êú¨Âçï‰ΩçÔºå‰∏çÂêåÁöÑÊñáÊ°£ÊòØ‰øùÂ≠òÂú®‰∏çÂêåÁöÑÊÆµ‰∏≠ÁöÑÔºå‰∏Ä‰∏™ÊÆµÂèØ‰ª•ÂåÖÂê´Â§öÁØáÊñáÊ°£„ÄÇ</li>
<li>Êñ∞Ê∑ªÂä†ÁöÑÊñáÊ°£ÊòØÂçïÁã¨‰øùÂ≠òÂú®‰∏Ä‰∏™Êñ∞ÁîüÊàêÁöÑÊÆµ‰∏≠ÔºåÈöèÁùÄÊÆµÁöÑÂêàÂπ∂Ôºå‰∏çÂêåÁöÑÊñáÊ°£ÂêàÂπ∂Âà∞Âêå‰∏Ä‰∏™ÊÆµ‰∏≠„ÄÇ</li>
</ul>
</li>
<li>Âüü(Field)Ôºö
<ul>
<li>‰∏ÄÁØáÊñáÊ°£ÂåÖÂê´‰∏çÂêåÁ±ªÂûãÁöÑ‰ø°ÊÅØÔºåÂèØ‰ª•ÂàÜÂºÄÁ¥¢ÂºïÔºåÊØîÂ¶ÇÊ†áÈ¢òÔºåÊó∂Èó¥ÔºåÊ≠£ÊñáÔºå‰ΩúËÄÖÁ≠âÔºåÈÉΩÂèØ‰ª•‰øùÂ≠òÂú®‰∏çÂêåÁöÑÂüüÈáå„ÄÇ</li>
<li>‰∏çÂêåÂüüÁöÑÁ¥¢ÂºïÊñπÂºèÂèØ‰ª•‰∏çÂêåÔºåÂú®ÁúüÊ≠£Ëß£ÊûêÂüüÁöÑÂ≠òÂÇ®ÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨‰ºöËØ¶ÁªÜËß£ËØª„ÄÇ</li>
</ul>
</li>
<li>ËØç(Term)Ôºö
<ul>
<li>ËØçÊòØÁ¥¢ÂºïÁöÑÊúÄÂ∞èÂçï‰ΩçÔºåÊòØÁªèËøáËØçÊ≥ïÂàÜÊûêÂíåËØ≠Ë®ÄÂ§ÑÁêÜÂêéÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇ</li>
</ul>
</li>
</ul>
<p>LuceneÁöÑÁ¥¢ÂºïÁªìÊûÑ‰∏≠ÔºåÂç≥‰øùÂ≠ò‰∫ÜÊ≠£Âêë‰ø°ÊÅØÔºå‰πü‰øùÂ≠ò‰∫ÜÂèçÂêë‰ø°ÊÅØ„ÄÇ</p>
<p>ÊâÄË∞ìÊ≠£Âêë‰ø°ÊÅØÔºö</p>
<ul>
<li>ÊåâÂ±ÇÊ¨°‰øùÂ≠ò‰∫Ü‰ªéÁ¥¢ÂºïÔºå‰∏ÄÁõ¥Âà∞ËØçÁöÑÂåÖÂê´ÂÖ≥Á≥ªÔºöÁ¥¢Âºï(Index) ‚Äì&gt; ÊÆµ(segment) ‚Äì&gt; ÊñáÊ°£(Document) ‚Äì&gt; Âüü(Field) ‚Äì&gt; ËØç(Term)</li>
<li>‰πüÂç≥Ê≠§Á¥¢ÂºïÂåÖÂê´‰∫ÜÈÇ£‰∫õÊÆµÔºåÊØè‰∏™ÊÆµÂåÖÂê´‰∫ÜÈÇ£‰∫õÊñáÊ°£ÔºåÊØè‰∏™ÊñáÊ°£ÂåÖÂê´‰∫ÜÈÇ£‰∫õÂüüÔºåÊØè‰∏™ÂüüÂåÖÂê´‰∫ÜÈÇ£‰∫õËØç„ÄÇ</li>
<li>Êó¢ÁÑ∂ÊòØÂ±ÇÊ¨°ÁªìÊûÑÔºåÂàôÊØè‰∏™Â±ÇÊ¨°ÈÉΩ‰øùÂ≠ò‰∫ÜÊú¨Â±ÇÊ¨°ÁöÑ‰ø°ÊÅØ‰ª•Âèä‰∏ã‰∏ÄÂ±ÇÊ¨°ÁöÑÂÖÉ‰ø°ÊÅØÔºå‰πüÂç≥Â±ûÊÄß‰ø°ÊÅØÔºåÊØîÂ¶Ç‰∏ÄÊú¨‰ªãÁªç‰∏≠ÂõΩÂú∞ÁêÜÁöÑ‰π¶ÔºåÂ∫îËØ•È¶ñÂÖà‰ªãÁªç‰∏≠ÂõΩÂú∞ÁêÜÁöÑÊ¶ÇÂÜµÔºå‰ª•Âèä‰∏≠ÂõΩÂåÖÂê´Â§öÂ∞ë‰∏™ÁúÅÔºåÊØè‰∏™ÁúÅ‰ªãÁªçÊú¨ÁúÅÁöÑÂü∫Êú¨Ê¶ÇÂÜµÂèäÂåÖÂê´Â§öÂ∞ë‰∏™Â∏ÇÔºåÊØè‰∏™Â∏Ç‰ªãÁªçÊú¨Â∏ÇÁöÑÂü∫Êú¨Ê¶ÇÂÜµÂèäÂåÖÂê´Â§öÂ∞ë‰∏™ÂéøÔºåÊØè‰∏™ÂéøÂÖ∑‰Ωì‰ªãÁªçÊØè‰∏™ÂéøÁöÑÂÖ∑‰ΩìÊÉÖÂÜµ„ÄÇ</li>
<li>Â¶Ç‰∏äÂõæÔºåÂåÖÂê´Ê≠£Âêë‰ø°ÊÅØÁöÑÊñá‰ª∂ÊúâÔºö
<ul>
<li>segments_N‰øùÂ≠ò‰∫ÜÊ≠§Á¥¢ÂºïÂåÖÂê´Â§öÂ∞ë‰∏™ÊÆµÔºåÊØè‰∏™ÊÆµÂåÖÂê´Â§öÂ∞ëÁØáÊñáÊ°£„ÄÇ</li>
<li>XXX.fnm‰øùÂ≠ò‰∫ÜÊ≠§ÊÆµÂåÖÂê´‰∫ÜÂ§öÂ∞ë‰∏™ÂüüÔºåÊØè‰∏™ÂüüÁöÑÂêçÁß∞ÂèäÁ¥¢ÂºïÊñπÂºè„ÄÇ</li>
<li>XXX.fdxÔºåXXX.fdt‰øùÂ≠ò‰∫ÜÊ≠§ÊÆµÂåÖÂê´ÁöÑÊâÄÊúâÊñáÊ°£ÔºåÊØèÁØáÊñáÊ°£ÂåÖÂê´‰∫ÜÂ§öÂ∞ëÂüüÔºåÊØè‰∏™Âüü‰øùÂ≠ò‰∫ÜÈÇ£‰∫õ‰ø°ÊÅØ„ÄÇ</li>
<li>XXX.tvxÔºåXXX.tvdÔºåXXX.tvf‰øùÂ≠ò‰∫ÜÊ≠§ÊÆµÂåÖÂê´Â§öÂ∞ëÊñáÊ°£ÔºåÊØèÁØáÊñáÊ°£ÂåÖÂê´‰∫ÜÂ§öÂ∞ëÂüüÔºåÊØè‰∏™ÂüüÂåÖÂê´‰∫ÜÂ§öÂ∞ëËØçÔºåÊØè‰∏™ËØçÁöÑÂ≠óÁ¨¶‰∏≤Ôºå‰ΩçÁΩÆÁ≠â‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
</ul>
<p>ÊâÄË∞ìÂèçÂêë‰ø°ÊÅØÔºö</p>
<ul>
<li>‰øùÂ≠ò‰∫ÜËØçÂÖ∏Âà∞ÂÄíÊéíË°®ÁöÑÊò†Â∞ÑÔºöËØç(Term) ‚Äì&gt; ÊñáÊ°£(Document)</li>
<li>Â¶Ç‰∏äÂõæÔºåÂåÖÂê´ÂèçÂêë‰ø°ÊÅØÁöÑÊñá‰ª∂ÊúâÔºö
<ul>
<li>XXX.tisÔºåXXX.tii‰øùÂ≠ò‰∫ÜËØçÂÖ∏(Term Dictionary)Ôºå‰πüÂç≥Ê≠§ÊÆµÂåÖÂê´ÁöÑÊâÄÊúâÁöÑËØçÊåâÂ≠óÂÖ∏È°∫Â∫èÁöÑÊéíÂ∫è„ÄÇ</li>
<li>XXX.frq‰øùÂ≠ò‰∫ÜÂÄíÊéíË°®Ôºå‰πüÂç≥ÂåÖÂê´ÊØè‰∏™ËØçÁöÑÊñáÊ°£IDÂàóË°®„ÄÇ</li>
<li>XXX.prx‰øùÂ≠ò‰∫ÜÂÄíÊéíË°®‰∏≠ÊØè‰∏™ËØçÂú®ÂåÖÂê´Ê≠§ËØçÁöÑÊñáÊ°£‰∏≠ÁöÑ‰ΩçÁΩÆ„ÄÇ</li>
</ul>
</li>
</ul>
<p>Âú®‰∫ÜËß£LuceneÁ¥¢ÂºïÁöÑËØ¶ÁªÜÁªìÊûÑ‰πãÂâçÔºåÂÖàÁúãÁúãLuceneÁ¥¢Âºï‰∏≠ÁöÑÂü∫Êú¨Êï∞ÊçÆÁ±ªÂûã„ÄÇ</p>
<h2 id="‰∫åÂü∫Êú¨Á±ªÂûã"><strong>‰∫å„ÄÅÂü∫Êú¨Á±ªÂûã</strong></h2>
<p>LuceneÁ¥¢ÂºïÊñá‰ª∂‰∏≠ÔºåÁî®‰ª•‰∏ãÂü∫Êú¨Á±ªÂûãÊù•‰øùÂ≠ò‰ø°ÊÅØÔºö</p>
<ul>
<li>ByteÔºöÊòØÊúÄÂü∫Êú¨ÁöÑÁ±ªÂûãÔºåÈïø8‰Ωç(bit)„ÄÇ</li>
<li>UInt32ÔºöÁî±4‰∏™ByteÁªÑÊàê„ÄÇ</li>
<li>UInt64ÔºöÁî±8‰∏™ByteÁªÑÊàê„ÄÇ</li>
<li>VIntÔºö
<ul>
<li>ÂèòÈïøÁöÑÊï¥Êï∞Á±ªÂûãÔºåÂÆÉÂèØËÉΩÂåÖÂê´Â§ö‰∏™ByteÔºåÂØπ‰∫éÊØè‰∏™ByteÁöÑ8‰ΩçÔºåÂÖ∂‰∏≠Âêé7‰ΩçË°®Á§∫Êï∞ÂÄºÔºåÊúÄÈ´ò1‰ΩçË°®Á§∫ÊòØÂê¶ËøòÊúâÂè¶‰∏Ä‰∏™ByteÔºå0Ë°®Á§∫Ê≤°ÊúâÔºå1Ë°®Á§∫Êúâ„ÄÇ</li>
<li>Ë∂äÂâçÈù¢ÁöÑByteË°®Á§∫Êï∞ÂÄºÁöÑ‰Ωé‰ΩçÔºåË∂äÂêéÈù¢ÁöÑByteË°®Á§∫Êï∞ÂÄºÁöÑÈ´ò‰Ωç„ÄÇ</li>
<li>‰æãÂ¶Ç130Âåñ‰∏∫‰∫åËøõÂà∂‰∏∫ 1000, 0010ÔºåÊÄªÂÖ±ÈúÄË¶Å8‰ΩçÔºå‰∏Ä‰∏™ByteË°®Á§∫‰∏ç‰∫ÜÔºåÂõ†ËÄåÈúÄË¶Å‰∏§‰∏™ByteÊù•Ë°®Á§∫ÔºåÁ¨¨‰∏Ä‰∏™ByteË°®Á§∫Âêé7‰ΩçÔºåÂπ∂‰∏îÂú®ÊúÄÈ´ò‰ΩçÁΩÆ1Êù•Ë°®Á§∫ÂêéÈù¢ËøòÊúâ‰∏Ä‰∏™ByteÔºåÊâÄ‰ª•‰∏∫(1) 0000010ÔºåÁ¨¨‰∫å‰∏™ByteË°®Á§∫Á¨¨8‰ΩçÔºåÂπ∂‰∏îÊúÄÈ´ò‰ΩçÁΩÆ0Êù•Ë°®Á§∫ÂêéÈù¢Ê≤°ÊúâÂÖ∂‰ªñÁöÑByte‰∫ÜÔºåÊâÄ‰ª•‰∏∫(0) 0000001„ÄÇ</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402262118850.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>CharsÔºöÊòØUTF-8ÁºñÁ†ÅÁöÑ‰∏ÄÁ≥ªÂàóByte„ÄÇ</li>
<li>StringÔºö‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤È¶ñÂÖàÊòØ‰∏Ä‰∏™VIntÊù•Ë°®Á§∫Ê≠§Â≠óÁ¨¶‰∏≤ÂåÖÂê´ÁöÑÂ≠óÁ¨¶ÁöÑ‰∏™Êï∞ÔºåÊé•ÁùÄ‰æøÊòØUTF-8ÁºñÁ†ÅÁöÑÂ≠óÁ¨¶Â∫èÂàóChars„ÄÇ</li>
</ul>
<h2 id="‰∏âÂü∫Êú¨ËßÑÂàô"><strong>‰∏â„ÄÅÂü∫Êú¨ËßÑÂàô</strong></h2>
<p>Lucene‰∏∫‰∫Ü‰ΩøÁöÑ‰ø°ÊÅØÁöÑÂ≠òÂÇ®Âç†Áî®ÁöÑÁ©∫Èó¥Êõ¥Â∞èÔºåËÆøÈóÆÈÄüÂ∫¶Êõ¥Âø´ÔºåÈááÂèñ‰∫Ü‰∏Ä‰∫õÁâπÊÆäÁöÑÊäÄÂ∑ßÔºåÁÑ∂ËÄåÂú®ÁúãLuceneÊñá‰ª∂Ê†ºÂºèÁöÑÊó∂ÂÄôÔºåËøô‰∫õÊäÄÂ∑ßÂç¥ÂÆπÊòì‰ΩøÊàë‰ª¨ÊÑüÂà∞Âõ∞ÊÉëÔºåÊâÄ‰ª•ÊúâÂøÖË¶ÅÊääËøô‰∫õÁâπÊÆäÁöÑÊäÄÂ∑ßËßÑÂàôÊèêÂèñÂá∫Êù•‰ªãÁªç‰∏Ä‰∏ã„ÄÇ</p>
<h3 id="1-ÂâçÁºÄÂêéÁºÄËßÑÂàôprefixsuffix"><strong>1. ÂâçÁºÄÂêéÁºÄËßÑÂàô(Prefix+Suffix)</strong></h3>
<p>LuceneÂú®ÂèçÂêëÁ¥¢Âºï‰∏≠ÔºåË¶Å‰øùÂ≠òËØçÂÖ∏(Term Dictionary)ÁöÑ‰ø°ÊÅØÔºåÊâÄÊúâÁöÑËØç(Term)Âú®ËØçÂÖ∏‰∏≠ÊòØÊåâÁÖßÂ≠óÂÖ∏È°∫Â∫èËøõË°åÊéíÂàóÁöÑÔºåÁÑ∂ËÄåËØçÂÖ∏‰∏≠ÂåÖÂê´‰∫ÜÊñáÊ°£‰∏≠ÁöÑÂá†‰πéÊâÄÊúâÁöÑËØçÔºåÂπ∂‰∏îÊúâÁöÑËØçËøòÊòØÈùûÂ∏∏ÁöÑÈïøÁöÑÔºåËøôÊ†∑Á¥¢ÂºïÊñá‰ª∂‰ºöÈùûÂ∏∏ÁöÑÂ§ßÔºåÊâÄË∞ìÂâçÁºÄÂêéÁºÄËßÑÂàôÔºåÂç≥ÂΩìÊüê‰∏™ËØçÂíåÂâç‰∏Ä‰∏™ËØçÊúâÂÖ±ÂêåÁöÑÂâçÁºÄÁöÑÊó∂ÂÄôÔºåÂêéÈù¢ÁöÑËØç‰ªÖ‰ªÖ‰øùÂ≠òÂâçÁºÄÂú®ËØç‰∏≠ÁöÑÂÅèÁßª(offset)Ôºå‰ª•ÂèäÈô§ÂâçÁºÄ‰ª•Â§ñÁöÑÂ≠óÁ¨¶‰∏≤(Áß∞‰∏∫ÂêéÁºÄ)„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402262121854.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ÊØîÂ¶ÇË¶ÅÂ≠òÂÇ®Â¶Ç‰∏ãËØç:termÔºåtermagancyÔºåtermagantÔºåterminalÔºå</p>
<p>Â¶ÇÊûúÊåâÁÖßÊ≠£Â∏∏ÊñπÂºèÊù•Â≠òÂÇ®ÔºåÈúÄË¶ÅÁöÑÁ©∫Èó¥Â¶Ç‰∏ãÔºö</p>
<p>[VInt = 4] [t][e][r][m]Ôºå</p>
<p>[VInt = 10][t][e][r][m][a][g][a][n][c][y]Ôºå</p>
<p>[VInt = 9][t][e][r][m][a][g][a][n][t]Ôºå</p>
<p>[VInt = 8][t][e][r][m][i][n][a][l]</p>
<p>ÂÖ±ÈúÄË¶Å35‰∏™Byte.</p>
<p>Â¶ÇÊûúÂ∫îÁî®ÂâçÁºÄÂêéÁºÄËßÑÂàôÔºåÈúÄË¶ÅÁöÑÁ©∫Èó¥Â¶Ç‰∏ãÔºö</p>
<p>[VInt = 4] [t][e][r][m]Ôºå</p>
<p>[VInt = 4 (offset)][VInt = 6][a][g][a][n][c][y]Ôºå</p>
<p>[VInt = 8 (offset)][VInt = 1][t]Ôºå</p>
<p>[VInt = 4 (offset)][VInt = 4][i][n][a][l]</p>
<p>ÂÖ±ÈúÄË¶Å22‰∏™Byte„ÄÇ</p>
<p>Â§ßÂ§ßÁº©Â∞è‰∫ÜÂ≠òÂÇ®Á©∫Èó¥ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÊåâÂ≠óÂÖ∏È°∫Â∫èÊéíÂ∫èÁöÑÊÉÖÂÜµ‰∏ãÔºåÂâçÁºÄÁöÑÈáçÂêàÁéáÂ§ßÂ§ßÊèêÈ´ò„ÄÇ</p>
<h3 id="2-Â∑ÆÂÄºËßÑÂàôdelta"><strong>2. Â∑ÆÂÄºËßÑÂàô(Delta)</strong></h3>
<p>Âú®LuceneÁöÑÂèçÂêëÁ¥¢Âºï‰∏≠ÔºåÈúÄË¶Å‰øùÂ≠òÂæàÂ§öÊï¥ÂûãÊï∞Â≠óÁöÑ‰ø°ÊÅØÔºåÊØîÂ¶ÇÊñáÊ°£IDÂè∑ÔºåÊØîÂ¶ÇËØç(Term)Âú®ÊñáÊ°£‰∏≠ÁöÑ‰ΩçÁΩÆÁ≠âÁ≠â„ÄÇ</p>
<p>Áî±‰∏äÈù¢‰ªãÁªçÔºåÊàë‰ª¨Áü•ÈÅìÔºåÊï¥ÂûãÊï∞Â≠óÊòØ‰ª•VIntÁöÑÊ†ºÂºèÂ≠òÂÇ®ÁöÑ„ÄÇÈöèÁùÄÊï∞ÂÄºÁöÑÂ¢ûÂ§ßÔºåÊØè‰∏™Êï∞Â≠óÂç†Áî®ÁöÑByteÁöÑ‰∏™Êï∞‰πüÈÄêÊ∏êÁöÑÂ¢ûÂ§ö„ÄÇÊâÄË∞ìÂ∑ÆÂÄºËßÑÂàô(Delta)Â∞±ÊòØÂÖàÂêé‰øùÂ≠ò‰∏§‰∏™Êï¥Êï∞ÁöÑÊó∂ÂÄôÔºåÂêéÈù¢ÁöÑÊï¥Êï∞‰ªÖ‰ªÖ‰øùÂ≠òÂíåÂâçÈù¢Êï¥Êï∞ÁöÑÂ∑ÆÂç≥ÂèØ„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402262129662.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ÊØîÂ¶ÇË¶ÅÂ≠òÂÇ®Â¶Ç‰∏ãÊï¥Êï∞Ôºö16386Ôºå16387Ôºå16388Ôºå16389</p>
<p>Â¶ÇÊûúÊåâÁÖßÊ≠£Â∏∏ÊñπÂºèÊù•Â≠òÂÇ®ÔºåÈúÄË¶ÅÁöÑÁ©∫Èó¥Â¶Ç‰∏ãÔºö</p>
<p>[(1) 000, 0010][(1) 000, 0000][(0) 000, 0001]Ôºå</p>
<p>[(1) 000, 0011][(1) 000, 0000][(0) 000, 0001]Ôºå</p>
<p>[(1) 000, 0100][(1) 000, 0000][(0) 000, 0001]Ôºå</p>
<p>[(1) 000, 0101][(1) 000, 0000][(0) 000, 0001]</p>
<p>‰æõÈúÄ12‰∏™Byte„ÄÇ</p>
<p>Â¶ÇÊûúÂ∫îÁî®Â∑ÆÂÄºËßÑÂàôÊù•Â≠òÂÇ®ÔºåÈúÄË¶ÅÁöÑÁ©∫Èó¥Â¶Ç‰∏ãÔºö</p>
<p>[(1) 000, 0010][(1) 000, 0000][(0) 000, 0001]Ôºå</p>
<p>[(0) 000, 0001]Ôºå</p>
<p>[(0) 000, 0001]Ôºå</p>
<p>[(0) 000, 0001]</p>
<p>ÂÖ±ÈúÄ6‰∏™Byte„ÄÇ</p>
<p>Â§ßÂ§ßÁº©Â∞è‰∫ÜÂ≠òÂÇ®Á©∫Èó¥ÔºåËÄå‰∏îÊó†ËÆ∫ÊòØÊñáÊ°£IDÔºåËøòÊòØËØçÂú®ÊñáÊ°£‰∏≠ÁöÑ‰ΩçÁΩÆÔºåÈÉΩÊòØÊåâ‰ªéÂ∞èÂà∞Â§ßÁöÑÈ°∫Â∫èÔºåÈÄêÊ∏êÂ¢ûÂ§ßÁöÑ„ÄÇ</p>
<h3 id="3-ÊàñÁÑ∂Ë∑üÈöèËßÑÂàôa-b"><strong>3. ÊàñÁÑ∂Ë∑üÈöèËßÑÂàô(A, B?)</strong></h3>
<p>LuceneÁöÑÁ¥¢ÂºïÁªìÊûÑ‰∏≠Â≠òÂú®ËøôÊ†∑ÁöÑÊÉÖÂÜµÔºåÊüê‰∏™ÂÄºAÂêéÈù¢ÂèØËÉΩÂ≠òÂú®Êüê‰∏™ÂÄºBÔºå‰πüÂèØËÉΩ‰∏çÂ≠òÂú®ÔºåÈúÄË¶Å‰∏Ä‰∏™Ê†áÂøóÊù•Ë°®Á§∫ÂêéÈù¢ÊòØÂê¶Ë∑üÈöèÁùÄB„ÄÇ</p>
<p>‰∏ÄËà¨ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂú®AÂêéÈù¢ÊîæÁΩÆ‰∏Ä‰∏™ByteÔºå‰∏∫0ÂàôÂêéÈù¢‰∏çÂ≠òÂú®BÔºå‰∏∫1ÂàôÂêéÈù¢Â≠òÂú®BÔºåÊàñËÄÖ0ÂàôÂêéÈù¢Â≠òÂú®BÔºå1ÂàôÂêéÈù¢‰∏çÂ≠òÂú®B„ÄÇ</p>
<p>‰ΩÜËøôÊ†∑Ë¶ÅÊµ™Ë¥π‰∏Ä‰∏™ByteÁöÑÁ©∫Èó¥ÔºåÂÖ∂ÂÆû‰∏Ä‰∏™BitÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<p>Âú®Lucene‰∏≠ÔºåÈááÂèñ‰ª•‰∏ãÁöÑÊñπÂºèÔºöAÁöÑÂÄºÂ∑¶Áßª‰∏Ä‰ΩçÔºåÁ©∫Âá∫ÊúÄÂêé‰∏Ä‰ΩçÔºå‰Ωú‰∏∫Ê†áÂøó‰ΩçÔºåÊù•Ë°®Á§∫ÂêéÈù¢ÊòØÂê¶Ë∑üÈöèBÔºåÊâÄ‰ª•Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåA/2ÊòØÁúüÊ≠£ÁöÑAÂéüÊù•ÁöÑÂÄº„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402262134351.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Â¶ÇÊûúÂéªËØªApache Lucene - Index File FormatsËøôÁØáÊñáÁ´†Ôºå‰ºöÂèëÁé∞ÂæàÂ§öÁ¨¶ÂêàËøôÁßçËßÑÂàôÁöÑÔºö</p>
<ul>
<li>.frqÊñá‰ª∂‰∏≠ÁöÑDocDelta[, Freq?]ÔºåDocSkip,PayloadLength?</li>
<li>.prxÊñá‰ª∂‰∏≠ÁöÑPositionDelta,Payload? (‰ΩÜ‰∏çÂÆåÂÖ®ÊòØÔºåÂ¶Ç‰∏ãË°®ÂàÜÊûê)</li>
</ul>
<p>ÂΩìÁÑ∂ËøòÊúâ‰∏Ä‰∫õÂ∏¶?ÁöÑ‰ΩÜ‰∏çÂ±û‰∫éÊ≠§ËßÑÂàôÁöÑÔºö</p>
<ul>
<li>.frqÊñá‰ª∂‰∏≠ÁöÑSkipChildLevelPointer?ÔºåÊòØÂ§öÂ±ÇË∑≥Ë∑ÉË°®‰∏≠ÔºåÊåáÂêë‰∏ã‰∏ÄÂ±ÇË°®ÁöÑÊåáÈíàÔºåÂΩìÁÑ∂Â¶ÇÊûúÊòØÊúÄÂêé‰∏ÄÂ±ÇÔºåÊ≠§ÂÄºÂ∞±‰∏çÂ≠òÂú®Ôºå‰πü‰∏çÈúÄË¶ÅÊ†áÂøó„ÄÇ</li>
<li>.tvfÊñá‰ª∂‰∏≠ÁöÑPositions?, Offsets?„ÄÇ
<ul>
<li>Âú®Ê≠§Á±ªÊÉÖÂÜµ‰∏ãÔºåÂ∏¶?ÁöÑÂÄºÊòØÂê¶Â≠òÂú®ÔºåÂπ∂‰∏çÂèñÂÜ≥‰∫éÂâçÈù¢ÁöÑÂÄºÁöÑÊúÄÂêé‰∏Ä‰Ωç„ÄÇ</li>
<li>ËÄåÊòØÂèñÂÜ≥‰∫éLuceneÁöÑÊüêÈ°πÈÖçÁΩÆÔºåÂΩìÁÑ∂Ëøô‰∫õÈÖçÁΩÆ‰πüÊòØ‰øùÂ≠òÂú®LuceneÁ¥¢ÂºïÊñá‰ª∂‰∏≠ÁöÑ„ÄÇ</li>
<li>Â¶ÇPositionÂíåOffsetÊòØÂê¶Â≠òÂÇ®ÔºåÂèñÂÜ≥‰∫é.fnmÊñá‰ª∂‰∏≠ÂØπ‰∫éÊØè‰∏™ÂüüÁöÑÈÖçÁΩÆ(TermVector.WITH_POSITIONSÂíåTermVector.WITH_OFFSETS)</li>
</ul>
</li>
</ul>
<p>‰∏∫‰ªÄ‰πà‰ºöÂ≠òÂú®‰ª•‰∏ä‰∏§ÁßçÊÉÖÂÜµÔºåÂÖ∂ÂÆûÊòØÂèØ‰ª•ÁêÜËß£ÁöÑÔºö</p>
<ul>
<li>ÂØπ‰∫éÁ¨¶ÂêàÊàñÁÑ∂Ë∑üÈöèËßÑÂàôÁöÑÔºåÊòØÂõ†‰∏∫ÂØπ‰∫éÊØè‰∏Ä‰∏™AÔºåBÊòØÂê¶Â≠òÂú®ÈÉΩ‰∏çÁõ∏ÂêåÔºåÂΩìËøôÁßçÊÉÖÂÜµÂ§ßÈáèÂ≠òÂú®ÁöÑÊó∂ÂÄôÔºå‰ªé‰∏Ä‰∏™ByteÂà∞‰∏Ä‰∏™BitÂ¶ÇÊ≠§8ÂÄçÁöÑÁ©∫Èó¥ËäÇÁ∫¶ËøòÊòØÂæàÂÄºÂæóÁöÑ„ÄÇ</li>
<li>ÂØπ‰∫é‰∏çÁ¨¶ÂêàÊàñÁÑ∂Ë∑üÈöèËßÑÂàôÁöÑÔºåÊòØÂõ†‰∏∫Êüê‰∏™ÂÄºÁöÑÊòØÂê¶Â≠òÂú®ÁöÑÈÖçÁΩÆÂØπ‰∫éÊï¥‰∏™Âüü(Field)ÁîöËá≥Êï¥‰∏™Á¥¢ÂºïÈÉΩÊòØÊúâÊïàÁöÑÔºåËÄåÈùûÊØèÊ¨°ÁöÑÊÉÖÂÜµÈÉΩ‰∏çÁõ∏ÂêåÔºåÂõ†ËÄåÂèØ‰ª•Áªü‰∏ÄÂ≠òÊîæ‰∏Ä‰∏™Ê†áÂøó„ÄÇ</li>
</ul>
<blockquote>
<p>ÊñáÁ´†‰∏≠ÂØπÂ¶Ç‰∏ãÊ†ºÂºèÁöÑÊèèËø∞‰ª§‰∫∫Âõ∞ÊÉëÔºö</p>
</blockquote>
<blockquote>
<p>Positions &ndash;&gt; &lt;PositionDelta,Payload?&gt; <!-- raw HTML omitted -->Freq<!-- raw HTML omitted --></p>
</blockquote>
<blockquote>
<p>Payload &ndash;&gt; &lt;PayloadLength?,PayloadData&gt;</p>
</blockquote>
<blockquote>
<p>PositionDeltaÂíåPayloadÊòØÂê¶ÈÄÇÁî®ÊàñÁÑ∂Ë∑üÈöèËßÑÂàôÂë¢ÔºüÂ¶Ç‰ΩïÊ†áËØÜPayloadLengthÊòØÂê¶Â≠òÂú®Âë¢Ôºü</p>
</blockquote>
<blockquote>
<p>ÂÖ∂ÂÆûPositionDeltaÂíåPayloadÂπ∂‰∏çÁ¨¶ÂêàÊàñÁÑ∂Ë∑üÈöèËßÑÂàôÔºåPayloadÊòØÂê¶Â≠òÂú®ÔºåÊòØÁî±.fnmÊñá‰ª∂‰∏≠ÂØπ‰∫éÊØè‰∏™ÂüüÁöÑÈÖçÁΩÆ‰∏≠ÊúâÂÖ≥PayloadÁöÑÈÖçÁΩÆÂÜ≥ÂÆöÁöÑ(FieldOption.STORES_PAYLOADS) „ÄÇ</p>
</blockquote>
<blockquote>
<p>ÂΩìPayload‰∏çÂ≠òÂú®Êó∂ÔºåPayloadDeltaÊú¨Ë∫´‰∏çÈÅµ‰ªéÊàñÁÑ∂Ë∑üÈöèÂéüÂàô„ÄÇ</p>
</blockquote>
<blockquote>
<p>ÂΩìPayloadÂ≠òÂú®Êó∂ÔºåÊ†ºÂºèÂ∫îËØ•ÂèòÊàêÂ¶Ç‰∏ãÔºöPositions &ndash;&gt; &lt;PositionDelta,PayloadLength?,PayloadData&gt; <!-- raw HTML omitted -->Freq<!-- raw HTML omitted --></p>
</blockquote>
<blockquote>
<p>‰ªéËÄåPositionDeltaÂíåPayloadLength‰∏ÄËµ∑ÈÄÇÁî®ÊàñÁÑ∂Ë∑üÈöèËßÑÂàô„ÄÇ</p>
</blockquote>
<h3 id="4-Ë∑≥Ë∑ÉË°®ËßÑÂàôskip-list"><strong>4. Ë∑≥Ë∑ÉË°®ËßÑÂàô(Skip list)</strong></h3>
<p>‰∏∫‰∫ÜÊèêÈ´òÊü•ÊâæÁöÑÊÄßËÉΩÔºåLuceneÂú®ÂæàÂ§öÂú∞ÊñπÈááÂèñÁöÑË∑≥Ë∑ÉË°®ÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇ</p>
<p>Ë∑≥Ë∑ÉË°®(Skip List)ÊòØÂ¶ÇÂõæÁöÑ‰∏ÄÁßçÊï∞ÊçÆÁªìÊûÑÔºåÊúâ‰ª•‰∏ãÂá†‰∏™Âü∫Êú¨ÁâπÂæÅÔºö</p>
<ul>
<li>ÂÖÉÁ¥†ÊòØÊåâÈ°∫Â∫èÊéíÂàóÁöÑÔºåÂú®Lucene‰∏≠ÔºåÊàñÊòØÊåâÂ≠óÂÖ∏È°∫Â∫èÊéíÂàóÔºåÊàñÊòØÊåâ‰ªéÂ∞èÂà∞Â§ßÈ°∫Â∫èÊéíÂàó„ÄÇ</li>
<li>Ë∑≥Ë∑ÉÊòØÊúâÈó¥ÈöîÁöÑ(Interval)Ôºå‰πüÂç≥ÊØèÊ¨°Ë∑≥Ë∑ÉÁöÑÂÖÉÁ¥†Êï∞ÔºåÈó¥ÈöîÊòØ‰∫ãÂÖàÈÖçÁΩÆÂ•ΩÁöÑÔºåÂ¶ÇÂõæË∑≥Ë∑ÉË°®ÁöÑÈó¥Èöî‰∏∫3„ÄÇ</li>
<li>Ë∑≥Ë∑ÉË°®ÊòØÁî±Â±ÇÊ¨°ÁöÑ(level)ÔºåÊØè‰∏ÄÂ±ÇÁöÑÊØèÈöîÊåáÂÆöÈó¥ÈöîÁöÑÂÖÉÁ¥†ÊûÑÊàê‰∏ä‰∏ÄÂ±ÇÔºåÂ¶ÇÂõæË∑≥Ë∑ÉË°®ÂÖ±Êúâ2Â±Ç„ÄÇ</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402262141098.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ÈúÄË¶ÅÊ≥®ÊÑè‰∏ÄÁÇπÁöÑÊòØÔºåÂú®ÂæàÂ§öÊï∞ÊçÆÁªìÊûÑÊàñÁÆóÊ≥ï‰π¶‰∏≠ÈÉΩ‰ºöÊúâË∑≥Ë∑ÉË°®ÁöÑÊèèËø∞ÔºåÂéüÁêÜÈÉΩÊòØÂ§ßËá¥Áõ∏ÂêåÁöÑÔºå‰ΩÜÊòØÂÆö‰πâÁ®çÊúâÂ∑ÆÂà´Ôºö</p>
<ul>
<li>ÂØπÈó¥Èöî(Interval)ÁöÑÂÆö‰πâÔºö Â¶ÇÂõæ‰∏≠ÔºåÊúâÁöÑËÆ§‰∏∫Èó¥Èöî‰∏∫2ÔºåÂç≥‰∏§‰∏™‰∏äÂ±ÇÂÖÉÁ¥†‰πãÈó¥ÁöÑÂÖÉÁ¥†Êï∞Ôºå‰∏çÂåÖÊã¨‰∏§‰∏™‰∏äÂ±ÇÂÖÉÁ¥†ÔºõÊúâÁöÑËÆ§‰∏∫ÊòØ3ÔºåÂç≥‰∏§‰∏™‰∏äÂ±ÇÂÖÉÁ¥†‰πãÈó¥ÁöÑÂ∑ÆÔºåÂåÖÊã¨ÂêéÈù¢‰∏äÂ±ÇÂÖÉÁ¥†Ôºå‰∏çÂåÖÊã¨ÂâçÈù¢ÁöÑ‰∏äÂ±ÇÂÖÉÁ¥†ÔºõÊúâÁöÑËÆ§‰∏∫ÊòØ4ÔºåÂç≥Èô§‰∏§‰∏™‰∏äÂ±ÇÂÖÉÁ¥†‰πãÈó¥ÁöÑÂÖÉÁ¥†Â§ñÔºåÊó¢ÂåÖÊã¨ÂâçÈù¢Ôºå‰πüÂåÖÊã¨ÂêéÈù¢ÁöÑ‰∏äÂ±ÇÂÖÉÁ¥†„ÄÇLuceneÊòØÈááÂèñÁöÑÁ¨¨‰∫åÁßçÂÆö‰πâ„ÄÇ</li>
<li>ÂØπÂ±ÇÊ¨°(Level)ÁöÑÂÆö‰πâÔºöÂ¶ÇÂõæ‰∏≠ÔºåÊúâÁöÑËÆ§‰∏∫Â∫îËØ•ÂåÖÊã¨ÂéüÈìæË°®Â±ÇÔºåÂπ∂‰ªé1ÂºÄÂßãËÆ°Êï∞ÔºåÂàôÊÄªÂ±ÇÊ¨°‰∏∫3Ôºå‰∏∫1Ôºå2Ôºå3Â±ÇÔºõÊúâÁöÑËÆ§‰∏∫Â∫îËØ•ÂåÖÊã¨ÂéüÈìæË°®Â±ÇÔºåÂπ∂‰ªé0ËÆ°Êï∞Ôºå‰∏∫0Ôºå1Ôºå2Â±ÇÔºõÊúâÁöÑËÆ§‰∏∫‰∏çÂ∫îËØ•ÂåÖÊã¨ÂéüÈìæË°®Â±ÇÔºå‰∏î‰ªé1ÂºÄÂßãËÆ°Êï∞ÔºåÂàô‰∏∫1Ôºå2Â±ÇÔºõÊúâÁöÑËÆ§‰∏∫‰∏çÂ∫îËØ•ÂåÖÊã¨ÈìæË°®Â±ÇÔºå‰∏î‰ªé0ÂºÄÂßãËÆ°Êï∞ÔºåÂàô‰∏∫0Ôºå1Â±Ç„ÄÇLuceneÈááÂèñÁöÑÊòØÊúÄÂêé‰∏ÄÁßçÂÆö‰πâ„ÄÇ</li>
</ul>
<p>Ë∑≥Ë∑ÉË°®ÊØîÈ°∫Â∫èÊü•ÊâæÔºåÂ§ßÂ§ßÊèêÈ´ò‰∫ÜÊü•ÊâæÈÄüÂ∫¶ÔºåÂ¶ÇÊü•ÊâæÂÖÉÁ¥†72ÔºåÂéüÊù•Ë¶ÅËÆøÈóÆ2Ôºå3Ôºå7Ôºå12Ôºå23Ôºå37Ôºå39Ôºå44Ôºå50Ôºå72ÊÄªÂÖ±10‰∏™ÂÖÉÁ¥†ÔºåÂ∫îÁî®Ë∑≥Ë∑ÉË°®ÂêéÔºåÂè™Ë¶ÅÈ¶ñÂÖàËÆøÈóÆÁ¨¨1Â±ÇÁöÑ50ÔºåÂèëÁé∞72Â§ß‰∫é50ÔºåËÄåÁ¨¨1Â±ÇÊó†‰∏ã‰∏Ä‰∏™ËäÇÁÇπÔºåÁÑ∂ÂêéËÆøÈóÆÁ¨¨2Â±ÇÁöÑ94ÔºåÂèëÁé∞94Â§ß‰∫é72ÔºåÁÑ∂ÂêéËÆøÈóÆÂéüÈìæË°®ÁöÑ72ÔºåÊâæÂà∞ÂÖÉÁ¥†ÔºåÂÖ±ÈúÄË¶ÅËÆøÈóÆ3‰∏™ÂÖÉÁ¥†Âç≥ÂèØ„ÄÇ</p>
<p>ÁÑ∂ËÄåLuceneÂú®ÂÖ∑‰ΩìÂÆûÁé∞‰∏äÔºå‰∏éÁêÜËÆ∫ÂèàÊúâÊâÄ‰∏çÂêåÔºåÂú®ÂÖ∑‰ΩìÁöÑÊ†ºÂºè‰∏≠Ôºå‰ºöËØ¶ÁªÜËØ¥Êòé„ÄÇ</p>
<h2 id="ÂõõÂÖ∑‰ΩìÊ†ºÂºè"><strong>Âõõ„ÄÅÂÖ∑‰ΩìÊ†ºÂºè</strong></h2>
<p>‰∏äÈù¢ÊõæÁªè‰∫§‰ª£ËøáÔºåLucene‰øùÂ≠ò‰∫Ü‰ªéIndexÂà∞SegmentÂà∞DocumentÂà∞Field‰∏ÄÁõ¥Âà∞TermÁöÑÊ≠£Âêë‰ø°ÊÅØÔºå‰πüÂåÖÊã¨‰∫Ü‰ªéTermÂà∞DocumentÊò†Â∞ÑÁöÑÂèçÂêë‰ø°ÊÅØÔºåËøòÊúâÂÖ∂‰ªñ‰∏Ä‰∫õLuceneÁâπÊúâÁöÑ‰ø°ÊÅØ„ÄÇ‰∏ãÈù¢ÂØπËøô‰∏âÁßç‰ø°ÊÅØ‰∏Ä‰∏Ä‰ªãÁªç„ÄÇ</p>
<h3 id="41-Ê≠£Âêë‰ø°ÊÅØ"><strong>4.1. Ê≠£Âêë‰ø°ÊÅØ</strong></h3>
<p><code>Index ‚Äì&gt; Segments (segments.gen, segments_N) ‚Äì&gt; Field(fnm, fdx, fdt) ‚Äì&gt; Term (tvx, tvd, tvf)</code></p>
<p>‰∏äÈù¢ÁöÑÂ±ÇÊ¨°ÁªìÊûÑ‰∏çÊòØÂçÅÂàÜÁöÑÂáÜÁ°ÆÔºåÂõ†‰∏∫segments.genÂíåsegments_N‰øùÂ≠òÁöÑÊòØÊÆµ(segment)ÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ(metadata)ÔºåÂÖ∂ÂÆûÊòØÊØè‰∏™Index‰∏Ä‰∏™ÁöÑÔºåËÄåÊÆµÁöÑÁúüÊ≠£ÁöÑÊï∞ÊçÆ‰ø°ÊÅØÔºåÊòØ‰øùÂ≠òÂú®Âüü(Field)ÂíåËØç(Term)‰∏≠ÁöÑ„ÄÇ</p>
<h4 id="411-ÊÆµÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØsegments_n"><strong>4.1.1. ÊÆµÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ(segments_N)</strong></h4>
<p>‰∏Ä‰∏™Á¥¢Âºï(Index)ÂèØ‰ª•ÂêåÊó∂Â≠òÂú®Â§ö‰∏™segments_N(Ëá≥‰∫éÂ¶Ç‰ΩïÂ≠òÂú®Â§ö‰∏™segments_NÔºåÂú®ÊèèËø∞ÂÆåËØ¶ÁªÜ‰ø°ÊÅØ‰πãÂêé‰ºö‰∏æ‰æãËØ¥Êòé)ÔºåÁÑ∂ËÄåÂΩìÊàë‰ª¨Ë¶ÅÊâìÂºÄ‰∏Ä‰∏™Á¥¢ÂºïÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨ÂøÖÈ°ªË¶ÅÈÄâÊã©‰∏Ä‰∏™Êù•ÊâìÂºÄÔºåÈÇ£Â¶Ç‰ΩïÈÄâÊã©Âì™‰∏™segments_NÂë¢Ôºü</p>
<p>LuceneÈááÂèñ‰ª•‰∏ãËøáÁ®ãÔºö</p>
<ul>
<li>
<p>ÂÖ∂‰∏ÄÔºåÂú®ÊâÄÊúâÁöÑsegments_N‰∏≠ÈÄâÊã©NÊúÄÂ§ßÁöÑ‰∏Ä‰∏™„ÄÇÂü∫Êú¨ÈÄªËæëÂèÇÁÖßSegmentInfos.getCurrentSegmentGeneration(File[] files)ÔºåÂÖ∂Âü∫Êú¨ÊÄùË∑ØÂ∞±ÊòØÂú®ÊâÄÊúâ‰ª•segmentsÂºÄÂ§¥ÔºåÂπ∂‰∏î‰∏çÊòØsegments.genÁöÑÊñá‰ª∂‰∏≠ÔºåÈÄâÊã©NÊúÄÂ§ßÁöÑ‰∏Ä‰∏™‰Ωú‰∏∫genA„ÄÇ</p>
</li>
<li>
<p>ÂÖ∂‰∫åÔºåÊâìÂºÄsegments.genÔºåÂÖ∂‰∏≠‰øùÂ≠ò‰∫ÜÂΩìÂâçÁöÑNÂÄº„ÄÇÂÖ∂Ê†ºÂºèÂ¶Ç‰∏ãÔºåËØªÂá∫ÁâàÊú¨Âè∑(Version)ÔºåÁÑ∂ÂêéÂÜçËØªÂá∫‰∏§‰∏™NÔºåÂ¶ÇÊûú‰∏§ËÄÖÁõ∏Á≠âÔºåÂàô‰Ωú‰∏∫genB„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402272228421.png"
	
	
	
	loading="lazy"
	
	
></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>IndexInput genInput <span style="color:#f92672">=</span> directory<span style="color:#f92672">.</span><span style="color:#a6e22e">openInput</span><span style="color:#f92672">(</span>IndexFileNames<span style="color:#f92672">.</span><span style="color:#a6e22e">SEGMENTS_GEN</span><span style="color:#f92672">);</span><span style="color:#75715e">//&#34;segments.gen&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> version <span style="color:#f92672">=</span> genInput<span style="color:#f92672">.</span><span style="color:#a6e22e">readInt</span><span style="color:#f92672">();</span><span style="color:#75715e">//ËØªÂá∫ÁâàÊú¨Âè∑  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>version <span style="color:#f92672">==</span> FORMAT_LOCKLESS<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//Â¶ÇÊûúÁâàÊú¨Âè∑Ê≠£Á°Æ  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">long</span> gen0 <span style="color:#f92672">=</span> genInput<span style="color:#f92672">.</span><span style="color:#a6e22e">readLong</span><span style="color:#f92672">();</span><span style="color:#75715e">//ËØªÂá∫Á¨¨‰∏Ä‰∏™N  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">long</span> gen1 <span style="color:#f92672">=</span> genInput<span style="color:#f92672">.</span><span style="color:#a6e22e">readLong</span><span style="color:#f92672">();</span><span style="color:#75715e">//ËØªÂá∫Á¨¨‰∫å‰∏™N  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>gen0 <span style="color:#f92672">==</span> gen1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//Â¶ÇÊûú‰∏§ËÄÖÁõ∏Á≠âÂàô‰∏∫genB  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        genB <span style="color:#f92672">=</span> gen0<span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>ÂÖ∂‰∏âÔºåÂú®‰∏äËø∞ÂæóÂà∞ÁöÑgenAÂíågenB‰∏≠ÈÄâÊã©ÊúÄÂ§ßÁöÑÈÇ£‰∏™‰Ωú‰∏∫ÂΩìÂâçÁöÑNÔºåÊñπÊâçÊâìÂºÄsegments_NÊñá‰ª∂„ÄÇÂÖ∂Âü∫Êú¨ÈÄªËæëÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>genA <span style="color:#f92672">&gt;</span> genB<span style="color:#f92672">)</span>  
</span></span><span style="display:flex;"><span>    gen <span style="color:#f92672">=</span> genA<span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>  
</span></span><span style="display:flex;"><span>    gen <span style="color:#f92672">=</span> genB<span style="color:#f92672">;</span>
</span></span></code></pre></div></li>
</ul>
<p>Â¶Ç‰∏ãÂõæÊòØsegments_NÁöÑÂÖ∑‰ΩìÊ†ºÂºèÔºö</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402272230529.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>FormatÔºö
<ul>
<li>Á¥¢ÂºïÊñá‰ª∂Ê†ºÂºèÁöÑÁâàÊú¨Âè∑„ÄÇ</li>
<li>Áî±‰∫éLuceneÊòØÂú®‰∏çÊñ≠ÂºÄÂèëËøáÁ®ã‰∏≠ÁöÑÔºåÂõ†ËÄå‰∏çÂêåÁâàÊú¨ÁöÑLuceneÔºåÂÖ∂Á¥¢ÂºïÊñá‰ª∂Ê†ºÂºè‰πü‰∏çÂ∞ΩÁõ∏ÂêåÔºå‰∫éÊòØËßÑÂÆö‰∏Ä‰∏™ÁâàÊú¨Âè∑„ÄÇ</li>
<li>Lucene 2.1Ê≠§ÂÄº-3ÔºåLucene 2.9Êó∂ÔºåÊ≠§ÂÄº‰∏∫-9„ÄÇ</li>
<li>ÂΩìÁî®Êüê‰∏™ÁâàÊú¨Âè∑ÁöÑIndexReaderËØªÂèñÂè¶‰∏Ä‰∏™ÁâàÊú¨Âè∑ÁîüÊàêÁöÑÁ¥¢ÂºïÁöÑÊó∂ÂÄôÔºå‰ºöÂõ†‰∏∫Ê≠§ÂÄº‰∏çÂêåËÄåÊä•Èîô„ÄÇ</li>
</ul>
</li>
<li>VersionÔºö
<ul>
<li>Á¥¢ÂºïÁöÑÁâàÊú¨Âè∑ÔºåËÆ∞ÂΩï‰∫ÜIndexWriterÂ∞Ü‰øÆÊîπÊèê‰∫§Âà∞Á¥¢ÂºïÊñá‰ª∂‰∏≠ÁöÑÊ¨°Êï∞„ÄÇ</li>
<li>ÂÖ∂ÂàùÂßãÂÄºÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ã‰ªéÁ¥¢ÂºïÊñá‰ª∂ÈáåÈù¢ËØªÂá∫Ôºå‰ªÖ‰ªÖÂú®Á¥¢ÂºïÂºÄÂßãÂàõÂª∫ÁöÑÊó∂ÂÄôÔºåË¢´Ëµã‰∫àÂΩìÂâçÁöÑÊó∂Èó¥ÔºåÂ∑≤ÂèñÂæó‰∏Ä‰∏™ÂîØ‰∏ÄÂÄº„ÄÇ</li>
<li>ÂÖ∂ÂÄºÊîπÂèòÂú® <code>IndexWriter.commit-&gt;IndexWriter.startCommit-&gt;SegmentInfos.prepareCommit-&gt;SegmentInfos.write-&gt;writeLong(++version)</code></li>
<li>ÂÖ∂ÂàùÂßãÂÄº‰πãÊâÄÊúÄÂàùÂèñ‰∏Ä‰∏™Êó∂Èó¥ÔºåÊòØÂõ†‰∏∫Êàë‰ª¨Âπ∂‰∏çÂÖ≥ÂøÉIndexWriterÂ∞Ü‰øÆÊîπÊèê‰∫§Âà∞Á¥¢ÂºïÁöÑÂÖ∑‰ΩìÊ¨°Êï∞ÔºåËÄåÊõ¥ÂÖ≥ÂøÉÂà∞Â∫ïÂì™‰∏™ÊòØÊúÄÊñ∞ÁöÑ„ÄÇIndexReader‰∏≠Â∏∏ÊØîËæÉËá™Â∑±ÁöÑversionÂíåÁ¥¢ÂºïÊñá‰ª∂‰∏≠ÁöÑversionÊòØÂê¶Áõ∏ÂêåÊù•Âà§Êñ≠Ê≠§IndexReaderË¢´ÊâìÂºÄÂêéÔºåËøòÊúâÊ≤°ÊúâË¢´IndexWriterÊõ¥Êñ∞„ÄÇ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//Âú®DirectoryReader‰∏≠Êúâ‰∏Ä‰∏ãÂáΩÊï∞„ÄÇ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isCurrent</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> CorruptIndexException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> SegmentInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">readCurrentVersion</span><span style="color:#f92672">(</span>directory<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> segmentInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">getVersion</span><span style="color:#f92672">();</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>NameCount
<ul>
<li>ÊòØ‰∏ã‰∏Ä‰∏™Êñ∞ÊÆµ(Segment)ÁöÑÊÆµÂêç„ÄÇ</li>
<li>ÊâÄÊúâÂ±û‰∫éÂêå‰∏Ä‰∏™ÊÆµÁöÑÁ¥¢ÂºïÊñá‰ª∂ÈÉΩ‰ª•ÊÆµÂêç‰Ωú‰∏∫Êñá‰ª∂ÂêçÔºå‰∏ÄËà¨‰∏∫_0.xxx, _0.yyy,  _1.xxx, _1.yyy ‚Ä¶‚Ä¶</li>
<li>Êñ∞ÁîüÊàêÁöÑÊÆµÁöÑÊÆµÂêç‰∏ÄËà¨‰∏∫ÂéüÊúâÊúÄÂ§ßÊÆµÂêçÂä†‰∏Ä„ÄÇ</li>
<li>Â¶ÇÂêåÁöÑÁ¥¢ÂºïÔºåNameCountËØªÂá∫Êù•ÊòØ2ÔºåËØ¥ÊòéÊñ∞ÁöÑÊÆµ‰∏∫_2.xxx, _2.yyy</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202402272232711.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>SegCount
<ul>
<li>ÊÆµ(Segment)ÁöÑ‰∏™Êï∞„ÄÇ</li>
<li>Â¶Ç‰∏äÂõæÔºåÊ≠§ÂÄº‰∏∫2„ÄÇ</li>
</ul>
</li>
<li>SegCount‰∏™ÊÆµÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºö
<ul>
<li>SegName
<ul>
<li>ÊÆµÂêçÔºåÊâÄÊúâÂ±û‰∫éÂêå‰∏Ä‰∏™ÊÆµÁöÑÊñá‰ª∂ÈÉΩÊúâ‰ª•ÊÆµÂêç‰Ωú‰∏∫Êñá‰ª∂Âêç„ÄÇ</li>
<li>Â¶Ç‰∏äÂõæÔºåÁ¨¨‰∏Ä‰∏™ÊÆµÁöÑÊÆµÂêç‰∏∫&quot;_0&quot;ÔºåÁ¨¨‰∫å‰∏™ÊÆµÁöÑÊÆµÂêç‰∏∫&quot;_1&quot;</li>
</ul>
</li>
<li>SegSize
<ul>
<li>Ê≠§ÊÆµ‰∏≠ÂåÖÂê´ÁöÑÊñáÊ°£Êï∞</li>
<li>ÁÑ∂ËÄåÊ≠§ÊñáÊ°£Êï∞ÊòØÂåÖÊã¨Â∑≤ÁªèÂà†Èô§ÔºåÂèàÊ≤°ÊúâoptimizeÁöÑÊñáÊ°£ÁöÑÔºåÂõ†‰∏∫Âú®optimize‰πãÂâçÔºåLuceneÁöÑÊÆµ‰∏≠ÂåÖÂê´‰∫ÜÊâÄÊúâË¢´Á¥¢ÂºïËøáÁöÑÊñáÊ°£ÔºåËÄåË¢´Âà†Èô§ÁöÑÊñáÊ°£ÊòØ‰øùÂ≠òÂú®.delÊñá‰ª∂‰∏≠ÁöÑÔºåÂú®ÊêúÁ¥¢ÁöÑËøáÁ®ã‰∏≠ÔºåÊòØÂÖà‰ªéÊÆµ‰∏≠ËØªÂà∞‰∫ÜË¢´Âà†Èô§ÁöÑÊñáÊ°£ÔºåÁÑ∂ÂêéÂÜçÁî®.del‰∏≠ÁöÑÊ†áÂøóÔºåÂ∞ÜËøôÁØáÊñáÊ°£ËøáÊª§Êéâ„ÄÇ</li>
<li>Â¶Ç‰∏ãÁöÑ‰ª£Á†ÅÂΩ¢Êàê‰∫Ü‰∏äÂõæÁöÑÁ¥¢ÂºïÔºåÂèØ‰ª•ÁúãÂá∫Á¥¢Âºï‰∫Ü‰∏§ÁØáÊñáÊ°£ÂΩ¢Êàê‰∫Ü_0ÊÆµÔºåÁÑ∂ÂêéÂèàÂà†Èô§‰∫ÜÂÖ∂‰∏≠‰∏ÄÁØáÔºåÂΩ¢Êàê‰∫Ü_0_1.delÔºåÂèàÁ¥¢Âºï‰∫Ü‰∏§ÁØáÊñáÊ°£ÂΩ¢Êàê_1ÊÆµÔºåÁÑ∂ÂêéÂèàÂà†Èô§‰∫ÜÂÖ∂‰∏≠‰∏ÄÁØáÔºåÂΩ¢Êàê_1_1.del„ÄÇÂõ†ËÄåÂú®‰∏§‰∏™ÊÆµ‰∏≠ÔºåÊ≠§ÂÄºÈÉΩÊòØ2„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>IndexWriter writer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> IndexWriter<span style="color:#f92672">(</span>FSDirectory<span style="color:#f92672">.</span><span style="color:#a6e22e">open</span><span style="color:#f92672">(</span>INDEX<span style="color:#960050;background-color:#1e0010">\</span>_DIR<span style="color:#f92672">),</span> <span style="color:#66d9ef">new</span> StandardAnalyzer<span style="color:#f92672">(</span>Version<span style="color:#f92672">.</span><span style="color:#a6e22e">LUCENE</span><span style="color:#960050;background-color:#1e0010">\</span>_CURRENT<span style="color:#f92672">),</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> IndexWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">MaxFieldLength</span><span style="color:#f92672">.</span><span style="color:#a6e22e">LIMITED</span><span style="color:#f92672">);</span>  
</span></span><span style="display:flex;"><span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">setUseCompoundFile</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>  
</span></span><span style="display:flex;"><span>indexDocs<span style="color:#f92672">(</span>writer<span style="color:#f92672">,</span> docDir<span style="color:#f92672">);</span><span style="color:#75715e">//docDir‰∏≠Âè™Êúâ‰∏§ÁØáÊñáÊ°£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ÊñáÊ°£‰∏Ä‰∏∫ÔºöStudents should be allowed to go out with their friends, but not allowed to drink beer.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ÊñáÊ°£‰∫å‰∏∫ÔºöMy friend Jerry went to school to see his students but found them drunk which is not allowed.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span><span style="color:#75715e">//Êèê‰∫§‰∏§ÁØáÊñáÊ°£ÔºåÂΩ¢Êàê\_0ÊÆµ„ÄÇ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteDocuments</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Term<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;contents&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;school&#34;</span><span style="color:#f92672">));</span><span style="color:#75715e">//Âà†Èô§ÊñáÊ°£‰∫å  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span><span style="color:#75715e">//Êèê‰∫§Âà†Èô§ÔºåÂΩ¢Êàê\_0\_1.del  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>indexDocs<span style="color:#f92672">(</span>writer<span style="color:#f92672">,</span> docDir<span style="color:#f92672">);</span><span style="color:#75715e">//ÂÜçÊ¨°Á¥¢Âºï‰∏§ÁØáÊñáÊ°£ÔºåLucene‰∏çËÉΩÂà§Âà´ÊñáÊ°£‰∏éÊñáÊ°£ÁöÑ‰∏çÂêåÔºåÂõ†ËÄåÁÆó‰∏§ÁØáÊñ∞ÁöÑÊñáÊ°£„ÄÇ  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span><span style="color:#75715e">//Êèê‰∫§‰∏§ÁØáÊñáÊ°£ÔºåÂΩ¢Êàê\_1ÊÆµ  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteDocuments</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Term<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;contents&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;school&#34;</span><span style="color:#f92672">));</span><span style="color:#75715e">//Âà†Èô§Á¨¨‰∫åÊ¨°Ê∑ªÂä†ÁöÑÊñáÊ°£‰∫å  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>writer<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span><span style="color:#75715e">//Êèê‰∫§Âà†Èô§ÔºåÂΩ¢Êàê\_1\_1.del
</span></span></span></code></pre></div><ul>
<li>
<ul>
<li>DelGen
<ul>
<li>.delÊñá‰ª∂ÁöÑÁâàÊú¨Âè∑</li>
<li>Lucene‰∏≠ÔºåÂú®optimize‰πãÂâçÔºåÂà†Èô§ÁöÑÊñáÊ°£ÊòØ‰øùÂ≠òÂú®.delÊñá‰ª∂‰∏≠ÁöÑ„ÄÇ</li>
<li>Âú®Lucene 2.9‰∏≠ÔºåÊñáÊ°£Âà†Èô§Êúâ‰ª•‰∏ãÂá†ÁßçÊñπÂºèÔºö
<ul>
<li>IndexReader.deleteDocument(int docID)ÊòØÁî®IndexReaderÊåâÊñáÊ°£Âè∑Âà†Èô§„ÄÇ</li>
<li>IndexReader.deleteDocuments(Term term)ÊòØÁî®IndexReaderÂà†Èô§ÂåÖÂê´Ê≠§ËØç(Term)ÁöÑÊñáÊ°£„ÄÇ</li>
<li>IndexWriter.deleteDocuments(Term term)ÊòØÁî®IndexWriterÂà†Èô§ÂåÖÂê´Ê≠§ËØç(Term)ÁöÑÊñáÊ°£„ÄÇ</li>
<li>IndexWriter.deleteDocuments(Term[] terms)ÊòØÁî®IndexWriterÂà†Èô§ÂåÖÂê´Ëøô‰∫õËØç(Term)ÁöÑÊñáÊ°£„ÄÇ</li>
<li>IndexWriter.deleteDocuments(Query query)ÊòØÁî®IndexWriterÂà†Èô§ËÉΩÊª°Ë∂≥Ê≠§Êü•ËØ¢(Query)ÁöÑÊñáÊ°£„ÄÇ</li>
<li>IndexWriter.deleteDocuments(Query[] queries)ÊòØÁî®IndexWriterÂà†Èô§ËÉΩÊª°Ë∂≥Ëøô‰∫õÊü•ËØ¢(Query)ÁöÑÊñáÊ°£„ÄÇ</li>
<li>ÂéüÊù•ÁöÑÁâàÊú¨‰∏≠LuceneÁöÑÂà†Èô§‰∏ÄÁõ¥ÊòØÁî±IndexReaderÊù•ÂÆåÊàêÁöÑÔºåÂú®Lucene 2.9‰∏≠ËôΩÂèØ‰ª•Áî®IndexWriterÊù•Âà†Èô§Ôºå‰ΩÜÊòØÂÖ∂ÂÆûÁúüÊ≠£ÁöÑÂÆûÁé∞ÊòØÂú®IndexWriter‰∏≠Ôºå‰øùÂ≠ò‰∫ÜreaderpoolÔºåÂΩìIndexWriterÂêëÁ¥¢ÂºïÊñá‰ª∂Êèê‰∫§Âà†Èô§ÁöÑÊó∂ÂÄôÔºå‰ªçÁÑ∂ÊòØ‰ªéreaderpool‰∏≠ÂæóÂà∞Áõ∏Â∫îÁöÑIndexReaderÔºåÂπ∂Áî®IndexReaderÊù•ËøõË°åÂà†Èô§ÁöÑ„ÄÇ‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÂèØ‰ª•ËØ¥ÊòéÔºö</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> IndexWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">applyDeletes</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">-&gt;</span> DocumentsWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">applyDeletes</span><span style="color:#f92672">(</span>SegmentInfos<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">-&gt;</span> reader<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteDocument</span><span style="color:#f92672">(</span>doc<span style="color:#f92672">);</span>
</span></span></code></pre></div><ul>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li>DelGenÊòØÊØèÂΩìIndexWriterÂêëÁ¥¢ÂºïÊñá‰ª∂‰∏≠Êèê‰∫§Âà†Èô§Êìç‰ΩúÁöÑÊó∂ÂÄôÔºåÂä†1ÔºåÂπ∂ÁîüÊàêÊñ∞ÁöÑ.delÊñá‰ª∂„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<ul>
<li>
<p>DocStoreOffset</p>
</li>
<li>
<p>DocStoreSegment</p>
</li>
<li>
<p>DocStoreIsCompoundFile</p>
<ul>
<li>ÂØπ‰∫éÂüü(Stored Field)ÂíåËØçÂêëÈáè(Term Vector)ÁöÑÂ≠òÂÇ®ÂèØ‰ª•Êúâ‰∏çÂêåÁöÑÊñπÂºèÔºåÂç≥ÂèØ‰ª•ÊØè‰∏™ÊÆµ(Segment)ÂçïÁã¨Â≠òÂÇ®Ëá™Â∑±ÁöÑÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÔºå‰πüÂèØ‰ª•Â§ö‰∏™ÊÆµÂÖ±‰∫´ÂüüÂíåËØçÂêëÈáèÔºåÊääÂÆÉ‰ª¨Â≠òÂÇ®Âà∞‰∏Ä‰∏™ÊÆµ‰∏≠Âéª„ÄÇ</li>
<li>Â¶ÇÊûúDocStoreOffset‰∏∫-1ÔºåÂàôÊ≠§ÊÆµÂçïÁã¨Â≠òÂÇ®Ëá™Â∑±ÁöÑÂüüÂíåËØçÂêëÈáèÔºå‰ªéÂ≠òÂÇ®Êñá‰ª∂‰∏äÊù•ÁúãÔºåÂ¶ÇÊûúÊ≠§ÊÆµÊÆµÂêç‰∏∫XXXÔºåÂàôÊ≠§ÊÆµÊúâËá™Â∑±ÁöÑXXX.fdtÔºåXXX.fdxÔºåXXX.tvfÔºåXXX.tvdÔºåXXX.tvxÊñá‰ª∂„ÄÇDocStoreSegmentÂíåDocStoreIsCompoundFileÂú®Ê≠§Â§Ñ‰∏çË¢´‰øùÂ≠ò„ÄÇ</li>
<li>Â¶ÇÊûúDocStoreOffset‰∏ç‰∏∫-1ÔºåÂàôDocStoreSegment‰øùÂ≠ò‰∫ÜÂÖ±‰∫´ÁöÑÊÆµÁöÑÂêçÂ≠óÔºåÊØîÂ¶Ç‰∏∫YYYÔºåDocStoreOffsetÂàô‰∏∫Ê≠§ÊÆµÁöÑÂüüÂèäËØçÂêëÈáè‰ø°ÊÅØÂú®ÂÖ±‰∫´ÊÆµ‰∏≠ÁöÑÂÅèÁßªÈáè„ÄÇÂàôÊ≠§ÊÆµÊ≤°ÊúâËá™Â∑±ÁöÑXXX.fdtÔºåXXX.fdxÔºåXXX.tvfÔºåXXX.tvdÔºåXXX.tvxÊñá‰ª∂ÔºåËÄåÊòØÂ∞Ü‰ø°ÊÅØÂ≠òÊîæÂú®ÂÖ±‰∫´ÊÆµÁöÑYYY.fdtÔºåYYY.fdxÔºåYYY.tvfÔºåYYY.tvdÔºåYYY.tvxÊñá‰ª∂‰∏≠„ÄÇ</li>
<li>DocumentsWriter‰∏≠Êúâ‰∏§‰∏™ÊàêÂëòÂèòÈáèÔºöString segmentÊòØÂΩìÂâçÁ¥¢Âºï‰ø°ÊÅØÂ≠òÊîæÁöÑÊÆµÔºåString docStoreSegmentÊòØÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÂ≠òÂÇ®ÁöÑÊÆµ„ÄÇ‰∏§ËÄÖÂèØ‰ª•Áõ∏Âêå‰πüÂèØ‰ª•‰∏çÂêåÔºåÂÜ≥ÂÆö‰∫ÜÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÂ≠òÂÇ®Âú®Êú¨ÊÆµ‰∏≠ÔºåËøòÊòØÂíåÂÖ∂‰ªñÁöÑÊÆµÂÖ±‰∫´„ÄÇ</li>
<li>IndexWriter.flush(boolean triggerMerge, boolean flushDocStores, boolean flushDeletes)‰∏≠Á¨¨‰∫å‰∏™ÂèÇÊï∞flushDocStores‰ºöÂΩ±ÂìçÂà∞ÊòØÂê¶ÂçïÁã¨ÊàñÊòØÂÖ±‰∫´Â≠òÂÇ®„ÄÇÂÖ∂ÂÆûÊúÄÁªàÂΩ±ÂìçÁöÑÊòØDocumentsWriter.closeDocStore()„ÄÇÊØèÂΩìflushDocStores‰∏∫falseÊó∂ÔºåcloseDocStore‰∏çË¢´Ë∞ÉÁî®ÔºåËØ¥Êòé‰∏ãÊ¨°Ê∑ªÂä†Âà∞Á¥¢ÂºïÊñá‰ª∂‰∏≠ÁöÑÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÂêåÊ≠§Ê¨°ÂÖ±‰∫´‰∏Ä‰∏™ÊÆµÁöÑ„ÄÇÁõ¥Âà∞flushDocStores‰∏∫trueÁöÑÊó∂ÂÄôÔºåcloseDocStoreË¢´Ë∞ÉÁî®Ôºå‰ªéËÄå‰∏ãÊ¨°Ê∑ªÂä†Âà∞Á¥¢ÂºïÊñá‰ª∂‰∏≠ÁöÑÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÂ∞ÜË¢´‰øùÂ≠òÂú®‰∏Ä‰∏™Êñ∞ÁöÑÊÆµ‰∏≠Ôºå‰∏çÂêåÊ≠§Ê¨°ÂÖ±‰∫´‰∏Ä‰∏™ÊÆµ(Âú®ËøôÈáåÈúÄË¶ÅÊåáÂá∫ÁöÑÊòØLuceneÁöÑ‰∏Ä‰∏™ÂæàÂ•áÊÄ™ÁöÑÂÆûÁé∞ÔºåËôΩÁÑ∂‰∏ãÊ¨°ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØË¢´‰øùÂ≠òÂà∞Êñ∞ÁöÑÊÆµ‰∏≠ÔºåÁÑ∂ËÄåÊÆµÂêçÂç¥ÊòØËøôÊ¨°Ë¢´Á°ÆÂÆö‰∫ÜÁöÑÔºåÂú®initSegmentName‰∏≠ÂΩìdocStoreSegment == nullÊó∂ÔºåË¢´ÁΩÆ‰∏∫ÂΩìÂâçÁöÑsegmentÔºåËÄåÈùû‰∏ã‰∏Ä‰∏™Êñ∞ÁöÑsegmentÔºådocStoreSegment = segmentÔºå‰∫éÊòØ‰ºöÂá∫Áé∞Â¶Ç‰∏ãÈù¢ÁöÑ‰æãÂ≠êÁöÑÁé∞Ë±°)„ÄÇ</li>
<li>Â•ΩÂú®ÂÖ±‰∫´ÂüüÂíåËØçÂêëÈáèÂ≠òÂÇ®Âπ∂‰∏çÊòØÁªèÂ∏∏Ë¢´‰ΩøÁî®Âà∞ÔºåÂÆûÁé∞‰πüÊàñÊúâÁº∫Èô∑ÔºåÊöÇ‰∏îËß£ÈáäÂà∞Ê≠§„ÄÇ</li>
</ul>
<p>IndexWriter writer = new IndexWriter(FSDirectory.open(INDEX_DIR), new StandardAnalyzer(Version.LUCENE_CURRENT), true, IndexWriter.MaxFieldLength.LIMITED);<br>
writer.setUseCompoundFile(false);</p>
<p>indexDocs(writer, docDir);<br>
writer.flush();</p>
</li>
</ul>
</li>
</ul>
<p>//flushÁîüÊàêsegment &ldquo;_0&rdquo;ÔºåÂπ∂‰∏îflushÂáΩÊï∞‰∏≠ÔºåflushDocStoresËÆæ‰∏∫falseÔºå‰πüÂç≥‰∏ã‰∏™ÊÆµÂ∞ÜÂêåÊú¨ÊÆµÂÖ±‰∫´ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÔºåËøôÊó∂DocumentsWriter‰∏≠ÁöÑdocStoreSegment= &ldquo;_0&rdquo;„ÄÇ</p>
<pre><code>  indexDocs(writer, docDir);  
  writer.commit();
</code></pre>
<p>//commitÁîüÊàêsegment &ldquo;_1&rdquo;ÔºåÁî±‰∫é‰∏äÊ¨°flushDocStoresËÆæ‰∏∫falseÔºå‰∫éÊòØÊÆµ&quot;_1&quot;ÁöÑÂüü‰ª•ÂèäËØçÂêëÈáè‰ø°ÊÅØÊòØ‰øùÂ≠òÂú®&quot;_0&quot;‰∏≠ÁöÑÔºåÂú®Ëøô‰∏™Êó∂ÂàªÔºåÊÆµ&quot;_1&quot;Âπ∂‰∏çÁîüÊàêËá™Â∑±ÁöÑ&quot;_1.fdx&quot;Âíå&quot;_1.fdt&quot;„ÄÇÁÑ∂ËÄåÂú®commitÂáΩÊï∞‰∏≠ÔºåflushDocStoresËÆæ‰∏∫trueÔºå‰πüÂç≥‰∏ã‰∏™ÊÆµÂ∞ÜÂçïÁã¨‰ΩøÁî®Êñ∞ÁöÑÊÆµÊù•Â≠òÂÇ®ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØ„ÄÇÁÑ∂ËÄåËøôÊó∂ÔºåDocumentsWriter‰∏≠ÁöÑdocStoreSegment= &ldquo;_1&rdquo;Ôºå‰πüÂç≥ÂΩìÊÆµ&quot;_2&quot;Â≠òÂÇ®ÂÖ∂ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÁöÑÊó∂ÂÄôÔºåÊòØÂ≠òÂú®&quot;_1.fdx&quot;Âíå&quot;_1.fdt&quot;‰∏≠ÁöÑÔºåËÄåÊÆµ&quot;_1&quot;ÁöÑÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÂç¥ÊòØÂ≠òÂú®&quot;_0.fdt&quot;Âíå&quot;_0.fdx&quot;‰∏≠ÁöÑÔºåËøô‰∏ÄÁÇπÈùûÂ∏∏‰ª§‰∫∫Âõ∞ÊÉë„ÄÇ Â¶ÇÂõæwriter.commitÁöÑÊó∂ÂÄôÔºå_1.fdtÂíå_1.fdxÂπ∂Ê≤°ÊúâÂΩ¢Êàê„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022114233.png"
	
	
	
	loading="lazy"
	
	
></p>
<pre><code>  indexDocs(writer, docDir);  
  writer.flush();
</code></pre>
<p>//ÊÆµ&quot;_2&quot;ÂΩ¢ÊàêÔºåÁî±‰∫é‰∏äÊ¨°flushDocStoresËÆæ‰∏∫trueÔºåÂÖ∂ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÊñ∞ÂàõÂª∫‰∏Ä‰∏™ÊÆµ‰øùÂ≠òÁöÑÔºåÂç¥ÊòØ‰øùÂ≠òÂú®_1.fdtÂíå_1.fdx‰∏≠ÁöÑÔºåËøôÊó∂ÂÄôÊâç‰∫ßÁîü‰∫ÜÊ≠§‰∫åÊñá‰ª∂„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022115773.png"
	
	
	
	loading="lazy"
	
	
></p>
<pre><code>  indexDocs(writer, docDir);  
  writer.flush();
</code></pre>
<p>//ÊÆµ&quot;_3&quot;ÂΩ¢ÊàêÔºåÁî±‰∫é‰∏äÊ¨°flushDocStoresËÆæ‰∏∫falseÔºåÂÖ∂ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÂÖ±‰∫´‰∏Ä‰∏™ÊÆµ‰øùÂ≠òÁöÑÔºå‰πüÊòØÊòØ‰øùÂ≠òÂú®_1.fdtÂíå_1.fdx‰∏≠ÁöÑ</p>
<pre><code>  indexDocs(writer, docDir);  
  writer.commit();
</code></pre>
<p>//ÊÆµ&quot;_4&quot;ÂΩ¢ÊàêÔºåÁî±‰∫é‰∏äÊ¨°flushDocStoresËÆæ‰∏∫falseÔºåÂÖ∂ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÂÖ±‰∫´‰∏Ä‰∏™ÊÆµ‰øùÂ≠òÁöÑÔºå‰πüÊòØÊòØ‰øùÂ≠òÂú®_1.fdtÂíå_1.fdx‰∏≠ÁöÑ„ÄÇÁÑ∂ËÄåÂáΩÊï∞commit‰∏≠flushDocStoresËÆæ‰∏∫trueÔºå‰πüÊÑèÂë≥ÁùÄ‰∏ã‰∏Ä‰∏™ÊÆµÂ∞ÜÊñ∞ÂàõÂª∫‰∏Ä‰∏™ÊÆµ‰øùÂ≠òÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÔºåÊ≠§Êó∂DocumentsWriter‰∏≠docStoreSegment= &ldquo;_4&rdquo;Ôºå‰πüË°®Êòé‰∫ÜËôΩÁÑ∂ÊÆµ&quot;_4&quot;ÁöÑÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØ‰øùÂ≠òÂú®‰∫ÜÊÆµ&quot;_1&quot;‰∏≠ÔºåÂ∞ÜÊù•ÁöÑÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÂç¥Ë¶Å‰øùÂ≠òÂú®ÊÆµ&quot;_4&quot;‰∏≠„ÄÇÊ≠§Êó∂&quot;_4.fdx&quot;Âíå&quot;_4.fdt&quot;Â∞öÊú™‰∫ßÁîü„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022115627.png"
	
	
	
	loading="lazy"
	
	
></p>
<pre><code>  indexDocs(writer, docDir);  
  writer.flush();
</code></pre>
<p>//ÊÆµ&quot;_5&quot;ÂΩ¢ÊàêÔºåÁî±‰∫é‰∏äÊ¨°flushDocStoresËÆæ‰∏∫trueÔºåÂÖ∂ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÊñ∞ÂàõÂª∫‰∏Ä‰∏™ÊÆµ‰øùÂ≠òÁöÑÔºåÂç¥ÊòØ‰øùÂ≠òÂú®_4.fdtÂíå_4.fdx‰∏≠ÁöÑÔºåËøôÊó∂ÂÄôÊâç‰∫ßÁîü‰∫ÜÊ≠§‰∫åÊñá‰ª∂„ÄÇ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022116165.png"
	
	
	
	loading="lazy"
	
	
></p>
<pre><code>  indexDocs(writer, docDir);  
  writer.commit();  
  writer.close();
</code></pre>
<p>//ÊÆµ&quot;_6&quot;ÂΩ¢ÊàêÔºåÁî±‰∫é‰∏äÊ¨°flushDocStoresËÆæ‰∏∫falseÔºåÂÖ∂ÂüüÂíåËØçÂêëÈáè‰ø°ÊÅØÊòØÂÖ±‰∫´‰∏Ä‰∏™ÊÆµ‰øùÂ≠òÁöÑÔºå‰πüÊòØÊòØ‰øùÂ≠òÂú®_4.fdtÂíå_4.fdx‰∏≠ÁöÑ</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022116777.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>
<ul>
<li>HasSingleNormFile
<ul>
<li>Âú®ÊêúÁ¥¢ÁöÑËøáÁ®ã‰∏≠ÔºåÊ†áÂáÜÂåñÂõ†Â≠ê(Normalization Factor)‰ºöÂΩ±ÂìçÊñáÊ°£ÊúÄÂêéÁöÑËØÑÂàÜ„ÄÇ</li>
<li>‰∏çÂêåÁöÑÊñáÊ°£ÈáçË¶ÅÊÄß‰∏çÂêåÔºå‰∏çÂêåÁöÑÂüüÈáçË¶ÅÊÄß‰πü‰∏çÂêå„ÄÇÂõ†ËÄåÊØè‰∏™ÊñáÊ°£ÁöÑÊØè‰∏™ÂüüÈÉΩÂèØ‰ª•ÊúâËá™Â∑±ÁöÑÊ†áÂáÜÂåñÂõ†Â≠ê„ÄÇ</li>
<li>Â¶ÇÊûúHasSingleNormFile‰∏∫1ÔºåÂàôÊâÄÊúâÁöÑÊ†áÂáÜÂåñÂõ†Â≠êÈÉΩÊòØÂ≠òÂú®.nrmÊñá‰ª∂‰∏≠ÁöÑ„ÄÇ</li>
<li>Â¶ÇÊûúHasSingleNormFile‰∏çÊòØ1ÔºåÂàôÊØè‰∏™ÂüüÈÉΩÊúâËá™Â∑±ÁöÑÊ†áÂáÜÂåñÂõ†Â≠êÊñá‰ª∂.fN</li>
</ul>
</li>
<li>NumField
<ul>
<li>ÂüüÁöÑÊï∞Èáè</li>
</ul>
</li>
<li>NormGen
<ul>
<li>Â¶ÇÊûúÊØè‰∏™ÂüüÊúâËá™Â∑±ÁöÑÊ†áÂáÜÂåñÂõ†Â≠êÊñá‰ª∂ÔºåÂàôÊ≠§Êï∞ÁªÑÊèèËø∞‰∫ÜÊØè‰∏™Ê†áÂáÜÂåñÂõ†Â≠êÊñá‰ª∂ÁöÑÁâàÊú¨Âè∑Ôºå‰πüÂç≥.fNÁöÑN„ÄÇ</li>
</ul>
</li>
<li>IsCompoundFile
<ul>
<li>ÊòØÂê¶‰øùÂ≠ò‰∏∫Â§çÂêàÊñá‰ª∂Ôºå‰πüÂç≥ÊääÂêå‰∏Ä‰∏™ÊÆµ‰∏≠ÁöÑÊñá‰ª∂ÊåâÁÖß‰∏ÄÂÆöÊ†ºÂºèÔºå‰øùÂ≠òÂú®‰∏Ä‰∏™Êñá‰ª∂ÂΩì‰∏≠ÔºåËøôÊ†∑ÂèØ‰ª•ÂáèÂ∞ëÊØèÊ¨°ÊâìÂºÄÊñá‰ª∂ÁöÑ‰∏™Êï∞„ÄÇ</li>
<li>ÊòØÂê¶‰∏∫Â§çÂêàÊñá‰ª∂ÔºåÁî±Êé•Âè£IndexWriter.setUseCompoundFile(boolean)ËÆæÂÆö„ÄÇ</li>
<li>ÈùûÁ¨¶ÂêàÊñá‰ª∂ÂêåÁ¨¶ÂêàÊñá‰ª∂ÁöÑÂØπÊØîÂ¶Ç‰∏ãÂõæÔºö</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>DeletionCount
<ul>
<li>ËÆ∞ÂΩï‰∫ÜÊ≠§ÊÆµ‰∏≠Âà†Èô§ÁöÑÊñáÊ°£ÁöÑÊï∞ÁõÆ„ÄÇ</li>
</ul>
</li>
<li>HasProx
<ul>
<li>Â¶ÇÊûúËá≥Â∞ëÊúâ‰∏Ä‰∏™ÊÆµomitTf‰∏∫falseÔºå‰πüÂç≥ËØçÈ¢ë(term freqency)ÈúÄË¶ÅË¢´‰øùÂ≠òÔºåÂàôHasProx‰∏∫1ÔºåÂê¶Âàô‰∏∫0„ÄÇ</li>
</ul>
</li>
<li>Diagnostics
<ul>
<li>Ë∞ÉËØï‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li>
<p>User map data</p>
<ul>
<li>‰øùÂ≠ò‰∫ÜÁî®Êà∑‰ªéÂ≠óÁ¨¶‰∏≤Âà∞Â≠óÁ¨¶‰∏≤ÁöÑÊò†Â∞ÑMap</li>
</ul>
</li>
<li>
<p>CheckSum</p>
<ul>
<li>Ê≠§Êñá‰ª∂segment_NÁöÑÊ†°È™åÂíå„ÄÇ</li>
</ul>
</li>
</ul>
<p>ËØªÂèñÊ≠§Êñá‰ª∂Ê†ºÂºèÂèÇËÄÉSegmentInfos.read(Directory directory, String segmentFileName):</p>
<ul>
<li>
<p>int format = input.readInt();</p>
</li>
<li>
<p>version = input.readLong(); // read version</p>
</li>
<li>
<p>counter = input.readInt(); // read counter</p>
</li>
<li>
<p>for (int i = input.readInt(); i &gt; 0; i&ndash;) // read segmentInfos</p>
<ul>
<li>add(new SegmentInfo(directory, format, input));
<ul>
<li>name = input.readString();</li>
<li>docCount = input.readInt();</li>
<li>delGen = input.readLong();</li>
<li>docStoreOffset = input.readInt();</li>
<li>docStoreSegment = input.readString();</li>
<li>docStoreIsCompoundFile = (1 == input.readByte());</li>
<li>hasSingleNormFile = (1 == input.readByte());</li>
<li>int numNormGen = input.readInt();</li>
<li>normGen = new long[numNormGen];</li>
<li>for(int j=0;j</li>
<li>normGen[j] = input.readLong();</li>
</ul>
</li>
<li>isCompoundFile = input.readByte();</li>
<li>delCount = input.readInt();</li>
<li>hasProx = input.readByte() == 1;</li>
<li>diagnostics = input.readStringStringMap();</li>
</ul>
</li>
<li>
<p>userData = input.readStringStringMap();</p>
</li>
<li>
<p>final long checksumNow = input.getChecksum();</p>
</li>
<li>
<p>final long checksumThen = input.readLong();</p>
</li>
</ul>
<h4 id="412-ÂüüfieldÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØfnm"><strong>4.1.2. Âüü(Field)ÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ(.fnm)</strong></h4>
<p>‰∏Ä‰∏™ÊÆµ(Segment)ÂåÖÂê´Â§ö‰∏™ÂüüÔºåÊØè‰∏™ÂüüÈÉΩÊúâ‰∏Ä‰∫õÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºå‰øùÂ≠òÂú®.fnmÊñá‰ª∂‰∏≠Ôºå.fnmÊñá‰ª∂ÁöÑÊ†ºÂºèÂ¶Ç‰∏ãÔºö</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022117877.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>FNMVersion
<ul>
<li>ÊòØfnmÊñá‰ª∂ÁöÑÁâàÊú¨Âè∑ÔºåÂØπ‰∫éLucene 2.9‰∏∫-2</li>
</ul>
</li>
<li>FieldsCount
<ul>
<li>ÂüüÁöÑÊï∞ÁõÆ</li>
</ul>
</li>
<li>‰∏Ä‰∏™Êï∞ÁªÑÁöÑÂüü(Fields)
<ul>
<li>FieldNameÔºöÂüüÂêçÔºåÂ¶Ç&quot;title&quot;Ôºå&ldquo;modified&rdquo;Ôºå&ldquo;content&quot;Á≠â„ÄÇ</li>
<li>FieldBits:‰∏ÄÁ≥ªÂàóÊ†áÂøó‰ΩçÔºåË°®ÊòéÂØπÊ≠§ÂüüÁöÑÁ¥¢ÂºïÊñπÂºè
<ul>
<li>ÊúÄ‰Ωé‰ΩçÔºö1Ë°®Á§∫Ê≠§ÂüüË¢´Á¥¢ÂºïÔºå0Âàô‰∏çË¢´Á¥¢Âºï„ÄÇÊâÄË∞ìË¢´Á¥¢ÂºïÔºå‰πüÂç≥ÊîæÂà∞ÂÄíÊéíË°®‰∏≠Âéª„ÄÇ
<ul>
<li>‰ªÖ‰ªÖË¢´Á¥¢ÂºïÁöÑÂüüÊâçËÉΩÂ§üË¢´ÊêúÂà∞„ÄÇ</li>
<li>Field.Index.NOÂàôË°®Á§∫‰∏çË¢´Á¥¢Âºï„ÄÇ</li>
<li>Field.Index.ANALYZEDÂàôË°®Á§∫‰∏ç‰ΩÜË¢´Á¥¢ÂºïÔºåËÄå‰∏îË¢´ÂàÜËØçÔºåÊØîÂ¶ÇÁ¥¢Âºï&quot;hello world&quot;ÂêéÔºåÊó†ËÆ∫ÊòØÊêú&quot;hello&rdquo;ÔºåËøòÊòØÊêú&quot;world&quot;ÈÉΩËÉΩÂ§üË¢´ÊêúÂà∞„ÄÇ</li>
<li>Field.Index.NOT_ANALYZEDË°®Á§∫ËôΩÁÑ∂Ë¢´Á¥¢ÂºïÔºå‰ΩÜÊòØ‰∏çÂàÜËØçÔºåÊØîÂ¶ÇÁ¥¢Âºï&quot;hello world&quot;ÂêéÔºå‰ªÖÂΩìÊêú&quot;hello world&quot;Êó∂ÔºåËÉΩÂ§üÊêúÂà∞ÔºåÊêú&quot;hello&quot;ÂíåÊêú&quot;world&quot;ÈÉΩÊêú‰∏çÂà∞„ÄÇ</li>
<li>‰∏Ä‰∏™ÂüüÂá∫‰∫ÜËÉΩÂ§üË¢´Á¥¢ÂºïÔºåËøòËÉΩÂ§üË¢´Â≠òÂÇ®Ôºå‰ªÖ‰ªÖË¢´Â≠òÂÇ®ÁöÑÂüüÊòØÊêúÁ¥¢‰∏çÂà∞ÁöÑÔºå‰ΩÜÊòØËÉΩÈÄöËøáÊñáÊ°£Âè∑Êü•Âà∞ÔºåÂ§öÁî®‰∫é‰∏çÊÉ≥Ë¢´ÊêúÁ¥¢Âà∞Ôºå‰ΩÜÊòØÂú®ÈÄöËøáÂÖ∂ÂÆÉÂüüËÉΩÂ§üÊêúÁ¥¢Âà∞ÁöÑÊÉÖÂÜµ‰∏ãÔºåËÉΩÂ§üÈöèÁùÄÊñáÊ°£Âè∑ËøîÂõûÁªôÁî®Êà∑ÁöÑÂüü„ÄÇ</li>
<li>Field.Store.YesÂàôË°®Á§∫Â≠òÂÇ®Ê≠§ÂüüÔºåField.Store.NOÂàôË°®Á§∫‰∏çÂ≠òÂÇ®Ê≠§Âüü„ÄÇ</li>
</ul>
</li>
<li>ÂÄíÊï∞Á¨¨‰∫å‰ΩçÔºö1Ë°®Á§∫‰øùÂ≠òËØçÂêëÈáèÔºå0‰∏∫‰∏ç‰øùÂ≠òËØçÂêëÈáè„ÄÇ
<ul>
<li>Field.TermVector.YESË°®Á§∫‰øùÂ≠òËØçÂêëÈáè„ÄÇ</li>
<li>Field.TermVector.NOË°®Á§∫‰∏ç‰øùÂ≠òËØçÂêëÈáè„ÄÇ</li>
</ul>
</li>
<li>ÂÄíÊï∞Á¨¨‰∏â‰ΩçÔºö1Ë°®Á§∫Âú®ËØçÂêëÈáè‰∏≠‰øùÂ≠ò‰ΩçÁΩÆ‰ø°ÊÅØ„ÄÇ
<ul>
<li>Field.TermVector.WITH_POSITIONS</li>
</ul>
</li>
<li>ÂÄíÊï∞Á¨¨Âõõ‰ΩçÔºö1Ë°®Á§∫Âú®ËØçÂêëÈáè‰∏≠‰øùÂ≠òÂÅèÁßªÈáè‰ø°ÊÅØ„ÄÇ
<ul>
<li>Field.TermVector.WITH_OFFSETS</li>
</ul>
</li>
<li>ÂÄíÊï∞Á¨¨‰∫î‰ΩçÔºö1Ë°®Á§∫‰∏ç‰øùÂ≠òÊ†áÂáÜÂåñÂõ†Â≠ê
<ul>
<li>Field.Index.ANALYZED_NO_NORMS</li>
<li>Field.Index.NOT_ANALYZED_NO_NORMS</li>
</ul>
</li>
<li>ÂÄíÊï∞Á¨¨ÂÖ≠‰ΩçÔºöÊòØÂê¶‰øùÂ≠òpayload</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Ë¶Å‰∫ÜËß£ÂüüÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºåËøòË¶Å‰∫ÜËß£‰ª•‰∏ãÂá†ÁÇπÔºö</p>
<ul>
<li>‰ΩçÁΩÆ(Position)ÂíåÂÅèÁßªÈáè(Offset)ÁöÑÂå∫Âà´
<ul>
<li>‰ΩçÁΩÆÊòØÂü∫‰∫éËØçTermÁöÑÔºåÂÅèÁßªÈáèÊòØÂü∫‰∫éÂ≠óÊØçÊàñÊ±âÂ≠óÁöÑ„ÄÇ</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022117067.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>Á¥¢ÂºïÂüü(Indexed)ÂíåÂ≠òÂÇ®Âüü(Stored)ÁöÑÂå∫Âà´
<ul>
<li>‰∏Ä‰∏™Âüü‰∏∫‰ªÄ‰πà‰ºöË¢´Â≠òÂÇ®(store)ËÄå‰∏çË¢´Á¥¢Âºï(Index)Âë¢ÔºüÂú®‰∏Ä‰∏™ÊñáÊ°£‰∏≠ÁöÑÊâÄÊúâ‰ø°ÊÅØ‰∏≠ÔºåÊúâËøôÊ†∑‰∏ÄÈÉ®ÂàÜ‰ø°ÊÅØÔºåÂèØËÉΩ‰∏çÊÉ≥Ë¢´Á¥¢Âºï‰ªéËÄåÂèØ‰ª•ÊêúÁ¥¢Âà∞Ôºå‰ΩÜÊòØÂΩìËøô‰∏™ÊñáÊ°£Áî±‰∫éÂÖ∂‰ªñÁöÑ‰ø°ÊÅØË¢´ÊêúÁ¥¢Âà∞Êó∂ÔºåÂèØ‰ª•ÂêåÂÖ∂‰ªñ‰ø°ÊÅØ‰∏ÄÂêåËøîÂõû„ÄÇ</li>
<li>‰∏æ‰∏™‰æãÂ≠êÔºåËØªÁ†îÁ©∂ÁîüÊó∂ÔºåÊÇ®Â•Ω‰∏çÂÆπÊòìÂÜô‰∫Ü‰∏ÄÁØáËÆ∫Êñá‰∫§ÁªôÊÇ®ÁöÑÂØºÂ∏àÔºåÊÇ®ÁöÑÂØºÂ∏àÂç¥Ë¶Å‰ªñÊâÄÁ¨¨‰∏Ä‰ΩúËÄÖËÄåÊÇ®ÂÅöÁ¨¨‰∫å‰ΩúËÄÖÔºåÁÑ∂ËÄåÊÇ®ÂØºÂ∏à‰∏çÊÉ≥Âà´‰∫∫Âú®ËÆ∫ÊñáÁ≥ªÁªü‰∏≠ÊêúÁ¥¢ÊÇ®ÁöÑÂêçÂ≠óÊó∂ÊâæÂà∞ËøôÁØáËÆ∫ÊñáÔºå‰∫éÊòØÂú®ËÆ∫ÊñáÁ≥ªÁªü‰∏≠ÔºåÊääÁ¨¨‰∫å‰ΩúËÄÖËøô‰∏™FieldÁöÑIndexedËÆæ‰∏∫falseÔºåËøôÊ†∑Âà´‰∫∫ÊêúÁ¥¢ÊÇ®ÁöÑÂêçÂ≠óÔºåÊ∞∏Ëøú‰∏çÁü•ÈÅìÊÇ®ÂÜôËøáËøôÁØáËÆ∫ÊñáÔºåÂè™ÊúâÂú®Âà´‰∫∫ÊêúÁ¥¢ÊÇ®ÂØºÂ∏àÁöÑÂêçÂ≠ó‰ªéËÄåÊâæÂà∞ÊÇ®ÁöÑÊñáÁ´†Êó∂ÔºåÂú®‰∏Ä‰∏™ËßíËêΩË°®Ëø∞ÁùÄÁ¨¨‰∫å‰ΩúËÄÖÊòØÊÇ®„ÄÇ</li>
</ul>
</li>
<li>payloadÁöÑ‰ΩøÁî®
<ul>
<li>Êàë‰ª¨Áü•ÈÅìÔºåÁ¥¢ÂºïÊòØ‰ª•ÂÄíÊéíË°®ÂΩ¢ÂºèÂ≠òÂÇ®ÁöÑÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™ËØçÔºåÈÉΩ‰øùÂ≠ò‰∫ÜÂåÖÂê´Ëøô‰∏™ËØçÁöÑ‰∏Ä‰∏™ÈìæË°®ÔºåÂΩìÁÑ∂‰∏∫‰∫ÜÂä†Âø´Êü•ËØ¢ÈÄüÂ∫¶ÔºåÊ≠§ÈìæË°®Â§öÁî®Ë∑≥Ë∑ÉË°®ËøõË°åÂ≠òÂÇ®„ÄÇ</li>
<li>Payload‰ø°ÊÅØÂ∞±ÊòØÂ≠òÂÇ®Âú®ÂÄíÊéíË°®‰∏≠ÁöÑÔºåÂêåÊñáÊ°£Âè∑‰∏ÄËµ∑Â≠òÊîæÔºåÂ§öÁî®‰∫éÂ≠òÂÇ®‰∏éÊØèÁØáÊñáÊ°£Áõ∏ÂÖ≥ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØ„ÄÇÂΩìÁÑ∂ËøôÈÉ®ÂàÜ‰ø°ÊÅØ‰πüÂèØ‰ª•Â≠òÂÇ®ÂüüÈáå(stored Field)Ôºå‰∏§ËÄÖ‰ªéÂäüËÉΩ‰∏äÂü∫Êú¨ÊòØ‰∏ÄÊ†∑ÁöÑÔºåÁÑ∂ËÄåÂΩìË¶ÅÂ≠òÂÇ®ÁöÑ‰ø°ÊÅØÂæàÂ§öÁöÑÊó∂ÂÄôÔºåÂ≠òÊîæÂú®ÂÄíÊéíË°®ÈáåÔºåÂà©Áî®Ë∑≥Ë∑ÉË°®ÔºåÊúâÂà©‰∫éÂ§ßÂ§ßÊèêÈ´òÊêúÁ¥¢ÈÄüÂ∫¶„ÄÇ</li>
<li>PayloadÁöÑÂ≠òÂÇ®ÊñπÂºèÂ¶Ç‰∏ãÂõæÔºö</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022122309.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>
<ul>
<li>Payload‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂá†ÁßçÁî®Ê≥ïÔºö
<ul>
<li>Â≠òÂÇ®ÊØè‰∏™ÊñáÊ°£ÈÉΩÊúâÁöÑ‰ø°ÊÅØÔºöÊØîÂ¶ÇÊúâÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨ÊÉ≥ÁªôÊØè‰∏™ÊñáÊ°£Ëµã‰∏Ä‰∏™Êàë‰ª¨Ëá™Â∑±ÁöÑÊñáÊ°£Âè∑ÔºåËÄå‰∏çÊòØÁî®LuceneËá™Â∑±ÁöÑÊñáÊ°£Âè∑„ÄÇ‰∫éÊòØÊàë‰ª¨ÂèØ‰ª•Â£∞Êòé‰∏Ä‰∏™ÁâπÊÆäÁöÑÂüü(Field)&quot;_ID&quot;ÂíåÁâπÊÆäÁöÑËØç(Term)&quot;_ID&quot;Ôºå‰ΩøÂæóÊØèÁØáÊñáÊ°£ÈÉΩÂåÖÂê´ËØç&quot;_ID&quot;Ôºå‰∫éÊòØÂú®ËØç&quot;_ID&quot;ÁöÑÂÄíÊéíË°®ÈáåÈù¢ÂØπ‰∫éÊØèÁØáÊñáÊ°£ÂèàÊúâ‰∏ÄÈ°πÔºåÊØè‰∏ÄÈ°πÈÉΩÊúâ‰∏Ä‰∏™payloadÔºå‰∫éÊòØÊàë‰ª¨ÂèØ‰ª•Âú®payloadÈáåÈù¢‰øùÂ≠òÊàë‰ª¨Ëá™Â∑±ÁöÑÊñáÊ°£Âè∑„ÄÇÊØèÂΩìÊàë‰ª¨ÂæóÂà∞‰∏Ä‰∏™LuceneÁöÑÊñáÊ°£Âè∑ÁöÑÊó∂ÂÄôÔºåÂ∞±ËÉΩ‰ªéË∑≥Ë∑ÉË°®‰∏≠Êü•ÊâæÂà∞Êàë‰ª¨Ëá™Â∑±ÁöÑÊñáÊ°£Âè∑„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>//Â£∞Êòé‰∏Ä‰∏™ÁâπÊÆäÁöÑÂüüÂíåÁâπÊÆäÁöÑËØç</p>
<p>public static final String ID_PAYLOAD_FIELD = &ldquo;_ID&rdquo;;</p>
<p>public static final String ID_PAYLOAD_TERM = &ldquo;_ID&rdquo;;</p>
<p>public static final Term ID_TERM = new Term(ID_PAYLOAD_TERM, ID_PAYLOAD_FIELD);</p>
<p>//Â£∞Êòé‰∏Ä‰∏™ÁâπÊÆäÁöÑTokenStreamÔºåÂÆÉÂè™ÁîüÊàê‰∏Ä‰∏™ËØç(Term)ÔºåÂ∞±ÊòØÈÇ£‰∏™ÁâπÊÆäÁöÑËØçÔºåÂú®ÁâπÊÆäÁöÑÂüüÈáåÈù¢„ÄÇ</p>
<p>static class SinglePayloadTokenStream extends TokenStream {<br>
private Token token;<br>
private boolean returnToken = false;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>SinglePayloadTokenStream<span style="color:#f92672">(</span>String idPayloadTerm<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> term <span style="color:#f92672">=</span> idPayloadTerm<span style="color:#f92672">.</span><span style="color:#a6e22e">toCharArray</span><span style="color:#f92672">();</span>  
</span></span><span style="display:flex;"><span>    token <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Token<span style="color:#f92672">(</span>term<span style="color:#f92672">,</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">,</span> term<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">,</span> term<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setPayloadValue</span><span style="color:#f92672">(</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>    token<span style="color:#f92672">.</span><span style="color:#a6e22e">setPayload</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Payload<span style="color:#f92672">(</span>value<span style="color:#f92672">));</span>  
</span></span><span style="display:flex;"><span>    returnToken <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> Token <span style="color:#a6e22e">next</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>returnToken<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>        returnToken <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> token<span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>  
</span></span></code></pre></div><p>}</p>
<p>//ÂØπ‰∫éÊØè‰∏ÄÁØáÊñáÊ°£ÔºåÈÉΩËÆ©ÂÆÉÂåÖÂê´Ëøô‰∏™ÁâπÊÆäÁöÑËØçÔºåÂú®ÁâπÊÆäÁöÑÂüüÈáåÈù¢</p>
<p>SinglePayloadTokenStream singlePayloadTokenStream = new SinglePayloadTokenStream(ID_PAYLOAD_TERM);<br>
singlePayloadTokenStream.setPayloadValue(long2bytes(id));<br>
doc.add(new Field(ID_PAYLOAD_FIELD, singlePayloadTokenStream));</p>
<p>//ÊØèÂΩìÂæóÂà∞‰∏Ä‰∏™LuceneÁöÑÊñáÊ°£Âè∑Êó∂ÔºåÈÄöËøá‰ª•‰∏ãÁöÑÊñπÂºèÂæóÂà∞payloadÈáåÈù¢ÁöÑÊñáÊ°£Âè∑</p>
<p>long id = 0;<br>
TermPositions tp = reader.termPositions(ID_PAYLOAD_TERM);<br>
boolean ret = tp.skipTo(docID);<br>
tp.nextPosition();<br>
int payloadlength = tp.getPayloadLength();<br>
byte[] payloadBuffer = new byte[payloadlength];<br>
tp.getPayload(payloadBuffer, 0);<br>
id = bytes2long(payloadBuffer);<br>
tp.close();</p>
<ul>
<li>
<ul>
<li>
<ul>
<li>ÂΩ±ÂìçËØçÁöÑËØÑÂàÜ
<ul>
<li>Âú®SimilarityÊäΩË±°Á±ª‰∏≠ÊúâÂáΩÊï∞public float scorePayload(byte [] payload, int offset, int length)  ÂèØ‰ª•Ê†πÊçÆpayloadÁöÑÂÄºÂΩ±ÂìçËØÑÂàÜ„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>ËØªÂèñÂüüÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</li>
</ul>
<p>FieldInfos.read(IndexInput, String)</p>
<ul>
<li>int firstInt = input.readVInt();</li>
<li>size = input.readVInt();</li>
<li>for (int i = 0; i &lt; size; i++)
<ul>
<li>String name = input.readString();</li>
<li>byte bits = input.readByte();</li>
<li>boolean isIndexed = (bits &amp; IS_INDEXED) != 0;</li>
<li>boolean storeTermVector = (bits &amp; STORE_TERMVECTOR) != 0;</li>
<li>boolean storePositionsWithTermVector = (bits &amp; STORE_POSITIONS_WITH_TERMVECTOR) != 0;</li>
<li>boolean storeOffsetWithTermVector = (bits &amp; STORE_OFFSET_WITH_TERMVECTOR) != 0;</li>
<li>boolean omitNorms = (bits &amp; OMIT_NORMS) != 0;</li>
<li>boolean storePayloads = (bits &amp; STORE_PAYLOADS) != 0;</li>
<li>boolean omitTermFreqAndPositions = (bits &amp; OMIT_TERM_FREQ_AND_POSITIONS) != 0;</li>
</ul>
</li>
</ul>
<h4 id="413-ÂüüfieldÁöÑÊï∞ÊçÆ‰ø°ÊÅØfdtfdx"><strong>4.1.3. Âüü(Field)ÁöÑÊï∞ÊçÆ‰ø°ÊÅØ(.fdtÔºå.fdx)</strong></h4>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022125684.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÂüüÊï∞ÊçÆÊñá‰ª∂(fdt):
<ul>
<li>ÁúüÊ≠£‰øùÂ≠òÂ≠òÂÇ®Âüü(stored field)‰ø°ÊÅØÁöÑÊòØfdtÊñá‰ª∂</li>
<li>Âú®‰∏Ä‰∏™ÊÆµ(segment)‰∏≠ÊÄªÂÖ±Êúâsegment sizeÁØáÊñáÊ°£ÔºåÊâÄ‰ª•fdtÊñá‰ª∂‰∏≠ÂÖ±Êúâsegment size‰∏™È°πÔºåÊØè‰∏ÄÈ°π‰øùÂ≠ò‰∏ÄÁØáÊñáÊ°£ÁöÑÂüüÁöÑ‰ø°ÊÅØ</li>
<li>ÂØπ‰∫éÊØè‰∏ÄÁØáÊñáÊ°£Ôºå‰∏ÄÂºÄÂßãÊòØ‰∏Ä‰∏™fieldcountÔºå‰πüÂç≥Ê≠§ÊñáÊ°£ÂåÖÂê´ÁöÑÂüüÁöÑÊï∞ÁõÆÔºåÊé•‰∏ãÊù•ÊòØfieldcount‰∏™È°πÔºåÊØè‰∏ÄÈ°π‰øùÂ≠ò‰∏Ä‰∏™ÂüüÁöÑ‰ø°ÊÅØ„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏Ä‰∏™ÂüüÔºåfieldnumÊòØÂüüÂè∑ÔºåÊé•ÁùÄÊòØ‰∏Ä‰∏™8‰ΩçÁöÑbyteÔºåÊúÄ‰Ωé‰∏Ä‰ΩçË°®Á§∫Ê≠§ÂüüÊòØÂê¶ÂàÜËØç(tokenized)ÔºåÂÄíÊï∞Á¨¨‰∫å‰ΩçË°®Á§∫Ê≠§ÂüüÊòØ‰øùÂ≠òÂ≠óÁ¨¶‰∏≤Êï∞ÊçÆËøòÊòØ‰∫åËøõÂà∂Êï∞ÊçÆÔºåÂÄíÊï∞Á¨¨‰∏â‰ΩçË°®Á§∫Ê≠§ÂüüÊòØÂê¶Ë¢´ÂéãÁº©ÔºåÂÜçÊé•‰∏ãÊù•Â∞±ÊòØÂ≠òÂÇ®ÂüüÁöÑÂÄºÔºåÊØîÂ¶Çnew Field(&ldquo;title&rdquo;, &ldquo;lucene in action&rdquo;, Field.Store.Yes, ‚Ä¶)ÔºåÂàôÊ≠§Â§ÑÂ≠òÊîæÁöÑÂ∞±ÊòØ&quot;lucene in action&quot;Ëøô‰∏™Â≠óÁ¨¶‰∏≤„ÄÇ</li>
</ul>
</li>
<li>ÂüüÁ¥¢ÂºïÊñá‰ª∂(fdx)
<ul>
<li>Áî±ÂüüÊï∞ÊçÆÊñá‰ª∂Ê†ºÂºèÊàë‰ª¨Áü•ÈÅìÔºåÊØèÁØáÊñáÊ°£ÂåÖÂê´ÁöÑÂüüÁöÑ‰∏™Êï∞ÔºåÊØè‰∏™Â≠òÂÇ®ÂüüÁöÑÂÄºÈÉΩÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºåÂõ†ËÄåÂüüÊï∞ÊçÆÊñá‰ª∂‰∏≠segment sizeÁØáÊñáÊ°£ÔºåÊØèÁØáÊñáÊ°£Âç†Áî®ÁöÑÂ§ßÂ∞è‰πüÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºåÈÇ£‰πàÂ¶Ç‰ΩïÂú®fdt‰∏≠Ëæ®Âà´ÊØè‰∏ÄÁØáÊñáÊ°£ÁöÑËµ∑ÂßãÂú∞ÂùÄÂíåÁªàÊ≠¢Âú∞ÂùÄÂë¢ÔºåÂ¶Ç‰ΩïËÉΩÂ§üÊõ¥Âø´ÁöÑÊâæÂà∞Á¨¨nÁØáÊñáÊ°£ÁöÑÂ≠òÂÇ®ÂüüÁöÑ‰ø°ÊÅØÂë¢ÔºüÂ∞±ÊòØË¶ÅÂÄüÂä©ÂüüÁ¥¢ÂºïÊñá‰ª∂„ÄÇ</li>
<li>ÂüüÁ¥¢ÂºïÊñá‰ª∂‰πüÊÄªÂÖ±Êúâsegment size‰∏™È°πÔºåÊØèÁØáÊñáÊ°£ÈÉΩÊúâ‰∏Ä‰∏™È°πÔºåÊØè‰∏ÄÈ°πÈÉΩÊòØ‰∏Ä‰∏™longÔºåÂ§ßÂ∞èÂõ∫ÂÆöÔºåÊØè‰∏ÄÈ°πÈÉΩÊòØÂØπÂ∫îÁöÑÊñáÊ°£Âú®fdtÊñá‰ª∂‰∏≠ÁöÑËµ∑ÂßãÂú∞ÂùÄÁöÑÂÅèÁßªÈáèÔºåËøôÊ†∑Â¶ÇÊûúÊàë‰ª¨ÊÉ≥ÊâæÂà∞Á¨¨nÁØáÊñáÊ°£ÁöÑÂ≠òÂÇ®ÂüüÁöÑ‰ø°ÊÅØÔºåÂè™Ë¶ÅÂú®fdx‰∏≠ÊâæÂà∞Á¨¨nÈ°πÔºåÁÑ∂ÂêéÊåâÁÖßÂèñÂá∫ÁöÑlong‰Ωú‰∏∫ÂÅèÁßªÈáèÔºåÂ∞±ÂèØ‰ª•Âú®fdtÊñá‰ª∂‰∏≠ÊâæÂà∞ÂØπÂ∫îÁöÑÂ≠òÂÇ®ÂüüÁöÑ‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
<li>ËØªÂèñÂüüÊï∞ÊçÆ‰ø°ÊÅØÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</li>
</ul>
<p>Document FieldsReader.doc(int n, FieldSelector fieldSelector)</p>
<ul>
<li>long position = indexStream.readLong();//indexStream points to &ldquo;.fdx&rdquo;</li>
<li>fieldsStream.seek(position);//fieldsStream points to &ldquo;fdt&rdquo;</li>
<li>int numFields = fieldsStream.readVInt();</li>
<li>for (int i = 0; i &lt; numFields; i++)
<ul>
<li>int fieldNumber = fieldsStream.readVInt();</li>
<li>byte bits = fieldsStream.readByte();</li>
<li>boolean compressed = (bits &amp; FieldsWriter.FIELD_IS_COMPRESSED) != 0;</li>
<li>boolean tokenize = (bits &amp; FieldsWriter.FIELD_IS_TOKENIZED) != 0;</li>
<li>boolean binary = (bits &amp; FieldsWriter.FIELD_IS_BINARY) != 0;</li>
<li>if (binary)
<ul>
<li>int toRead = fieldsStream.readVInt();</li>
<li>final byte[] b = new byte[toRead];</li>
<li>fieldsStream.readBytes(b, 0, b.length);</li>
<li>if (compressed)
<ul>
<li>int toRead = fieldsStream.readVInt();</li>
<li>final byte[] b = new byte[toRead];</li>
<li>fieldsStream.readBytes(b, 0, b.length);</li>
<li>uncompress(b),</li>
</ul>
</li>
</ul>
</li>
<li>else
<ul>
<li>fieldsStream.readString()</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="413-ËØçÂêëÈáèterm-vectorÁöÑÊï∞ÊçÆ‰ø°ÊÅØtvxtvdtvf"><strong>4.1.3. ËØçÂêëÈáè(Term Vector)ÁöÑÊï∞ÊçÆ‰ø°ÊÅØ(.tvxÔºå.tvdÔºå.tvf)</strong></h4>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022135786.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ËØçÂêëÈáè‰ø°ÊÅØÊòØ‰ªéÁ¥¢Âºï(index)Âà∞ÊñáÊ°£(document)Âà∞Âüü(field)Âà∞ËØç(term)ÁöÑÊ≠£Âêë‰ø°ÊÅØÔºåÊúâ‰∫ÜËØçÂêëÈáè‰ø°ÊÅØÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÂæóÂà∞‰∏ÄÁØáÊñáÊ°£ÂåÖÂê´ÈÇ£‰∫õËØçÁöÑ‰ø°ÊÅØ„ÄÇ</p>
<ul>
<li>ËØçÂêëÈáèÁ¥¢ÂºïÊñá‰ª∂(tvx)
<ul>
<li>‰∏Ä‰∏™ÊÆµ(segment)ÂåÖÂê´NÁØáÊñáÊ°£ÔºåÊ≠§Êñá‰ª∂Â∞±ÊúâNÈ°πÔºåÊØè‰∏ÄÈ°π‰ª£Ë°®‰∏ÄÁØáÊñáÊ°£„ÄÇ</li>
<li>ÊØè‰∏ÄÈ°πÂåÖÂê´‰∏§ÈÉ®ÂàÜ‰ø°ÊÅØÔºöÁ¨¨‰∏ÄÈÉ®ÂàÜÊòØËØçÂêëÈáèÊñáÊ°£Êñá‰ª∂(tvd)‰∏≠Ê≠§ÊñáÊ°£ÁöÑÂÅèÁßªÈáèÔºåÁ¨¨‰∫åÈÉ®ÂàÜÊòØËØçÂêëÈáèÂüüÊñá‰ª∂(tvf)‰∏≠Ê≠§ÊñáÊ°£ÁöÑÁ¨¨‰∏Ä‰∏™ÂüüÁöÑÂÅèÁßªÈáè„ÄÇ</li>
</ul>
</li>
<li>ËØçÂêëÈáèÊñáÊ°£Êñá‰ª∂(tvd)
<ul>
<li>‰∏Ä‰∏™ÊÆµ(segment)ÂåÖÂê´NÁØáÊñáÊ°£ÔºåÊ≠§Êñá‰ª∂Â∞±ÊúâNÈ°πÔºåÊØè‰∏ÄÈ°πÂåÖÂê´‰∫ÜÊ≠§ÊñáÊ°£ÁöÑÊâÄÊúâÁöÑÂüüÁöÑ‰ø°ÊÅØ„ÄÇ</li>
<li>ÊØè‰∏ÄÈ°πÈ¶ñÂÖàÊòØÊ≠§ÊñáÊ°£ÂåÖÂê´ÁöÑÂüüÁöÑ‰∏™Êï∞NumFieldsÔºåÁÑ∂ÂêéÊòØ‰∏Ä‰∏™NumFieldsÂ§ßÂ∞èÁöÑÊï∞ÁªÑÔºåÊï∞ÁªÑÁöÑÊØè‰∏ÄÈ°πÊòØÂüüÂè∑„ÄÇÁÑ∂ÂêéÊòØ‰∏Ä‰∏™(NumFields - 1)Â§ßÂ∞èÁöÑÊï∞ÁªÑÔºåÁî±ÂâçÈù¢Êàë‰ª¨Áü•ÈÅìÔºåÊØèÁØáÊñáÊ°£ÁöÑÁ¨¨‰∏Ä‰∏™ÂüüÂú®tvf‰∏≠ÁöÑÂÅèÁßªÈáèÂú®tvxÊñá‰ª∂‰∏≠‰øùÂ≠òÔºåËÄåÂÖ∂‰ªñ(NumFields - 1)‰∏™ÂüüÂú®tvf‰∏≠ÁöÑÂÅèÁßªÈáèÂ∞±ÊòØÁ¨¨‰∏Ä‰∏™ÂüüÁöÑÂÅèÁßªÈáèÂä†‰∏äËøô(NumFields - 1)‰∏™Êï∞ÁªÑÁöÑÊØè‰∏ÄÈ°πÁöÑÂÄº„ÄÇ</li>
</ul>
</li>
<li>ËØçÂêëÈáèÂüüÊñá‰ª∂(tvf)
<ul>
<li>Ê≠§Êñá‰ª∂ÂåÖÂê´‰∫ÜÊ≠§ÊÆµ‰∏≠ÁöÑÊâÄÊúâÁöÑÂüüÔºåÂπ∂‰∏çÂØπÊñáÊ°£ÂÅöÂå∫ÂàÜÔºåÂà∞Â∫ïÁ¨¨Âá†‰∏™ÂüüÂà∞Á¨¨Âá†‰∏™ÂüüÊòØÂ±û‰∫éÈÇ£ÁØáÊñáÊ°£ÔºåÊòØÁî±tvx‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™ÂüüÁöÑÂÅèÁßªÈáè‰ª•Âèätvd‰∏≠ÁöÑ(NumFields - 1)‰∏™ÂüüÁöÑÂÅèÁßªÈáèÊù•ÂÜ≥ÂÆöÁöÑ„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏Ä‰∏™ÂüüÔºåÈ¶ñÂÖàÊòØÊ≠§ÂüüÂåÖÂê´ÁöÑËØçÁöÑ‰∏™Êï∞NumTermsÔºåÁÑ∂ÂêéÊòØ‰∏Ä‰∏™8‰ΩçÁöÑbyteÔºåÊúÄÂêé‰∏Ä‰ΩçÊòØÊåáÂÆöÊòØÂê¶‰øùÂ≠ò‰ΩçÁΩÆ‰ø°ÊÅØÔºåÂÄíÊï∞Á¨¨‰∫å‰ΩçÊòØÊåáÂÆöÊòØÂê¶‰øùÂ≠òÂÅèÁßªÈáè‰ø°ÊÅØ„ÄÇÁÑ∂ÂêéÊòØNumTerms‰∏™È°πÁöÑÊï∞ÁªÑÔºåÊØè‰∏ÄÈ°π‰ª£Ë°®‰∏Ä‰∏™ËØç(Term)ÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™ËØçÔºåÁî±ËØçÁöÑÊñáÊú¨TermTextÔºåËØçÈ¢ëTermFreq(‰πüÂç≥Ê≠§ËØçÂú®Ê≠§ÊñáÊ°£‰∏≠Âá∫Áé∞ÁöÑÊ¨°Êï∞)ÔºåËØçÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØÔºåËØçÁöÑÂÅèÁßªÈáè‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
<li>ËØªÂèñËØçÂêëÈáèÊï∞ÊçÆ‰ø°ÊÅØÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</li>
</ul>
<p>TermVectorsReader.get(int docNum, String field, TermVectorMapper)</p>
<ul>
<li>int fieldNumber = fieldInfos.fieldNumber(field);//ÈÄöËøáfieldÂêçÂ≠óÂæóÂà∞fieldÂè∑</li>
<li>seekTvx(docNum);//Âú®tvxÊñá‰ª∂‰∏≠ÊåâdocNumÊñáÊ°£Âè∑ÊâæÂà∞Áõ∏Â∫îÊñáÊ°£ÁöÑÈ°π</li>
<li>long tvdPosition = tvx.readLong();//ÊâæÂà∞tvdÊñá‰ª∂‰∏≠Áõ∏Â∫îÊñáÊ°£ÁöÑÂÅèÁßªÈáè</li>
<li>tvd.seek(tvdPosition);//Âú®tvdÊñá‰ª∂‰∏≠ÊåâÂÅèÁßªÈáèÊâæÂà∞Áõ∏Â∫îÊñáÊ°£ÁöÑÈ°π</li>
<li>int fieldCount = tvd.readVInt();//Ê≠§ÊñáÊ°£ÂåÖÂê´ÁöÑÂüüÁöÑ‰∏™Êï∞„ÄÇ</li>
<li>for (int i = 0; i &lt; fieldCount; i++) //ÊåâÂüüÂè∑Êü•ÊâæÂüü
<ul>
<li>number = tvd.readVInt();</li>
<li>if (number == fieldNumber)
<ul>
<li>found = i;</li>
</ul>
</li>
</ul>
</li>
<li>position = tvx.readLong();//Âú®tvx‰∏≠ËØªÂá∫Ê≠§ÊñáÊ°£ÁöÑÁ¨¨‰∏Ä‰∏™ÂüüÂú®tvf‰∏≠ÁöÑÂÅèÁßªÈáè</li>
<li>for (int i = 1; i &lt;= found; i++)
<ul>
<li>position += tvd.readVLong();//Âä†‰∏äÊâÄË¶ÅÊâæÁöÑÂüüÂú®tvf‰∏≠ÁöÑÂÅèÁßªÈáè</li>
</ul>
</li>
<li>tvf.seek(position);</li>
<li>int numTerms = tvf.readVInt();</li>
<li>byte bits = tvf.readByte();</li>
<li>storePositions = (bits &amp; STORE_POSITIONS_WITH_TERMVECTOR) != 0;</li>
<li>storeOffsets = (bits &amp; STORE_OFFSET_WITH_TERMVECTOR) != 0;</li>
<li>for (int i = 0; i &lt; numTerms; i++)
<ul>
<li>start = tvf.readVInt();</li>
<li>deltaLength = tvf.readVInt();</li>
<li>totalLength = start + deltaLength;</li>
<li>tvf.readBytes(byteBuffer, start, deltaLength);</li>
<li>term = new String(byteBuffer, 0, totalLength, &ldquo;UTF-8&rdquo;);</li>
<li>if (storePositions)
<ul>
<li>positions = new int[freq];</li>
<li>int prevPosition = 0;</li>
<li>for (int j = 0; j &lt; freq; j++)
<ul>
<li>positions[j] = prevPosition + tvf.readVInt();</li>
<li>prevPosition = positions[j];</li>
</ul>
</li>
</ul>
</li>
<li>if (storeOffsets)
<ul>
<li>offsets = new TermVectorOffsetInfo[freq];</li>
<li>int prevOffset = 0;</li>
<li>for (int j = 0; j &lt; freq; j++)</li>
<li>int startOffset = prevOffset + tvf.readVInt();</li>
<li>int endOffset = startOffset + tvf.readVInt();</li>
<li>offsets[j] = new TermVectorOffsetInfo(startOffset, endOffset);</li>
<li>prevOffset = endOffset;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="42-ÂèçÂêë‰ø°ÊÅØ"><strong>4.2. ÂèçÂêë‰ø°ÊÅØ</strong></h3>
<p>ÂèçÂêë‰ø°ÊÅØÊòØÁ¥¢ÂºïÊñá‰ª∂ÁöÑÊ†∏ÂøÉÔºå‰πüÂç≥ÂèçÂêëÁ¥¢Âºï„ÄÇ</p>
<p>ÂèçÂêëÁ¥¢ÂºïÂåÖÊã¨‰∏§ÈÉ®ÂàÜÔºåÂ∑¶Èù¢ÊòØËØçÂÖ∏(Term Dictionary)ÔºåÂè≥Èù¢ÊòØÂÄíÊéíË°®(Posting List)„ÄÇ</p>
<p>Âú®Lucene‰∏≠ÔºåËøô‰∏§ÈÉ®ÂàÜÊòØÂàÜÊñá‰ª∂Â≠òÂÇ®ÁöÑÔºåËØçÂÖ∏ÊòØÂ≠òÂÇ®Âú®tiiÔºåtis‰∏≠ÁöÑÔºåÂÄíÊéíË°®ÂèàÂåÖÊã¨‰∏§ÈÉ®ÂàÜÔºå‰∏ÄÈÉ®ÂàÜÊòØÊñáÊ°£Âè∑ÂèäËØçÈ¢ëÔºå‰øùÂ≠òÂú®frq‰∏≠Ôºå‰∏ÄÈÉ®ÂàÜÊòØËØçÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØÔºå‰øùÂ≠òÂú®prx‰∏≠„ÄÇ</p>
<ul>
<li>Term Dictionary (tii, tis)
<ul>
<li>‚Äì&gt; Frequencies (.frq)</li>
<li>‚Äì&gt; Positions (.prx)</li>
</ul>
</li>
</ul>
<h4 id="421-ËØçÂÖ∏tisÂèäËØçÂÖ∏Á¥¢Âºïtii‰ø°ÊÅØ"><strong>4.2.1. ËØçÂÖ∏(tis)ÂèäËØçÂÖ∏Á¥¢Âºï(tii)‰ø°ÊÅØ</strong></h4>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022136378.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Âú®ËØçÂÖ∏‰∏≠ÔºåÊâÄÊúâÁöÑËØçÊòØÊåâÁÖßÂ≠óÂÖ∏È°∫Â∫èÊéíÂ∫èÁöÑ„ÄÇ</p>
<ul>
<li>ËØçÂÖ∏Êñá‰ª∂(tis)
<ul>
<li>TermCountÔºöËØçÂÖ∏‰∏≠ÂåÖÂê´ÁöÑÊÄªÁöÑËØçÊï∞</li>
<li>IndexIntervalÔºö‰∏∫‰∫ÜÂä†Âø´ÂØπËØçÁöÑÊü•ÊâæÈÄüÂ∫¶Ôºå‰πüÂ∫îÁî®Á±ª‰ººË∑≥Ë∑ÉË°®ÁöÑÁªìÊûÑÔºåÂÅáËÆæIndexInterval‰∏∫4ÔºåÂàôÂú®ËØçÂÖ∏Á¥¢Âºï(tii)Êñá‰ª∂‰∏≠‰øùÂ≠òÁ¨¨4‰∏™ÔºåÁ¨¨8‰∏™ÔºåÁ¨¨12‰∏™ËØçÔºåËøôÊ†∑ÂèØ‰ª•Âä†Âø´Âú®ËØçÂÖ∏Êñá‰ª∂‰∏≠Êü•ÊâæËØçÁöÑÈÄüÂ∫¶„ÄÇ</li>
<li>SkipIntervalÔºöÂÄíÊéíË°®Êó†ËÆ∫ÊòØÊñáÊ°£Âè∑ÂèäËØçÈ¢ëÔºåËøòÊòØ‰ΩçÁΩÆ‰ø°ÊÅØÔºåÈÉΩÊòØ‰ª•Ë∑≥Ë∑ÉË°®ÁöÑÁªìÊûÑÂ≠òÂú®ÁöÑÔºåSkipIntervalÊòØË∑≥Ë∑ÉÁöÑÊ≠•Êï∞„ÄÇ</li>
<li>MaxSkipLevelsÔºöË∑≥Ë∑ÉË°®ÊòØÂ§öÂ±ÇÁöÑÔºåËøô‰∏™ÂÄºÊåáÁöÑÊòØË∑≥Ë∑ÉË°®ÁöÑÊúÄÂ§ßÂ±ÇÊï∞„ÄÇ</li>
<li>TermCount‰∏™È°πÁöÑÊï∞ÁªÑÔºåÊØè‰∏ÄÈ°π‰ª£Ë°®‰∏Ä‰∏™ËØçÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™ËØçÔºå‰ª•ÂâçÁºÄÂêéÁºÄËßÑÂàôÂ≠òÊîæËØçÁöÑÊñáÊú¨‰ø°ÊÅØ(PrefixLength + Suffix)ÔºåËØçÂ±û‰∫éÁöÑÂüüÁöÑÂüüÂè∑(FieldNum)ÔºåÊúâÂ§öÂ∞ëÁØáÊñáÊ°£ÂåÖÂê´Ê≠§ËØç(DocFreq)ÔºåÊ≠§ËØçÁöÑÂÄíÊéíË°®Âú®frqÔºåprx‰∏≠ÁöÑÂÅèÁßªÈáè(FreqDelta, ProxDelta)ÔºåÊ≠§ËØçÁöÑÂÄíÊéíË°®ÁöÑË∑≥Ë∑ÉË°®Âú®frq‰∏≠ÁöÑÂÅèÁßªÈáè(SkipDelta)ÔºåËøôÈáå‰πãÊâÄ‰ª•Áî®DeltaÔºåÊòØÂ∫îÁî®Â∑ÆÂÄºËßÑÂàô„ÄÇ</li>
</ul>
</li>
<li>ËØçÂÖ∏Á¥¢ÂºïÊñá‰ª∂(tii)
<ul>
<li>ËØçÂÖ∏Á¥¢ÂºïÊñá‰ª∂ÊòØ‰∏∫‰∫ÜÂä†Âø´ÂØπËØçÂÖ∏Êñá‰ª∂‰∏≠ËØçÁöÑÊü•ÊâæÈÄüÂ∫¶Ôºå‰øùÂ≠òÊØèÈöîIndexInterval‰∏™ËØç„ÄÇ</li>
<li>ËØçÂÖ∏Á¥¢ÂºïÊñá‰ª∂ÊòØ‰ºöË¢´ÂÖ®ÈÉ®Âä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠ÂéªÁöÑ„ÄÇ</li>
<li>IndexTermCount = TermCount / IndexIntervalÔºöËØçÂÖ∏Á¥¢ÂºïÊñá‰ª∂‰∏≠ÂåÖÂê´ÁöÑËØçÊï∞„ÄÇ</li>
<li>IndexIntervalÂêåËØçÂÖ∏Êñá‰ª∂‰∏≠ÁöÑIndexInterval„ÄÇ</li>
<li>SkipIntervalÂêåËØçÂÖ∏Êñá‰ª∂‰∏≠ÁöÑSkipInterval„ÄÇ</li>
<li>MaxSkipLevelsÂêåËØçÂÖ∏Êñá‰ª∂‰∏≠ÁöÑMaxSkipLevels„ÄÇ</li>
<li>IndexTermCount‰∏™È°πÁöÑÊï∞ÁªÑÔºåÊØè‰∏ÄÈ°π‰ª£Ë°®‰∏Ä‰∏™ËØçÔºåÊØè‰∏ÄÈ°πÂåÖÊã¨‰∏§ÈÉ®ÂàÜÔºåÁ¨¨‰∏ÄÈÉ®ÂàÜÊòØËØçÊú¨Ë∫´(TermInfo)ÔºåÁ¨¨‰∫åÈÉ®ÂàÜÊòØÂú®ËØçÂÖ∏Êñá‰ª∂‰∏≠ÁöÑÂÅèÁßªÈáè(IndexDelta)„ÄÇÂÅáËÆæIndexInterval‰∏∫4ÔºåÊ≠§Êï∞ÁªÑ‰∏≠‰øùÂ≠òÁ¨¨4‰∏™ÔºåÁ¨¨8‰∏™ÔºåÁ¨¨12‰∏™ËØç„ÄÇ„ÄÇ„ÄÇ</li>
</ul>
</li>
<li>ËØªÂèñËØçÂÖ∏ÂèäËØçÂÖ∏Á¥¢ÂºïÊñá‰ª∂ÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</li>
</ul>
<p>origEnum = new SegmentTermEnum(directory.openInput(segment + &ldquo;.&rdquo; + IndexFileNames.TERMS_EXTENSION,readBufferSize), fieldInfos, false);//Áî®‰∫éËØªÂèñtisÊñá‰ª∂</p>
<ul>
<li>int firstInt = input.readInt();</li>
<li>size = input.readLong();</li>
<li>indexInterval = input.readInt();</li>
<li>skipInterval = input.readInt();</li>
<li>maxSkipLevels = input.readInt();</li>
</ul>
<p>SegmentTermEnum indexEnum = new SegmentTermEnum(directory.openInput(segment + &ldquo;.&rdquo; + IndexFileNames.TERMS_INDEX_EXTENSION, readBufferSize), fieldInfos, true);//Áî®‰∫éËØªÂèñtiiÊñá‰ª∂</p>
<ul>
<li>indexTerms = new Term[indexSize];</li>
<li>indexInfos = new TermInfo[indexSize];</li>
<li>indexPointers = new long[indexSize];</li>
<li>for (int i = 0; indexEnum.next(); i++)
<ul>
<li>indexTerms[i] = indexEnum.term();</li>
<li>indexInfos[i] = indexEnum.termInfo();</li>
<li>indexPointers[i] = indexEnum.indexPointer;</li>
</ul>
</li>
</ul>
<h4 id="422-ÊñáÊ°£Âè∑ÂèäËØçÈ¢ëfrq‰ø°ÊÅØ"><strong>4.2.2. ÊñáÊ°£Âè∑ÂèäËØçÈ¢ë(frq)‰ø°ÊÅØ</strong></h4>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022137895.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ÊñáÊ°£Âè∑ÂèäËØçÈ¢ëÊñá‰ª∂ÈáåÈù¢‰øùÂ≠òÁöÑÊòØÂÄíÊéíË°®ÔºåÊòØ‰ª•Ë∑≥Ë∑ÉË°®ÂΩ¢ÂºèÂ≠òÂú®ÁöÑ„ÄÇ</p>
<ul>
<li>Ê≠§Êñá‰ª∂ÂåÖÂê´TermCount‰∏™È°πÔºåÊØè‰∏Ä‰∏™ËØçÈÉΩÊúâ‰∏ÄÈ°πÔºåÂõ†‰∏∫ÊØè‰∏Ä‰∏™ËØçÈÉΩÊúâËá™Â∑±ÁöÑÂÄíÊéíË°®„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏Ä‰∏™ËØçÁöÑÂÄíÊéíË°®ÈÉΩÂåÖÊã¨‰∏§ÈÉ®ÂàÜÔºå‰∏ÄÈÉ®ÂàÜÊòØÂÄíÊéíË°®Êú¨Ë∫´Ôºå‰πüÂç≥‰∏Ä‰∏™Êï∞ÁªÑÁöÑÊñáÊ°£Âè∑ÂèäËØçÈ¢ëÔºåÂè¶‰∏ÄÈÉ®ÂàÜÊòØË∑≥Ë∑ÉË°®Ôºå‰∏∫‰∫ÜÊõ¥Âø´ÁöÑËÆøÈóÆÂíåÂÆö‰ΩçÂÄíÊéíË°®‰∏≠ÊñáÊ°£Âè∑ÂèäËØçÈ¢ëÁöÑ‰ΩçÁΩÆ„ÄÇ</li>
<li>ÂØπ‰∫éÊñáÊ°£Âè∑ÂíåËØçÈ¢ëÁöÑÂ≠òÂÇ®Â∫îÁî®ÁöÑÊòØÂ∑ÆÂÄºËßÑÂàôÂíåÊàñÁÑ∂Ë∑üÈöèËßÑÂàôÔºåLuceneÁöÑÊñáÊ°£Êú¨Ë∫´Êúâ‰ª•‰∏ãÂá†Âè•ËØùÔºåÊØîËæÉÈöæ‰ª•ÁêÜËß£ÔºåÂú®Ê≠§Ëß£Èáä‰∏Ä‰∏ãÔºö</li>
</ul>
<p>For example, the TermFreqs for a term which occurs once in document seven and three times in document eleven, with omitTf false, would be the following sequence of VInts:</p>
<p>15, 8, 3</p>
<p>If omitTf were true it would be this sequence of VInts instead:</p>
<p>7,4</p>
<p>È¶ñÂÖàÊàë‰ª¨ÁúãomitTf=falseÁöÑÊÉÖÂÜµÔºå‰πüÂç≥Êàë‰ª¨Âú®Á¥¢Âºï‰∏≠‰ºöÂ≠òÂÇ®‰∏Ä‰∏™ÊñáÊ°£‰∏≠termÂá∫Áé∞ÁöÑÊ¨°Êï∞„ÄÇ</p>
<p>‰æãÂ≠ê‰∏≠ËØ¥‰∫ÜÔºåË°®Á§∫Âú®ÊñáÊ°£7‰∏≠Âá∫Áé∞1Ê¨°ÔºåÂπ∂‰∏îÂèàÂú®ÊñáÊ°£11‰∏≠Âá∫Áé∞3Ê¨°ÁöÑÊñáÊ°£Áî®‰ª•‰∏ãÂ∫èÂàóË°®Á§∫Ôºö15Ôºå8Ôºå3.</p>
<p>ÈÇ£Ëøô‰∏â‰∏™Êï∞Â≠óÊòØÊÄé‰πàËÆ°ÁÆóÂá∫Êù•ÁöÑÂë¢Ôºü</p>
<p>È¶ñÂÖàÔºåÊ†πÊçÆÂÆö‰πâTermFreq &ndash;&gt; DocDelta[, Freq?]Ôºå‰∏Ä‰∏™TermFreqÁªìÊûÑÊòØÁî±‰∏Ä‰∏™DocDeltaÂêéÈù¢ÊàñËÆ∏Ë∑üÁùÄFreqÁªÑÊàêÔºå‰πüÂç≥‰∏äÈù¢Êàë‰ª¨ËØ¥ÁöÑA+BÔºüÁªìÊûÑ„ÄÇ</p>
<p>DocDeltaËá™ÁÑ∂ÊòØÊÉ≥Â≠òÂÇ®ÂåÖÂê´Ê≠§TermÁöÑÊñáÊ°£ÁöÑIDÂè∑‰∫ÜÔºåFreqÊòØÂú®Ê≠§ÊñáÊ°£‰∏≠Âá∫Áé∞ÁöÑÊ¨°Êï∞„ÄÇ</p>
<p>ÊâÄ‰ª•Ê†πÊçÆ‰æãÂ≠êÔºåÂ∫îËØ•Â≠òÂÇ®ÁöÑÂÆåÊï¥‰ø°ÊÅØ‰∏∫[DocID = 7, Freq = 1] [DocID = 11,  Freq = 3](ËßÅÂÖ®ÊñáÊ£ÄÁ¥¢ÁöÑÂü∫Êú¨ÂéüÁêÜÁ´†ËäÇ)„ÄÇ</p>
<p>ÁÑ∂ËÄå‰∏∫‰∫ÜËäÇÁúÅÁ©∫Èó¥ÔºåLuceneÂØπÁºñÂè∑Ê≠§Á±ªÁöÑÊï∞ÊçÆÈÉΩÊòØÁî®Â∑ÆÂÄºÊù•Ë°®Á§∫ÁöÑÔºå‰πüÂç≥‰∏äÈù¢ËØ¥ÁöÑËßÑÂàô2ÔºåDeltaËßÑÂàôÔºå‰∫éÊòØÊñáÊ°£IDÂ∞±‰∏çËÉΩÊåâÂÆåÊï¥‰ø°ÊÅØÂ≠ò‰∫ÜÔºåÂ∞±Â∫îËØ•Â≠òÊîæÂ¶Ç‰∏ãÔºö</p>
<p>[DocIDDelta = 7, Freq = 1][DocIDDelta = 4 (11-7), Freq = 3]</p>
<p>ÁÑ∂ËÄåLuceneÂØπ‰∫éA+B?ËøôÁßçÊàñÁÑ∂Ë∑üÈöèÁöÑÁªìÊûúÔºåÊúâÂÖ∂ÁâπÊÆäÁöÑÂ≠òÂÇ®ÊñπÂºèÔºåËßÅËßÑÂàô3ÔºåÂç≥A+B?ËßÑÂàôÔºåÂ¶ÇÊûúDocDeltaÂêéÈù¢Ë∑üÈöèÁöÑFreq‰∏∫1ÔºåÂàôÁî®DocDeltaÊúÄÂêé‰∏Ä‰ΩçÁΩÆ1Ë°®Á§∫„ÄÇ</p>
<p>Â¶ÇÊûúDocDeltaÂêéÈù¢Ë∑üÈöèÁöÑFreqÂ§ß‰∫é1ÔºåÂàôDocDeltaÂæóÊúÄÂêé‰∏Ä‰ΩçÁΩÆ0ÔºåÁÑ∂ÂêéÂêéÈù¢Ë∑üÈöèÁúüÊ≠£ÁöÑÂÄºÔºå‰ªéËÄåÂØπ‰∫éÁ¨¨‰∏Ä‰∏™TermÔºåÁî±‰∫éFreq‰∏∫1Ôºå‰∫éÊòØÊîæÂú®DocDeltaÁöÑÊúÄÂêé‰∏Ä‰ΩçË°®Á§∫ÔºåDocIDDelta = 7ÁöÑ‰∫åËøõÂà∂ÊòØ000 0111ÔºåÂøÖÈ°ªË¶ÅÂ∑¶Áßª‰∏Ä‰ΩçÔºå‰∏îÊúÄÂêé‰∏Ä‰ΩçÁΩÆ‰∏ÄÔºå000 1111 = 15ÔºåÂØπ‰∫éÁ¨¨‰∫å‰∏™TermÔºåÁî±‰∫éFreqÂ§ß‰∫é‰∏ÄÔºå‰∫éÊòØÊîæÂú®DocDeltaÁöÑÊúÄÂêé‰∏Ä‰ΩçÁΩÆÈõ∂ÔºåDocIDDelta = 4ÁöÑ‰∫åËøõÂà∂ÊòØ0000 0100ÔºåÂøÖÈ°ªË¶ÅÂ∑¶Áßª‰∏Ä‰ΩçÔºå‰∏îÊúÄÂêé‰∏Ä‰ΩçÁΩÆÈõ∂Ôºå0000 1000 = 8ÔºåÁÑ∂ÂêéÂêéÈù¢Ë∑üÈöèÁúüÊ≠£ÁöÑFreq = 3„ÄÇ</p>
<p>‰∫éÊòØÂæóÂà∞Â∫èÂàóÔºö[DocDleta = 15][DocDelta = 8, Freq = 3]Ôºå‰πüÂç≥Â∫èÂàóÔºå15Ôºå8Ôºå3„ÄÇ</p>
<p>Â¶ÇÊûúomitTf=trueÔºå‰πüÂç≥Êàë‰ª¨‰∏çÂú®Á¥¢Âºï‰∏≠Â≠òÂÇ®‰∏Ä‰∏™ÊñáÊ°£‰∏≠TermÂá∫Áé∞ÁöÑÊ¨°Êï∞ÔºåÂàôÂè™Â≠òDocIDÂ∞±ÂèØ‰ª•‰∫ÜÔºåÂõ†ËÄå‰∏çÂ≠òÂú®A+B?ËßÑÂàôÁöÑÂ∫îÁî®„ÄÇ</p>
<p>[DocID = 7][DocID = 11]ÔºåÁÑ∂ÂêéÂ∫îÁî®ËßÑÂàô2ÔºåDeltaËßÑÂàôÔºå‰∫éÊòØÂæóÂà∞Â∫èÂàó[DocDelta = 7][DocDelta = 4 (11 - 7)]Ôºå‰πüÂç≥Â∫èÂàóÔºå7Ôºå4.</p>
<ul>
<li>ÂØπ‰∫éË∑≥Ë∑ÉË°®ÁöÑÂ≠òÂÇ®Êúâ‰ª•‰∏ãÂá†ÁÇπÈúÄË¶ÅËß£Èáä‰∏Ä‰∏ãÔºö
<ul>
<li>Ë∑≥Ë∑ÉË°®ÂèØÊ†πÊçÆÂÄíÊéíË°®Êú¨Ë∫´ÁöÑÈïøÂ∫¶(DocFreq)ÂíåË∑≥Ë∑ÉÁöÑÂπÖÂ∫¶(SkipInterval)ËÄåÂàÜ‰∏çÂêåÁöÑÂ±ÇÊ¨°ÔºåÂ±ÇÊ¨°Êï∞‰∏∫NumSkipLevels = Min(MaxSkipLevels, floor(log(DocFreq/log(SkipInterval)))).</li>
<li>Á¨¨LevelÂ±ÇÁöÑËäÇÁÇπÊï∞‰∏∫DocFreq/(SkipInterval^(Level + 1))Ôºålevel‰ªéÈõ∂ËÆ°Êï∞„ÄÇ</li>
<li>Èô§‰∫ÜÊúÄ‰ΩéÂ±Ç‰πãÂ§ñÔºåÂÖ∂‰ªñÂ±ÇÈÉΩÊúâSkipLevelLengthÊù•Ë°®Á§∫Ê≠§Â±ÇÁöÑ‰∫åËøõÂà∂ÈïøÂ∫¶(ËÄåÈùûËäÇÁÇπÁöÑ‰∏™Êï∞)ÔºåÊñπ‰æøËØªÂèñÊüê‰∏ÄÂ±ÇÁöÑË∑≥Ë∑ÉË°®Âà∞ÁºìÂ≠òÈáåÈù¢„ÄÇ</li>
<li>È´òÂ±ÇÂú®ÂâçÔºå‰ΩéÂ±ÇÂú®ÂêéÔºåÂΩìËØªÂÆåÊâÄÊúâÁöÑÈ´òÂ±ÇÂêéÔºåÂâ©‰∏ãÁöÑÂ∞±ÊòØÊúÄ‰Ωé‰∏ÄÂ±ÇÔºåÂõ†ËÄåÊúÄÂêé‰∏ÄÂ±Ç‰∏çÈúÄË¶ÅSkipLevelLength„ÄÇËøô‰πüÊòØ‰∏∫‰ªÄ‰πàLuceneÊñáÊ°£‰∏≠ÁöÑÊ†ºÂºèÊèèËø∞‰∏∫ <!-- raw HTML omitted -->NumSkipLevels-1<!-- raw HTML omitted -->, SkipLevelÔºå‰πüÂç≥‰ΩéNumSKipLevels-1Â±ÇÊúâSkipLevelLengthÔºåÊúÄÂêé‰∏ÄÂ±ÇÂè™ÊúâSkipLevelÔºåÊ≤°ÊúâSkipLevelLength„ÄÇ</li>
<li>Èô§ÊúÄ‰ΩéÂ±Ç‰ª•Â§ñÔºåÂÖ∂‰ªñÂ±ÇÈÉΩÊúâSkipChildLevelPointerÊù•ÊåáÂêë‰∏ã‰∏ÄÂ±ÇÁõ∏Â∫îÁöÑËäÇÁÇπ„ÄÇ</li>
<li>ÊØè‰∏Ä‰∏™Ë∑≥Ë∑ÉËäÇÁÇπÂåÖÂê´‰ª•‰∏ã‰ø°ÊÅØÔºöÊñáÊ°£Âè∑ÔºåpayloadÁöÑÈïøÂ∫¶ÔºåÊñáÊ°£Âè∑ÂØπÂ∫îÁöÑÂÄíÊéíË°®‰∏≠ÁöÑËäÇÁÇπÂú®frq‰∏≠ÁöÑÂÅèÁßªÈáèÔºåÊñáÊ°£Âè∑ÂØπÂ∫îÁöÑÂÄíÊéíË°®‰∏≠ÁöÑËäÇÁÇπÂú®prx‰∏≠ÁöÑÂÅèÁßªÈáè„ÄÇ</li>
<li>ËôΩÁÑ∂LuceneÁöÑÊñáÊ°£‰∏≠Êúâ‰ª•‰∏ãÁöÑÊèèËø∞ÔºåÁÑ∂ËÄåÂÆûÈ™åÁöÑÁªìÊûúÂç¥‰∏çÊòØÂÆåÂÖ®ÂáÜÁ°ÆÁöÑÔºö</li>
</ul>
</li>
</ul>
<p>Example: SkipInterval = 4, MaxSkipLevels = 2, DocFreq = 35. Then skip level 0 has 8 SkipData entries, containing the 3<!-- raw HTML omitted -->rd<!-- raw HTML omitted -->, 7<!-- raw HTML omitted -->th<!-- raw HTML omitted -->, 11<!-- raw HTML omitted -->th<!-- raw HTML omitted -->, 15<!-- raw HTML omitted -->th<!-- raw HTML omitted -->, 19<!-- raw HTML omitted -->th<!-- raw HTML omitted -->, 23<!-- raw HTML omitted -->rd<!-- raw HTML omitted -->, 27<!-- raw HTML omitted -->th<!-- raw HTML omitted -->, and 31<!-- raw HTML omitted -->st<!-- raw HTML omitted --> document numbers in TermFreqs. Skip level 1 has 2 SkipData entries, containing the 15<!-- raw HTML omitted -->th<!-- raw HTML omitted --> and 31<!-- raw HTML omitted -->st<!-- raw HTML omitted --> document numbers in TermFreqs.</p>
<p>ÊåâÁÖßÊèèËø∞ÔºåÂΩìSkipInterval‰∏∫4Ôºå‰∏îÊúâ35ÁØáÊñáÊ°£ÁöÑÊó∂ÂÄôÔºåSkip level = 0Â∫îËØ•ÂåÖÊã¨Á¨¨3ÔºåÁ¨¨7ÔºåÁ¨¨11ÔºåÁ¨¨15ÔºåÁ¨¨19ÔºåÁ¨¨23ÔºåÁ¨¨27ÔºåÁ¨¨31ÁØáÊñáÊ°£ÔºåSkip level = 1Â∫îËØ•ÂåÖÊã¨Á¨¨15ÔºåÁ¨¨31ÁØáÊñáÊ°£„ÄÇ</p>
<p>ÁÑ∂ËÄåÁúüÊ≠£ÁöÑÂÆûÁé∞‰∏≠ÔºåË∑≥Ë∑ÉË°®ËäÇÁÇπÁöÑÊó∂ÂÄôÔºåÂç¥ÂêëÂâçÂÅèÁßª‰∫ÜÔºåÂÅèÁßªÁöÑÂéüÂõ†Âú®‰∫é‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÔºö</p>
<ul>
<li>FormatPostingsDocsWriter.addDoc(int docID, int termDocFreq)
<ul>
<li>final int delta = docID - lastDocID;</li>
<li>if ((++df % skipInterval) == 0)
<ul>
<li>skipListWriter.setSkipData(lastDocID, storePayloads, posWriter.lastPayloadLength);</li>
<li>skipListWriter.bufferSkip(df);</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>‰ªé‰ª£Á†Å‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåÂΩìSkipInterval‰∏∫4ÁöÑÊó∂ÂÄôÔºåÂΩìdocID = 0Êó∂Ôºå++df‰∏∫1Ôºå1%4‰∏ç‰∏∫0Ôºå‰∏çÊòØË∑≥Ë∑ÉËäÇÁÇπÔºåÂΩìdocID = 3Êó∂Ôºå++df=4Ôºå4%4‰∏∫0Ôºå‰∏∫Ë∑≥Ë∑ÉËäÇÁÇπÔºåÁÑ∂ËÄåskipDataÈáåÈù¢‰øùÂ≠òÁöÑÂç¥ÊòØlastDocID‰∏∫2„ÄÇ</p>
<p>ÊâÄ‰ª•ÁúüÊ≠£ÁöÑÂÄíÊéíË°®ÂíåË∑≥Ë∑ÉË°®‰∏≠‰øùÂ≠ò‰∏Ä‰∏ãÁöÑ‰ø°ÊÅØÔºö</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022137901.png"
	
	
	
	loading="lazy"
	
	
></p>
<h4 id="423-ËØç‰ΩçÁΩÆprx‰ø°ÊÅØ"><strong>4.2.3. ËØç‰ΩçÁΩÆ(prx)‰ø°ÊÅØ</strong></h4>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022138998.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ËØç‰ΩçÁΩÆ‰ø°ÊÅØ‰πüÊòØÂÄíÊéíË°®Ôºå‰πüÊòØ‰ª•Ë∑≥Ë∑ÉË°®ÂΩ¢ÂºèÂ≠òÂú®ÁöÑ„ÄÇ</p>
<ul>
<li>Ê≠§Êñá‰ª∂ÂåÖÂê´TermCount‰∏™È°πÔºåÊØè‰∏Ä‰∏™ËØçÈÉΩÊúâ‰∏ÄÈ°πÔºåÂõ†‰∏∫ÊØè‰∏Ä‰∏™ËØçÈÉΩÊúâËá™Â∑±ÁöÑËØç‰ΩçÁΩÆÂÄíÊéíË°®„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏Ä‰∏™ËØçÁöÑÈÉΩÊúâ‰∏Ä‰∏™DocFreqÂ§ßÂ∞èÁöÑÊï∞ÁªÑÔºåÊØèÈ°π‰ª£Ë°®‰∏ÄÁØáÊñáÊ°£ÔºåËÆ∞ÂΩïÊ≠§ÊñáÊ°£‰∏≠Ê≠§ËØçÂá∫Áé∞ÁöÑ‰ΩçÁΩÆ„ÄÇËøô‰∏™ÊñáÊ°£Êï∞ÁªÑ‰πüÊòØÂíåfrqÊñá‰ª∂‰∏≠ÁöÑË∑≥Ë∑ÉË°®ÊúâÂÖ≥Á≥ªÁöÑÔºå‰ªé‰∏äÈù¢Êàë‰ª¨Áü•ÈÅìÔºåÂú®frqÁöÑË∑≥Ë∑ÉË°®ËäÇÁÇπ‰∏≠ÊúâProxSkipÔºåÂΩìSkipInterval‰∏∫3ÁöÑÊó∂ÂÄôÔºåfrqÁöÑË∑≥Ë∑ÉË°®ËäÇÁÇπÊåáÂêëprxÊñá‰ª∂‰∏≠ÁöÑÊ≠§Êï∞ÁªÑ‰∏≠ÁöÑÁ¨¨1ÔºåÁ¨¨4ÔºåÁ¨¨7ÔºåÁ¨¨10ÔºåÁ¨¨13ÔºåÁ¨¨16ÁØáÊñáÊ°£„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏ÄÁØáÊñáÊ°£ÔºåÂèØËÉΩÂåÖÂê´‰∏Ä‰∏™ËØçÂ§öÊ¨°ÔºåÂõ†ËÄåÊúâ‰∏Ä‰∏™FreqÂ§ßÂ∞èÁöÑÊï∞ÁªÑÔºåÊØè‰∏ÄÈ°π‰ª£Ë°®Ê≠§ËØçÂú®Ê≠§ÊñáÊ°£‰∏≠Âá∫Áé∞‰∏ÄÊ¨°ÔºåÂàôÊúâ‰∏Ä‰∏™‰ΩçÁΩÆ‰ø°ÊÅØ„ÄÇ</li>
<li>ÊØè‰∏Ä‰∏™‰ΩçÁΩÆ‰ø°ÊÅØÂåÖÂê´ÔºöPositionDelta(ÈááÁî®Â∑ÆÂÄºËßÑÂàô)ÔºåËøòÂèØ‰ª•‰øùÂ≠òpayloadÔºåÂ∫îÁî®ÊàñÁÑ∂Ë∑üÈöèËßÑÂàô„ÄÇ</li>
</ul>
<h3 id="43-ÂÖ∂‰ªñ‰ø°ÊÅØ"><strong>4.3. ÂÖ∂‰ªñ‰ø°ÊÅØ</strong></h3>
<h4 id="431-Ê†áÂáÜÂåñÂõ†Â≠êÊñá‰ª∂nrm"><strong>4.3.1. Ê†áÂáÜÂåñÂõ†Â≠êÊñá‰ª∂(nrm)</strong></h4>
<p>‰∏∫‰ªÄ‰πà‰ºöÊúâÊ†áÂáÜÂåñÂõ†Â≠êÂë¢Ôºü‰ªéÁ¨¨‰∏ÄÁ´†‰∏≠ÁöÑÊèèËø∞ÔºåÊàë‰ª¨Áü•ÈÅìÔºåÂú®ÊêúÁ¥¢ËøáÁ®ã‰∏≠ÔºåÊêúÁ¥¢Âá∫ÁöÑÊñáÊ°£Ë¶ÅÊåâ‰∏éÊü•ËØ¢ËØ≠Âè•ÁöÑÁõ∏ÂÖ≥ÊÄßÊéíÂ∫èÔºåÁõ∏ÂÖ≥ÊÄßÂ§ßÁöÑÊâìÂàÜ(score)È´òÔºå‰ªéËÄåÊéíÂú®ÂâçÈù¢„ÄÇÁõ∏ÂÖ≥ÊÄßÊâìÂàÜ(score)‰ΩøÁî®ÂêëÈáèÁ©∫Èó¥Ê®°Âûã(Vector Space Model)ÔºåÂú®ËÆ°ÁÆóÁõ∏ÂÖ≥ÊÄß‰πãÂâçÔºåË¶ÅËÆ°ÁÆóTerm WeightÔºå‰πüÂç≥ÊüêTermÁõ∏ÂØπ‰∫éÊüêDocumentÁöÑÈáçË¶ÅÊÄß„ÄÇÂú®ËÆ°ÁÆóTerm WeightÊó∂Ôºå‰∏ªË¶ÅÊúâ‰∏§‰∏™ÂΩ±ÂìçÂõ†Á¥†Ôºå‰∏Ä‰∏™ÊòØÊ≠§TermÂú®Ê≠§ÊñáÊ°£‰∏≠Âá∫Áé∞ÁöÑÊ¨°Êï∞Ôºå‰∏Ä‰∏™ÊòØÊ≠§TermÁöÑÊôÆÈÄöÁ®ãÂ∫¶„ÄÇÊòæÁÑ∂Ê≠§TermÂú®Ê≠§ÊñáÊ°£‰∏≠Âá∫Áé∞ÁöÑÊ¨°Êï∞Ë∂äÂ§öÔºåÊ≠§TermÂú®Ê≠§ÊñáÊ°£‰∏≠Ë∂äÈáçË¶Å„ÄÇ</p>
<p>ËøôÁßçTerm WeightÁöÑËÆ°ÁÆóÊñπÊ≥ïÊòØÊúÄÊôÆÈÄöÁöÑÔºåÁÑ∂ËÄåÂ≠òÂú®‰ª•‰∏ãÂá†‰∏™ÈóÆÈ¢òÔºö</p>
<ul>
<li>‰∏çÂêåÁöÑÊñáÊ°£ÈáçË¶ÅÊÄß‰∏çÂêå„ÄÇÊúâÁöÑÊñáÊ°£ÈáçË¶Å‰∫õÔºåÊúâÁöÑÊñáÊ°£Áõ∏ÂØπ‰∏çÈáçË¶ÅÔºåÊØîÂ¶ÇÂØπ‰∫éÂÅöËΩØ‰ª∂ÁöÑÔºåÂú®Á¥¢Âºï‰π¶Á±çÁöÑÊó∂ÂÄôÔºåÊàëÊÉ≥ËÆ©ËÆ°ÁÆóÊú∫ÊñπÈù¢ÁöÑ‰π¶Êõ¥ÂÆπÊòìÊêúÂà∞ÔºåËÄåÊñáÂ≠¶ÊñπÈù¢ÁöÑ‰π¶Á±çÊêúÁ¥¢Êó∂ÊéíÂêçÈù†Âêé„ÄÇ</li>
<li>‰∏çÂêåÁöÑÂüüÈáçË¶ÅÊÄß‰∏çÂêå„ÄÇÊúâÁöÑÂüüÈáçË¶Å‰∏Ä‰∫õÔºåÂ¶ÇÂÖ≥ÈîÆÂ≠óÔºåÂ¶ÇÊ†áÈ¢òÔºåÊúâÁöÑÂüü‰∏çÈáçË¶Å‰∏Ä‰∫õÔºåÂ¶ÇÈôÑ‰ª∂Á≠â„ÄÇÂêåÊ†∑‰∏Ä‰∏™ËØç(Term)ÔºåÂá∫Áé∞Âú®ÂÖ≥ÈîÆÂ≠ó‰∏≠Â∫îËØ•ÊØîÂá∫Áé∞Âú®ÈôÑ‰ª∂‰∏≠ÊâìÂàÜË¶ÅÈ´ò„ÄÇ</li>
<li>Ê†πÊçÆËØç(Term)Âú®ÊñáÊ°£‰∏≠Âá∫Áé∞ÁöÑÁªùÂØπÊ¨°Êï∞Êù•ÂÜ≥ÂÆöÊ≠§ËØçÂØπÊñáÊ°£ÁöÑÈáçË¶ÅÊÄßÔºåÊúâ‰∏çÂêàÁêÜÁöÑÂú∞Êñπ„ÄÇÊØîÂ¶ÇÈïøÁöÑÊñáÊ°£ËØçÂú®ÊñáÊ°£‰∏≠Âá∫Áé∞ÁöÑÊ¨°Êï∞Áõ∏ÂØπËæÉÂ§öÔºåËøôÊ†∑Áü≠ÁöÑÊñáÊ°£ÊØîËæÉÂêÉ‰∫è„ÄÇÊØîÂ¶Ç‰∏Ä‰∏™ËØçÂú®‰∏ÄÊú¨Á†ñÂ§¥‰π¶‰∏≠Âá∫Áé∞‰∫Ü10Ê¨°ÔºåÂú®Âè¶Â§ñ‰∏ÄÁØá‰∏çË∂≥100Â≠óÁöÑÊñáÁ´†‰∏≠Âá∫Áé∞‰∫Ü9Ê¨°ÔºåÂ∞±ËØ¥ÊòéÁ†ñÂ§¥‰π¶Â∫îËØ•ÊéíÂú®ÂâçÈù¢Á†ÅÔºü‰∏çÂ∫îËØ•ÔºåÊòæÁÑ∂Ê≠§ËØçÂú®‰∏çË∂≥100Â≠óÁöÑÊñáÁ´†‰∏≠ËÉΩÂá∫Áé∞9Ê¨°ÔºåÂèØËßÅÂÖ∂ÂØπÊ≠§ÊñáÁ´†ÁöÑÈáçË¶ÅÊÄß„ÄÇ</li>
</ul>
<p>Áî±‰∫é‰ª•‰∏äÂéüÂõ†ÔºåLuceneÂú®ËÆ°ÁÆóTerm WeightÊó∂ÔºåÈÉΩ‰ºö‰πò‰∏ä‰∏Ä‰∏™Ê†áÂáÜÂåñÂõ†Â≠ê(Normalization Factor)ÔºåÊù•ÂáèÂ∞ë‰∏äÈù¢‰∏â‰∏™ÈóÆÈ¢òÁöÑÂΩ±Âìç„ÄÇ</p>
<p>Ê†áÂáÜÂåñÂõ†Â≠ê(Normalization Factor)ÊòØ‰ºöÂΩ±ÂìçÈöèÂêéÊâìÂàÜ(score)ÁöÑËÆ°ÁÆóÁöÑÔºåLuceneÁöÑÊâìÂàÜËÆ°ÁÆó‰∏ÄÈÉ®ÂàÜÂèëÁîüÂú®Á¥¢ÂºïËøáÁ®ã‰∏≠Ôºå‰∏ÄËà¨ÊòØ‰∏éÊü•ËØ¢ËØ≠Âè•Êó†ÂÖ≥ÁöÑÂèÇÊï∞Â¶ÇÊ†áÂáÜÂåñÂõ†Â≠êÔºåÂ§ßÈÉ®ÂàÜÂèëÁîüÂú®ÊêúÁ¥¢ËøáÁ®ã‰∏≠Ôºå‰ºöÂú®ÊêúÁ¥¢ËøáÁ®ãÁöÑ‰ª£Á†ÅÂàÜÊûê‰∏≠ËØ¶Ëø∞„ÄÇ</p>
<p>Ê†áÂáÜÂåñÂõ†Â≠ê(Normalization Factor)Âú®Á¥¢ÂºïËøáÁ®ãÊÄªÁöÑËÆ°ÁÆóÂ¶Ç‰∏ãÔºö</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022139227.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ÂÆÉÂåÖÊã¨‰∏â‰∏™ÂèÇÊï∞Ôºö</p>
<ul>
<li>Document boostÔºöÊ≠§ÂÄºË∂äÂ§ßÔºåËØ¥ÊòéÊ≠§ÊñáÊ°£Ë∂äÈáçË¶Å„ÄÇ</li>
<li>Field boostÔºöÊ≠§ÂüüË∂äÂ§ßÔºåËØ¥ÊòéÊ≠§ÂüüË∂äÈáçË¶Å„ÄÇ</li>
<li>lengthNorm(field) = (1.0 / Math.sqrt(numTerms))Ôºö‰∏Ä‰∏™Âüü‰∏≠ÂåÖÂê´ÁöÑTermÊÄªÊï∞Ë∂äÂ§öÔºå‰πüÂç≥ÊñáÊ°£Ë∂äÈïøÔºåÊ≠§ÂÄºË∂äÂ∞èÔºåÊñáÊ°£Ë∂äÁü≠ÔºåÊ≠§ÂÄºË∂äÂ§ß„ÄÇ</li>
</ul>
<p>‰ªé‰∏äÈù¢ÁöÑÂÖ¨ÂºèÔºåÊàë‰ª¨Áü•ÈÅìÔºå‰∏Ä‰∏™ËØç(Term)Âá∫Áé∞Âú®‰∏çÂêåÁöÑÊñáÊ°£Êàñ‰∏çÂêåÁöÑÂüü‰∏≠ÔºåÊ†áÂáÜÂåñÂõ†Â≠ê‰∏çÂêå„ÄÇÊØîÂ¶ÇÊúâ‰∏§‰∏™ÊñáÊ°£ÔºåÊØè‰∏™ÊñáÊ°£Êúâ‰∏§‰∏™ÂüüÔºåÂ¶ÇÊûú‰∏çËÄÉËôëÊñáÊ°£ÈïøÂ∫¶ÔºåÂ∞±ÊúâÂõõÁßçÊéíÂàóÁªÑÂêàÔºåÂú®ÈáçË¶ÅÊñáÊ°£ÁöÑÈáçË¶ÅÂüü‰∏≠ÔºåÂú®ÈáçË¶ÅÊñáÊ°£ÁöÑÈùûÈáçË¶ÅÂüü‰∏≠ÔºåÂú®ÈùûÈáçË¶ÅÊñáÊ°£ÁöÑÈáçË¶ÅÂüü‰∏≠ÔºåÂú®ÈùûÈáçË¶ÅÊñáÊ°£ÁöÑÈùûÈáçË¶ÅÂüü‰∏≠ÔºåÂõõÁßçÁªÑÂêàÔºåÊØèÁßçÊúâ‰∏çÂêåÁöÑÊ†áÂáÜÂåñÂõ†Â≠ê„ÄÇ</p>
<p>‰∫éÊòØÂú®Lucene‰∏≠ÔºåÊ†áÂáÜÂåñÂõ†Â≠êÂÖ±‰øùÂ≠ò‰∫Ü(ÊñáÊ°£Êï∞ÁõÆ‰πò‰ª•ÂüüÊï∞ÁõÆ)‰∏™ÔºåÊ†ºÂºèÂ¶Ç‰∏ãÔºö</p>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022139297.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>Ê†áÂáÜÂåñÂõ†Â≠êÊñá‰ª∂(Normalization Factor File: nrm)Ôºö
<ul>
<li>NormsHeaderÔºöÂ≠óÁ¨¶‰∏≤‚ÄúNRM‚ÄùÂ§ñÂä†VersionÔºå‰æùLuceneÁöÑÁâàÊú¨ÁöÑ‰∏çÂêåËÄå‰∏çÂêå„ÄÇ</li>
<li>Êé•ÁùÄÊòØ‰∏Ä‰∏™Êï∞ÁªÑÔºåÂ§ßÂ∞è‰∏∫NumFieldsÔºåÊØè‰∏™Field‰∏ÄÈ°πÔºåÊØè‰∏ÄÈ°π‰∏∫‰∏Ä‰∏™Norms„ÄÇ</li>
<li>Norms‰πüÊòØ‰∏Ä‰∏™Êï∞ÁªÑÔºåÂ§ßÂ∞è‰∏∫SegSizeÔºåÂç≥Ê≠§ÊÆµ‰∏≠ÊñáÊ°£ÁöÑÊï∞ÈáèÔºåÊØè‰∏ÄÈ°π‰∏∫‰∏Ä‰∏™ByteÔºåË°®Á§∫‰∏Ä‰∏™ÊµÆÁÇπÊï∞ÔºåÂÖ∂‰∏≠0~2‰∏∫Â∞æÊï∞Ôºå3~8‰∏∫ÊåáÊï∞„ÄÇ</li>
</ul>
</li>
</ul>
<h4 id="432-Âà†Èô§ÊñáÊ°£Êñá‰ª∂del"><strong>4.3.2. Âà†Èô§ÊñáÊ°£Êñá‰ª∂(del)</strong></h4>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022139282.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>Ë¢´Âà†Èô§ÊñáÊ°£Êñá‰ª∂(Deleted Document File: .del)
<ul>
<li>FormatÔºöÂú®Ê≠§Êñá‰ª∂‰∏≠ÔºåBitsÂíåDGapsÂè™ËÉΩ‰øùÂ≠òÂÖ∂‰∏≠‰πã‰∏ÄÔºå-1Ë°®Á§∫‰øùÂ≠òDGapsÔºåÈùûË¥üÂÄºË°®Á§∫‰øùÂ≠òBits„ÄÇ</li>
<li>ByteCountÔºöÊ≠§ÊÆµ‰∏≠ÊúâÂ§öÂ∞ëÊñáÊ°£ÔºåÂ∞±ÊúâÂ§öÂ∞ë‰∏™bitË¢´‰øùÂ≠òÔºå‰ΩÜÊòØ‰ª•byteÂΩ¢ÂºèËÆ°Êï∞Ôºå‰πüÂç≥BitsÁöÑÂ§ßÂ∞èÂ∫îËØ•ÊòØbyteÁöÑÂÄçÊï∞„ÄÇ</li>
<li>BitCountÔºöBits‰∏≠ÊúâÂ§öÂ∞ë‰ΩçË¢´Ëá≥1ÔºåË°®Á§∫Ê≠§ÊñáÊ°£Â∑≤ÁªèË¢´Âà†Èô§„ÄÇ</li>
<li>BitsÔºö‰∏Ä‰∏™Êï∞ÁªÑÁöÑbyteÔºåÂ§ßÂ∞è‰∏∫ByteCountÔºåÂ∫îÁî®Êó∂Ë¢´ËÆ§‰∏∫ÊòØbyte*8‰∏™bit„ÄÇ</li>
<li>DGapsÔºöÂ¶ÇÊûúÂà†Èô§ÁöÑÊñáÊ°£Êï∞ÈáèÂæàÂ∞èÔºåÂàôBitsÂ§ßÈÉ®ÂàÜ‰Ωç‰∏∫0ÔºåÂæàÊµ™Ë¥πÁ©∫Èó¥„ÄÇDGapsÈááÁî®‰ª•‰∏ãÁöÑÊñπÂºèÊù•‰øùÂ≠òÁ®ÄÁñèÊï∞ÁªÑÔºöÊØîÂ¶ÇÁ¨¨ÂçÅÔºåÂçÅ‰∫åÔºå‰∏âÂçÅ‰∫å‰∏™ÊñáÊ°£Ë¢´Âà†Èô§Ôºå‰∫éÊòØÁ¨¨ÂçÅÔºåÂçÅ‰∫åÔºå‰∏âÂçÅ‰∫å‰ΩçËÆæ‰∏∫1ÔºåDGaps‰πüÊòØ‰ª•byte‰∏∫Âçï‰ΩçÁöÑÔºå‰ªÖ‰øùÂ≠ò‰∏ç‰∏∫0ÁöÑbyteÔºåÂ¶ÇÁ¨¨1‰∏™byteÔºåÁ¨¨4‰∏™byteÔºåÁ¨¨1‰∏™byteÂçÅËøõÂà∂‰∏∫20ÔºåÁ¨¨4‰∏™byteÂçÅËøõÂà∂‰∏∫1„ÄÇ‰∫éÊòØ‰øùÂ≠òÊàêDGapsÔºåÁ¨¨1‰∏™byteÔºå‰ΩçÁΩÆ1Áî®‰∏çÂÆöÈïøÊ≠£Êï¥Êï∞‰øùÂ≠òÔºåÂÄº‰∏∫20Áî®‰∫åËøõÂà∂‰øùÂ≠òÔºåÁ¨¨2‰∏™byteÔºå‰ΩçÁΩÆ4Áî®‰∏çÂÆöÈïøÊ≠£Êï¥Êï∞‰øùÂ≠òÔºåÁî®Â∑ÆÂÄº‰∏∫3ÔºåÂÄº‰∏∫1Áî®‰∫åËøõÂà∂‰øùÂ≠òÔºå‰∫åËøõÂà∂Êï∞ÊçÆ‰∏çÁî®Â∑ÆÂÄºË°®Á§∫„ÄÇ</li>
</ul>
</li>
</ul>
<h2 id="‰∫îÊÄª‰ΩìÁªìÊûÑ"><strong>‰∫î„ÄÅÊÄª‰ΩìÁªìÊûÑ</strong></h2>
<p><img src="https://raw.githubusercontent.com/lxbwolf/blog_source_image/main/202403022139069.png"
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>ÂõæÁ§∫‰∏∫LuceneÁ¥¢ÂºïÊñá‰ª∂ÁöÑÊï¥‰ΩìÁªìÊûÑÔºö
<ul>
<li>Â±û‰∫éÊï¥‰∏™Á¥¢Âºï(Index)ÁöÑsegment.genÔºåsegment_NÔºåÂÖ∂‰øùÂ≠òÁöÑÊòØÊÆµ(segment)ÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºåÁÑ∂ÂêéÂàÜÂ§ö‰∏™segment‰øùÂ≠òÊï∞ÊçÆ‰ø°ÊÅØÔºåÂêå‰∏Ä‰∏™segmentÊúâÁõ∏ÂêåÁöÑÂâçÁºÄÊñá‰ª∂Âêç„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏Ä‰∏™ÊÆµÔºåÂåÖÂê´Âüü‰ø°ÊÅØÔºåËØç‰ø°ÊÅØÔºå‰ª•ÂèäÂÖ∂‰ªñ‰ø°ÊÅØ(Ê†áÂáÜÂåñÂõ†Â≠êÔºåÂà†Èô§ÊñáÊ°£)</li>
<li>Âüü‰ø°ÊÅØ‰πüÂåÖÊã¨ÂüüÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºåÂú®fnm‰∏≠ÔºåÂüüÁöÑÊï∞ÊçÆ‰ø°ÊÅØÔºåÂú®fdxÔºåfdt‰∏≠„ÄÇ</li>
<li>ËØç‰ø°ÊÅØÊòØÂèçÂêë‰ø°ÊÅØÔºåÂåÖÊã¨ËØçÂÖ∏(tis, tii)ÔºåÊñáÊ°£Âè∑ÂèäËØçÈ¢ëÂÄíÊéíË°®(frq)ÔºåËØç‰ΩçÁΩÆÂÄíÊéíË°®(prx)„ÄÇ</li>
</ul>
</li>
</ul>
<p>Â§ßÂÆ∂ÂèØ‰ª•ÈÄöËøáÁúãÊ∫ê‰ª£Á†ÅÔºåÁõ∏Â∫îÁöÑReaderÂíåWriterÊù•‰∫ÜËß£Êñá‰ª∂ÁªìÊûÑÔºåÂ∞ÜÊõ¥‰∏∫ÈÄèÂΩª„ÄÇ</p>
<p>ÂèÇËÄÉËµÑÊñô</p>
<ul>
<li><a class="link" href="https://www.cnblogs.com/forfuture1978/archive/2009/12/14/1623597.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/forfuture1978/archive/2009/12/14/1623597.html</a></li>
<li><a class="link" href="https://www.cnblogs.com/forfuture1978/archive/2009/12/14/1623599.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/forfuture1978/archive/2009/12/14/1623599.html</a></li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/1c70c347/">
        
        

        <div class="article-details">
            <h2 class="article-title">Lucene ‰∫å: Lucene ÁöÑÊÄª‰ΩìÊû∂ÊûÑ</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/5e159a30/">
        
        

        <div class="article-details">
            <h2 class="article-title">Lucene ‰∏Ä: ÂÖ®ÊñáÊ£ÄÁ¥¢ÁöÑÂü∫Êú¨ÂéüÁêÜ</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/f8737bfa/">
        
        

        <div class="article-details">
            <h2 class="article-title">„ÄêËØë„ÄëLucene Êü•ËØ¢ËØ≠Ê≥ï</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/6ddc4d41/">
        
        

        <div class="article-details">
            <h2 class="article-title">Lucene Ê¶ÇËø∞</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="lxbwolf/lxbwolf.github.io"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Xiaobin&#39;s Notes
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
